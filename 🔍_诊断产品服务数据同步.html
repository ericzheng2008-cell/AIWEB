<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº§å“æœåŠ¡æ•°æ®åŒæ­¥è¯Šæ–­</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 30px;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #0047BB;
    }
    .section h2 {
      color: #0047BB;
      margin-top: 0;
      margin-bottom: 15px;
    }
    .data-box {
      background: white;
      padding: 15px;
      border-radius: 6px;
      margin-top: 10px;
      max-height: 400px;
      overflow-y: auto;
    }
    pre {
      margin: 0;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      line-height: 1.5;
    }
    .status {
      padding: 8px 16px;
      border-radius: 4px;
      display: inline-block;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .status.ok {
      background: #d4edda;
      color: #155724;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
    }
    .status.warning {
      background: #fff3cd;
      color: #856404;
    }
    .btn {
      background: #0047BB;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .btn:hover {
      background: #003399;
    }
    .btn.danger {
      background: #dc3545;
    }
    .btn.danger:hover {
      background: #c82333;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }
    th {
      background: #0047BB;
      color: white;
      font-weight: bold;
    }
    tr:hover {
      background: #f1f3f5;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” äº§å“æœåŠ¡æ•°æ®åŒæ­¥è¯Šæ–­å·¥å…·</h1>
    
    <div class="section">
      <h2>ğŸ“Š LocalStorage æ•°æ®çŠ¶æ€</h2>
      <button class="btn" onclick="checkData()">åˆ·æ–°æ•°æ®æ£€æŸ¥</button>
      <button class="btn danger" onclick="clearAllData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
      <button class="btn" onclick="loadDemoData()">åŠ è½½æ¼”ç¤ºæ•°æ®</button>
      <div id="storageStatus"></div>
    </div>

    <div class="section">
      <h2>ğŸ“ ä¸€çº§åˆ†ç±»æ•°æ®</h2>
      <div class="data-box" id="level1Data"></div>
    </div>

    <div class="section">
      <h2>ğŸ“ äºŒçº§åˆ†ç±»æ•°æ®</h2>
      <div class="data-box" id="level2Data"></div>
    </div>

    <div class="section">
      <h2>ğŸ“ ä¸‰çº§åˆ†ç±»æ•°æ®</h2>
      <div class="data-box" id="level3Data"></div>
    </div>

    <div class="section">
      <h2>ğŸ“¦ äº§å“æ•°æ®</h2>
      <div class="data-box" id="productsData"></div>
    </div>

    <div class="section">
      <h2>ğŸ¯ æµ‹è¯•æ“ä½œ</h2>
      <button class="btn" onclick="addTestCategory()">æ·»åŠ æµ‹è¯•ä¸€çº§åˆ†ç±»</button>
      <button class="btn" onclick="window.open('http://localhost:3002/#/admin/products-services', '_blank')">æ‰“å¼€åå°ç®¡ç†</button>
      <button class="btn" onclick="window.open('http://localhost:3002/#/products-services', '_blank')">æ‰“å¼€å‰å°å±•ç¤º</button>
      <div id="testResult" style="margin-top: 10px;"></div>
    </div>
  </div>

  <script>
    function checkData() {
      // æ£€æŸ¥æ‰€æœ‰localStorageé”®
      const keys = ['productsLevel1', 'productsLevel2', 'productsLevel3', 'productsData']
      const statusDiv = document.getElementById('storageStatus')
      let html = '<table><tr><th>å­˜å‚¨é”®</th><th>çŠ¶æ€</th><th>æ•°æ®é‡</th><th>æ“ä½œ</th></tr>'
      
      keys.forEach(key => {
        const data = localStorage.getItem(key)
        let status = '<span class="status error">ä¸å­˜åœ¨</span>'
        let count = '0'
        
        if (data) {
          try {
            const parsed = JSON.parse(data)
            count = Array.isArray(parsed) ? parsed.length : '1'
            status = '<span class="status ok">æ­£å¸¸</span>'
          } catch (e) {
            status = '<span class="status error">JSONæ ¼å¼é”™è¯¯</span>'
          }
        }
        
        html += `<tr>
          <td><code>${key}</code></td>
          <td>${status}</td>
          <td>${count} æ¡</td>
          <td><button class="btn" onclick="viewData('${key}')">æŸ¥çœ‹</button></td>
        </tr>`
      })
      
      html += '</table>'
      statusDiv.innerHTML = html
      
      // æ˜¾ç¤ºè¯¦ç»†æ•°æ®
      displayData('productsLevel1', 'level1Data')
      displayData('productsLevel2', 'level2Data')
      displayData('productsLevel3', 'level3Data')
      displayData('productsData', 'productsData')
    }
    
    function displayData(key, elementId) {
      const element = document.getElementById(elementId)
      const data = localStorage.getItem(key)
      
      if (!data) {
        element.innerHTML = '<p class="status warning">æš‚æ— æ•°æ®</p>'
        return
      }
      
      try {
        const parsed = JSON.parse(data)
        element.innerHTML = '<pre>' + JSON.stringify(parsed, null, 2) + '</pre>'
      } catch (e) {
        element.innerHTML = '<p class="status error">æ•°æ®æ ¼å¼é”™è¯¯: ' + e.message + '</p>'
      }
    }
    
    function viewData(key) {
      const data = localStorage.getItem(key)
      if (!data) {
        alert('æ•°æ®ä¸å­˜åœ¨')
        return
      }
      
      const win = window.open('', '_blank', 'width=800,height=600')
      win.document.write('<html><head><title>' + key + '</title>')
      win.document.write('<style>body{font-family:monospace;padding:20px;background:#f5f5f5;}pre{background:white;padding:20px;border-radius:8px;}</style>')
      win.document.write('</head><body>')
      win.document.write('<h1>' + key + '</h1>')
      win.document.write('<pre>' + JSON.stringify(JSON.parse(data), null, 2) + '</pre>')
      win.document.write('</body></html>')
    }
    
    function clearAllData() {
      if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰äº§å“æœåŠ¡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        return
      }
      
      const keys = ['productsLevel1', 'productsLevel2', 'productsLevel3', 'productsData', 'categoryBanners']
      keys.forEach(key => localStorage.removeItem(key))
      
      alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼é¡µé¢å°†åˆ·æ–°ã€‚')
      location.reload()
    }
    
    function loadDemoData() {
      // åŠ è½½æ¼”ç¤ºçš„ä¸€çº§åˆ†ç±»
      const level1 = [
        {
          id: 1,
          name: { 'zh-CN': 'æµ‹è¯•åˆ†ç±»1', 'en-US': 'Test Category 1' },
          description: { 'zh-CN': 'è¿™æ˜¯æµ‹è¯•åˆ†ç±»æè¿°', 'en-US': 'This is test category description' },
          image: 'https://images.unsplash.com/photo-1581092160607-ee22621dd758?w=600',
          icon: 'Lightning',
          order: 1,
          visible: true
        }
      ]
      
      localStorage.setItem('productsLevel1', JSON.stringify(level1))
      localStorage.setItem('productsLevel2', JSON.stringify([]))
      localStorage.setItem('productsLevel3', JSON.stringify([]))
      localStorage.setItem('productsData', JSON.stringify([]))
      
      alert('æ¼”ç¤ºæ•°æ®å·²åŠ è½½ï¼')
      checkData()
    }
    
    function addTestCategory() {
      const level1Data = localStorage.getItem('productsLevel1')
      let categories = level1Data ? JSON.parse(level1Data) : []
      
      const newCategory = {
        id: Date.now(),
        name: { 
          'zh-CN': 'æµ‹è¯•åˆ†ç±»_' + new Date().toLocaleTimeString(), 
          'en-US': 'Test_' + new Date().toLocaleTimeString() 
        },
        description: { 
          'zh-CN': 'é€šè¿‡è¯Šæ–­å·¥å…·æ·»åŠ çš„æµ‹è¯•åˆ†ç±»', 
          'en-US': 'Test category added by diagnostic tool' 
        },
        image: 'https://images.unsplash.com/photo-1581092160607-ee22621dd758?w=600',
        icon: 'Lightning',
        order: categories.length + 1,
        visible: true
      }
      
      categories.push(newCategory)
      localStorage.setItem('productsLevel1', JSON.stringify(categories))
      
      document.getElementById('testResult').innerHTML = 
        '<p class="status ok">âœ… æˆåŠŸæ·»åŠ æµ‹è¯•åˆ†ç±»ï¼åˆ†ç±»ID: ' + newCategory.id + '</p>' +
        '<p>è¯·åˆ·æ–°å‰å°é¡µé¢æŸ¥çœ‹æ•ˆæœ: <a href="http://localhost:3002/#/products-services" target="_blank">æ‰“å¼€å‰å°</a></p>'
      
      checkData()
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.onload = checkData
    
    // ç›‘å¬storageå˜åŒ–
    window.addEventListener('storage', function(e) {
      if (e.key && e.key.startsWith('products')) {
        console.log('æ£€æµ‹åˆ°æ•°æ®å˜åŒ–:', e.key)
        checkData()
      }
    })
  </script>
</body>
</html>
