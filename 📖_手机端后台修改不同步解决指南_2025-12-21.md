# ğŸ“– åå°ä¿®æ”¹æ•°æ®è‡ªåŠ¨æ¢å¤é—®é¢˜ - å®Œæ•´è§£å†³æŒ‡å—

**é—®é¢˜æè¿°**: åœ¨åå°ä¿®æ”¹è¿‡çš„ä¸»é¡µå†…å®¹(LOGOã€Banneræ–‡å­—ã€æ˜æ˜Ÿäº§å“å›¾ç‰‡ç­‰),è¿‡ä¸€ä¼šå„¿åˆä¼šæ¢å¤åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€

**å‘ç”Ÿæ—¶é—´**: 2025-12-21  
**é—®é¢˜çº§åˆ«**: ğŸ”´ ä¸¥é‡ - å½±å“åå°ç®¡ç†åŠŸèƒ½æ­£å¸¸ä½¿ç”¨

---

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› 

### é—®é¢˜åˆ†æ

ä½ çš„ç³»ç»Ÿå­˜åœ¨**æ•°æ®æŒä¹…åŒ–å†²çª**é—®é¢˜:

```
åå°ä¿å­˜æµç¨‹:
1. âœ… ç”¨æˆ·åœ¨åå°ä¿®æ”¹æ•°æ®
2. âœ… æ•°æ®ä¿å­˜åˆ° localStorage
3. âŒ é¡µé¢åˆ·æ–°å,ä»é»˜è®¤é…ç½®é‡æ–°åˆå§‹åŒ–
4. âŒ è¦†ç›–äº† localStorage ä¸­çš„ç”¨æˆ·ä¿®æ”¹
```

### ä»£ç é—®é¢˜å®šä½

**æ–‡ä»¶**: `src/store/cms.js`

**é—®é¢˜ä»£ç **:
```javascript
state: () => ({
  // âŒ é—®é¢˜: æ¯æ¬¡åˆå§‹åŒ–éƒ½ä»localStorageè¯»å–,ä½†å¦‚æœä¸ºç©ºå°±ç”¨é»˜è®¤å€¼
  homeBanners: JSON.parse(localStorage.getItem('homeBanners') || JSON.stringify([
    // è¿™é‡Œæ˜¯ç¡¬ç¼–ç çš„é»˜è®¤å€¼
    { id: 1, title: {...}, ... },
    { id: 2, title: {...}, ... }
  ])),
  
  featuredProducts: JSON.parse(localStorage.getItem('featuredProducts') || JSON.stringify([
    // ç¡¬ç¼–ç çš„é»˜è®¤æ˜æ˜Ÿäº§å“
  ])),
  
  siteConfig: {
    logo: localStorage.getItem('siteLogo') || '', // âŒ ç©ºå­—ç¬¦ä¸²å¯¼è‡´LOGOä¸¢å¤±
    companyName: {
      'zh-CN': 'æ˜å‡ä¼Ÿä¸š',  // âŒ ç¡¬ç¼–ç é»˜è®¤å€¼
      'en-US': 'Mingsheng'
    }
  }
})
```

### é—®é¢˜è§¦å‘æ¡ä»¶

1. **æµè§ˆå™¨æ¸…ç†ç¼“å­˜** - localStorageè¢«æ¸…ç©º
2. **éšç§æ¨¡å¼æµè§ˆ** - localStorageä¸å¯ç”¨
3. **è·¨æµè§ˆå™¨è®¿é—®** - ä¸åŒæµè§ˆå™¨localStorageç‹¬ç«‹
4. **æ‰‹æœºç«¯è®¿é—®** - æ‰‹æœºæµè§ˆå™¨ç¼“å­˜ç­–ç•¥æ›´æ¿€è¿›
5. **localStorageé…é¢æ»¡** - æµè§ˆå™¨è‡ªåŠ¨æ¸…ç†æ—§æ•°æ®

---

## ğŸ”§ å®Œæ•´è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: æ·»åŠ åç«¯æ•°æ®åº“æŒä¹…åŒ– (æ¨è â­â­â­â­â­)

#### æ­¥éª¤1: åˆ›å»ºåç«¯API

**æ–‡ä»¶**: `server/routes/cms.js`

```javascript
const express = require('express')
const router = express.Router()
const fs = require('fs').promises
const path = require('path')

// CMSæ•°æ®å­˜å‚¨è·¯å¾„
const CMS_DATA_PATH = path.join(__dirname, '../data/cms-config.json')

// ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
const ensureDataDir = async () => {
  const dir = path.dirname(CMS_DATA_PATH)
  try {
    await fs.access(dir)
  } catch {
    await fs.mkdir(dir, { recursive: true })
  }
}

// è¯»å–CMSé…ç½®
router.get('/config', async (req, res) => {
  try {
    await ensureDataDir()
    const data = await fs.readFile(CMS_DATA_PATH, 'utf-8')
    res.json(JSON.parse(data))
  } catch (error) {
    // è¿”å›é»˜è®¤é…ç½®
    res.json(getDefaultConfig())
  }
})

// ä¿å­˜CMSé…ç½®
router.post('/config', async (req, res) => {
  try {
    await ensureDataDir()
    await fs.writeFile(CMS_DATA_PATH, JSON.stringify(req.body, null, 2))
    res.json({ success: true })
  } catch (error) {
    res.status(500).json({ error: error.message })
  }
})

// é»˜è®¤é…ç½®
function getDefaultConfig() {
  return {
    siteConfig: {
      logo: '',
      companyName: {
        'zh-CN': 'æ˜å‡ä¼Ÿä¸š',
        'en-US': 'Mingsheng'
      }
    },
    homeBanners: [],
    featuredProducts: []
  }
}

module.exports = router
```

#### æ­¥éª¤2: ä¿®æ”¹å‰ç«¯Store

**æ–‡ä»¶**: `src/store/cms.js`

```javascript
import { defineStore } from 'pinia'
import axios from 'axios'

export const useCmsStore = defineStore('cms', {
  state: () => ({
    siteConfig: {
      logo: '',
      companyName: { 'zh-CN': 'æ˜å‡ä¼Ÿä¸š', 'en-US': 'Mingsheng' },
      slogan: { 'zh-CN': 'ä¸“ä¸šå·¥ä¸šå·¥å…·ä¾›åº”å•†', 'en-US': 'Professional Industrial Tools Supplier' }
    },
    homeBanners: [],
    featuredProducts: [],
    themeColors: {
      primary: '#1890ff',
      primaryLight: '#40a9ff',
      primaryDark: '#096dd9'
    },
    // åŠ è½½çŠ¶æ€
    isLoaded: false
  }),
  
  actions: {
    // ğŸ”¥ ä»åç«¯åŠ è½½é…ç½®
    async loadConfig() {
      try {
        const response = await axios.get('/api/cms/config')
        if (response.data) {
          // æ›´æ–°state
          Object.assign(this.$state, response.data)
          // åŒæ­¥åˆ°localStorageä½œä¸ºç¼“å­˜
          this.syncToLocalStorage()
          this.isLoaded = true
        }
      } catch (error) {
        console.error('åŠ è½½CMSé…ç½®å¤±è´¥,ä½¿ç”¨localStorageç¼“å­˜:', error)
        // é™çº§:ä»localStorageåŠ è½½
        this.loadFromLocalStorage()
      }
    },
    
    // ğŸ”¥ ä¿å­˜é…ç½®åˆ°åç«¯
    async saveConfig() {
      try {
        // ä¿å­˜åˆ°åç«¯
        await axios.post('/api/cms/config', this.$state)
        // åŒæ­¥åˆ°localStorage
        this.syncToLocalStorage()
        return { success: true }
      } catch (error) {
        console.error('ä¿å­˜CMSé…ç½®å¤±è´¥:', error)
        // é™çº§:åªä¿å­˜åˆ°localStorage
        this.syncToLocalStorage()
        return { success: false, error: error.message }
      }
    },
    
    // åŒæ­¥åˆ°localStorage
    syncToLocalStorage() {
      localStorage.setItem('siteLogo', this.siteConfig.logo)
      localStorage.setItem('siteConfig', JSON.stringify(this.siteConfig))
      localStorage.setItem('homeBanners', JSON.stringify(this.homeBanners))
      localStorage.setItem('featuredProducts', JSON.stringify(this.featuredProducts))
      localStorage.setItem('themeColors', JSON.stringify(this.themeColors))
    },
    
    // ä»localStorageåŠ è½½(é™çº§æ–¹æ¡ˆ)
    loadFromLocalStorage() {
      try {
        const siteLogo = localStorage.getItem('siteLogo')
        if (siteLogo) this.siteConfig.logo = siteLogo
        
        const siteConfig = localStorage.getItem('siteConfig')
        if (siteConfig) Object.assign(this.siteConfig, JSON.parse(siteConfig))
        
        const homeBanners = localStorage.getItem('homeBanners')
        if (homeBanners) this.homeBanners = JSON.parse(homeBanners)
        
        const featuredProducts = localStorage.getItem('featuredProducts')
        if (featuredProducts) this.featuredProducts = JSON.parse(featuredProducts)
        
        const themeColors = localStorage.getItem('themeColors')
        if (themeColors) this.themeColors = JSON.parse(themeColors)
        
        this.isLoaded = true
      } catch (error) {
        console.error('ä»localStorageåŠ è½½å¤±è´¥:', error)
      }
    },
    
    // æ›´æ–°LOGO
    updateLogo(logoUrl) {
      this.siteConfig.logo = logoUrl
      this.saveConfig() // è‡ªåŠ¨ä¿å­˜åˆ°åç«¯
    },
    
    // æ›´æ–°Banner
    updateHomeBanners(banners) {
      this.homeBanners = banners
      this.saveConfig()
    },
    
    // æ›´æ–°æ˜æ˜Ÿäº§å“
    updateFeaturedProducts(products) {
      this.featuredProducts = products
      this.saveConfig()
    }
  }
})
```

#### æ­¥éª¤3: ä¿®æ”¹åå°ç®¡ç†é¡µé¢

**æ–‡ä»¶**: `src/views/admin/CmsManage.vue`

```vue
<script setup>
import { onMounted } from 'vue'
import { useCmsStore } from '@/store/cms'

const cmsStore = useCmsStore()

// é¡µé¢åŠ è½½æ—¶ä»åç«¯è¯»å–é…ç½®
onMounted(async () => {
  await cmsStore.loadConfig()
})

// ä¿å­˜LOGO
const saveLogo = async () => {
  const result = await cmsStore.saveConfig()
  if (result.success) {
    ElMessage.success('LOGOä¿å­˜æˆåŠŸ!')
  } else {
    ElMessage.error('ä¿å­˜å¤±è´¥: ' + result.error)
  }
}

// ä¿å­˜Banner
const saveBanners = async () => {
  const result = await cmsStore.saveConfig()
  if (result.success) {
    ElMessage.success('Bannerä¿å­˜æˆåŠŸ!')
  } else {
    ElMessage.error('ä¿å­˜å¤±è´¥: ' + result.error)
  }
}
</script>
```

#### æ­¥éª¤4: ä¿®æ”¹ä¸»é¡µåŠ è½½é€»è¾‘

**æ–‡ä»¶**: `src/views/Home.vue`

```vue
<script setup>
import { onMounted } from 'vue'
import { useCmsStore } from '@/store/cms'

const cmsStore = useCmsStore()

onMounted(async () => {
  // å¦‚æœè¿˜æœªåŠ è½½,åˆ™ä»åç«¯åŠ è½½
  if (!cmsStore.isLoaded) {
    await cmsStore.loadConfig()
  }
})
</script>
```

---

### æ–¹æ¡ˆ2: ä¿®å¤ç°æœ‰localStorageé€»è¾‘ (ä¸´æ—¶æ–¹æ¡ˆ â­â­â­)

å¦‚æœæš‚æ—¶æ— æ³•å®ç°åç«¯,å¯ä»¥ä¼˜åŒ–localStorageé€»è¾‘:

#### ä¿®æ”¹ `src/store/cms.js`

```javascript
export const useCmsStore = defineStore('cms', {
  state: () => {
    // ğŸ”¥ ä¼˜åŒ–: æ·»åŠ åˆå§‹åŒ–æ ‡è®°
    const isInitialized = localStorage.getItem('cmsInitialized') === 'true'
    
    return {
      siteConfig: {
        logo: localStorage.getItem('siteLogo') || '',
        companyName: JSON.parse(localStorage.getItem('companyName') || JSON.stringify({
          'zh-CN': 'æ˜å‡ä¼Ÿä¸š',
          'en-US': 'Mingsheng'
        })),
        slogan: JSON.parse(localStorage.getItem('companySlogan') || JSON.stringify({
          'zh-CN': 'ä¸“ä¸šå·¥ä¸šå·¥å…·ä¾›åº”å•†',
          'en-US': 'Professional Industrial Tools Supplier'
        }))
      },
      
      // ğŸ”¥ Banner - åªåœ¨é¦–æ¬¡åˆå§‹åŒ–æ—¶ä½¿ç”¨é»˜è®¤å€¼
      homeBanners: (() => {
        const saved = localStorage.getItem('homeBanners')
        if (saved) return JSON.parse(saved)
        if (isInitialized) return [] // å·²åˆå§‹åŒ–ä½†ä¸ºç©º,è¯´æ˜ç”¨æˆ·æ¸…ç©ºäº†
        // é¦–æ¬¡è®¿é—®,è¿”å›é»˜è®¤å€¼
        return [/* é»˜è®¤banner */]
      })(),
      
      // ğŸ”¥ æ˜æ˜Ÿäº§å“
      featuredProducts: (() => {
        const saved = localStorage.getItem('featuredProducts')
        if (saved) return JSON.parse(saved)
        if (isInitialized) return []
        return [/* é»˜è®¤äº§å“ */]
      })()
    }
  },
  
  actions: {
    // ğŸ”¥ æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
    markInitialized() {
      localStorage.setItem('cmsInitialized', 'true')
    },
    
    updateLogo(logoUrl) {
      this.siteConfig.logo = logoUrl
      localStorage.setItem('siteLogo', logoUrl)
      this.markInitialized()
    },
    
    updateCompanyName(name, locale) {
      this.siteConfig.companyName[locale] = name
      localStorage.setItem('companyName', JSON.stringify(this.siteConfig.companyName))
      this.markInitialized()
    },
    
    updateHomeBanners(banners) {
      this.homeBanners = banners
      localStorage.setItem('homeBanners', JSON.stringify(banners))
      this.markInitialized()
    },
    
    updateFeaturedProducts(products) {
      this.featuredProducts = products
      localStorage.setItem('featuredProducts', JSON.stringify(products))
      this.markInitialized()
    }
  }
})
```

---

### æ–¹æ¡ˆ3: ä½¿ç”¨IndexedDBä»£æ›¿localStorage (é«˜çº§æ–¹æ¡ˆ â­â­â­â­)

IndexedDBæ¯”localStorageæ›´å¯é ,ä¸ä¼šè¢«è½»æ˜“æ¸…ç†:

```javascript
// src/utils/db.js
import { openDB } from 'idb'

const DB_NAME = 'AIWEB_CMS'
const DB_VERSION = 1

async function getDB() {
  return openDB(DB_NAME, DB_VERSION, {
    upgrade(db) {
      if (!db.objectStoreNames.contains('config')) {
        db.createObjectStore('config')
      }
    }
  })
}

export async function saveConfig(key, value) {
  const db = await getDB()
  await db.put('config', value, key)
}

export async function getConfig(key) {
  const db = await getDB()
  return db.get('config', key)
}
```

---

## ğŸ¯ å¿«é€Ÿä¿®å¤æ­¥éª¤

### ç«‹å³è§£å†³ (5åˆ†é’Ÿ)

1. **ä¿®æ”¹cms.js stateåˆå§‹åŒ–é€»è¾‘**
2. **æ·»åŠ ä¿å­˜æˆåŠŸæç¤º**
3. **æµ‹è¯•ä¿å­˜å’Œåˆ·æ–°åŠŸèƒ½**

### å®Œæ•´è§£å†³ (30åˆ†é’Ÿ)

1. **åˆ›å»ºåç«¯API**
2. **ä¿®æ”¹StoreåŠ è½½é€»è¾‘**
3. **ä¿®æ”¹åå°ç®¡ç†é¡µé¢**
4. **å…¨é¢æµ‹è¯•**

---

## âœ… éªŒè¯æ¸…å•

### åŠŸèƒ½æµ‹è¯•

- [ ] åå°ä¿®æ”¹LOGO â†’ ä¿å­˜ â†’ åˆ·æ–°é¡µé¢ â†’ LOGOæœªä¸¢å¤±
- [ ] åå°ä¿®æ”¹å…¬å¸åç§° â†’ ä¿å­˜ â†’ åˆ·æ–° â†’ åç§°æœªä¸¢å¤±
- [ ] åå°ä¿®æ”¹Banner â†’ ä¿å­˜ â†’ åˆ·æ–° â†’ Banneræœªä¸¢å¤±
- [ ] åå°ä¿®æ”¹æ˜æ˜Ÿäº§å“ â†’ ä¿å­˜ â†’ åˆ·æ–° â†’ äº§å“æœªä¸¢å¤±
- [ ] æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ â†’ é‡æ–°è®¿é—® â†’ æ•°æ®ä¾ç„¶å­˜åœ¨

### è·¨ç«¯æµ‹è¯•

- [ ] PCç«¯ä¿®æ”¹ â†’ PCç«¯åˆ·æ–° â†’ æ•°æ®æ­£å¸¸
- [ ] PCç«¯ä¿®æ”¹ â†’ æ‰‹æœºç«¯è®¿é—® â†’ æ•°æ®åŒæ­¥
- [ ] æ‰‹æœºç«¯è®¿é—® â†’ æ¸…é™¤ç¼“å­˜ â†’ æ•°æ®æ¢å¤
- [ ] ä¸åŒæµè§ˆå™¨è®¿é—® â†’ æ•°æ®ä¸€è‡´

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ•°æ®æŒä¹…åŒ–åŸåˆ™

```
ä¼˜å…ˆçº§: 
åç«¯æ•°æ®åº“ > IndexedDB > localStorage > å†…å­˜ç¼“å­˜
```

### 2. ä¿å­˜æç¤ºä¼˜åŒ–

```vue
<el-button @click="saveLogo">
  ä¿å­˜LOGO
</el-button>

<script>
const saveLogo = async () => {
  loading.value = true
  try {
    await cmsStore.updateLogo(logoUrl)
    ElMessage({
      type: 'success',
      message: 'LOGOä¿å­˜æˆåŠŸ! æ‰€æœ‰è®¾å¤‡å°†åœ¨åˆ·æ–°åçœ‹åˆ°æ›´æ–°',
      duration: 5000
    })
  } catch (error) {
    ElMessage.error('ä¿å­˜å¤±è´¥,è¯·é‡è¯•')
  } finally {
    loading.value = false
  }
}
</script>
```

### 3. è‡ªåŠ¨ä¿å­˜æœºåˆ¶

```javascript
// é˜²æŠ–è‡ªåŠ¨ä¿å­˜
import { debounce } from 'lodash-es'

const autoSave = debounce(async () => {
  await cmsStore.saveConfig()
}, 2000)

watch(() => cmsStore.siteConfig, () => {
  autoSave()
}, { deep: true })
```

---

## ğŸš€ æ¨èå®æ–½æ–¹æ¡ˆ

### çŸ­æœŸ (ä»Šå¤©å®Œæˆ)

1. âœ… ä½¿ç”¨**æ–¹æ¡ˆ2**(ä¿®å¤localStorageé€»è¾‘)
2. âœ… æ·»åŠ ä¿å­˜æˆåŠŸæç¤º
3. âœ… æµ‹è¯•åŸºæœ¬åŠŸèƒ½

### ä¸­æœŸ (æœ¬å‘¨å®Œæˆ)

1. âœ… å®æ–½**æ–¹æ¡ˆ1**(åç«¯æ•°æ®åº“)
2. âœ… æ·»åŠ è‡ªåŠ¨ä¿å­˜
3. âœ… å®Œæ•´æµ‹è¯•

### é•¿æœŸ (ä¸‹å‘¨å®Œæˆ)

1. âœ… å‡çº§åˆ°IndexedDB
2. âœ… æ·»åŠ ç‰ˆæœ¬æ§åˆ¶
3. âœ… æ·»åŠ æ•°æ®å¯¼å…¥å¯¼å‡º

---

## ğŸ“ éœ€è¦å¸®åŠ©?

å¦‚æœä½ éœ€è¦æˆ‘å¸®ä½ å®æ–½æŸä¸ªæ–¹æ¡ˆ,è¯·å‘Šè¯‰æˆ‘:

1. "å®æ–½æ–¹æ¡ˆ1 - åç«¯æŒä¹…åŒ–"
2. "å®æ–½æ–¹æ¡ˆ2 - ä¿®å¤localStorage"
3. "å®æ–½æ–¹æ¡ˆ3 - IndexedDBå‡çº§"

æˆ‘å°†ä¸ºä½ æä¾›å®Œæ•´çš„ä»£ç ä¿®æ”¹!
