# 云服务器部署完整指南

**版本**：v1.0  
**日期**：2025-12-21  
**适用场景**：企业长期稳定内测

---

## 🎯 部署目标

- ✅ 7×24小时稳定运行
- ✅ 随时随地访问（不受局域网限制）
- ✅ 支持多人同时在线
- ✅ 数据自动备份
- ✅ 可配置独立域名

---

## 💰 成本预估

### 方案一：入门版（推荐小团队）

| 项目 | 配置 | 费用 |
|-----|------|------|
| **云服务器** | 2核4GB | ¥600-800/年（新用户优惠） |
| **带宽** | 5Mbps | 含在服务器中 |
| **域名**（可选） | .com | ¥60/年 |
| **SSL证书** | Let's Encrypt | 免费 |
| **总计** | - | **¥660-860/年** |

### 方案二：标准版（推荐中型团队）

| 项目 | 配置 | 费用 |
|-----|------|------|
| **云服务器** | 4核8GB | ¥1,500-2,000/年 |
| **带宽** | 10Mbps | 含在服务器中 |
| **域名** | .com | ¥60/年 |
| **SSL证书** | Let's Encrypt | 免费 |
| **CDN加速**（可选） | 100GB流量 | ¥200/年 |
| **总计** | - | **¥1,760-2,260/年** |

---

## 🚀 快速部署（30分钟完成）

### 第一步：购买云服务器

#### 推荐厂商

**腾讯云**（性价比最高）：
```
1. 访问：https://cloud.tencent.com/act/pro/cvm
2. 选择新用户专享优惠
3. 配置选择：
   - 地域：广州/上海/北京（根据用户分布）
   - 机型：标准型S5
   - CPU内存：2核4GB
   - 系统盘：50GB 高性能云硬盘
   - 公网带宽：5Mbps（按流量计费更划算）
   - 镜像：Ubuntu Server 22.04 LTS 64位
   - 购买时长：1年（优惠力度最大）
4. 支付：约¥600（新用户价格）
```

**阿里云**（稳定性最佳）：
```
1. 访问：https://www.aliyun.com/product/ecs
2. 同样配置约¥800/年
```

#### 安全组配置

```
入站规则（必须开放）：
- 22端口（SSH）：源地址 0.0.0.0/0
- 80端口（HTTP）：源地址 0.0.0.0/0  
- 443端口（HTTPS）：源地址 0.0.0.0/0

可选规则：
- 5000端口（后端API）：建议仅允许内网访问
```

---

### 第二步：连接服务器

#### Windows系统连接

**方法一：使用Xshell（推荐）**
```
1. 下载Xshell：https://www.xshell.com
2. 新建会话：
   - 主机：[服务器IP]
   - 端口：22
   - 用户：root 或 ubuntu
   - 密码：[购买时设置的密码]
3. 连接
```

**方法二：使用Windows Terminal**
```powershell
# 打开PowerShell
ssh root@your-server-ip

# 输入密码登录
```

#### Mac/Linux系统连接

```bash
# 打开终端
ssh root@your-server-ip

# 或使用ubuntu用户
ssh ubuntu@your-server-ip
```

---

### 第三步：一键部署

#### 上传部署脚本

**方法一：直接下载**（推荐）
```bash
# 连接服务器后执行
cd ~
wget https://raw.githubusercontent.com/ericzheng2008-cell/AIWEB/main/☁️_云服务器一键部署脚本.sh

# 赋予执行权限
chmod +x ☁️_云服务器一键部署脚本.sh

# 运行部署
sudo bash ☁️_云服务器一键部署脚本.sh
```

**方法二：手动上传**
```bash
# 在本地电脑
scp ☁️_云服务器一键部署脚本.sh root@your-server-ip:/root/

# 连接服务器
ssh root@your-server-ip

# 运行部署
cd /root
chmod +x ☁️_云服务器一键部署脚本.sh
sudo bash ☁️_云服务器一键部署脚本.sh
```

#### 部署过程（自动）

脚本会自动完成以下操作：
```
[1/12] 检查系统环境
[2/12] 更新系统软件包
[3/12] 安装基础工具
[4/12] 安装Node.js 18
[5/12] 安装pnpm
[6/12] 安装PM2进程管理器
[7/12] 安装Nginx
[8/12] 克隆AIWEB代码
[9/12] 安装项目依赖
[10/12] 构建前端代码
[11/12] 配置Nginx反向代理
[12/12] 启动后端服务
[13/13] 配置防火墙和自动备份

✅ 部署完成！
```

---

### 第四步：验证部署

#### 检查服务状态

```bash
# 检查Nginx
systemctl status nginx

# 检查后端服务
pm2 status

# 查看后端日志
pm2 logs aiweb-backend --lines 50
```

#### 浏览器访问

```
在浏览器输入：http://[服务器IP]

示例：http://123.45.67.89

如果看到AIWEB首页，说明部署成功！
```

---

## 🌐 配置域名（推荐）

### 第一步：购买域名

**阿里云万网**：
```
1. 访问：https://wanwang.aliyun.com
2. 搜索您想要的域名
3. 选择 .com域名（¥69/年）
4. 完成购买和实名认证
```

**腾讯云**：
```
1. 访问：https://dnspod.cloud.tencent.com
2. 同样流程，价格约¥55/年
```

### 第二步：配置DNS解析

**添加A记录**：
```
登录域名控制台 → DNS解析设置

记录类型：A
主机记录：aiweb（或@代表主域名）
记录值：[服务器IP]
TTL：600秒（10分钟）

示例：
aiweb.yourcompany.com → 123.45.67.89
```

**等待生效**：
```bash
# 测试域名解析（5-30分钟生效）
ping aiweb.yourcompany.com

# 看到IP地址说明解析成功
```

### 第三步：更新Nginx配置

```bash
# 编辑Nginx配置
nano /etc/nginx/sites-available/aiweb

# 修改server_name
server_name aiweb.yourcompany.com;

# 保存并退出（Ctrl+X, Y, Enter）

# 测试配置
nginx -t

# 重新加载
systemctl reload nginx
```

---

## 🔒 配置HTTPS（强烈推荐）

### 使用Let's Encrypt免费证书

```bash
# 安装Certbot
apt install -y certbot python3-certbot-nginx

# 自动申请并配置证书
certbot --nginx -d aiweb.yourcompany.com

# 按提示操作：
# 1. 输入邮箱地址
# 2. 同意服务条款（A）
# 3. 选择重定向HTTP到HTTPS（2）

# 配置自动续期
certbot renew --dry-run

# 证书有效期90天，会自动续期
```

### 验证HTTPS

```
浏览器访问：https://aiweb.yourcompany.com

看到绿色小锁图标 🔒 说明配置成功！
```

---

## 📱 分享给内测人员

### 生成访问二维码

**在线工具**：
```
1. 访问：https://cli.im
2. 输入网址：https://aiweb.yourcompany.com
3. 生成二维码
4. 下载并分享给内测人员
```

### 创建访问指南文档

**复制并编辑**：`📄_企业内测访问指南_分享版.md`

**修改内容**：
- 访问地址：改为您的域名
- 登录账号：设置测试账号
- 支持联系方式：填写IT部门信息

**分享渠道**：
- 企业微信群
- 钉钉群
- 邮件群发
- 内部Wiki

---

## 🔧 日常运维

### 常用命令

```bash
# 重启后端服务
pm2 restart aiweb-backend

# 重载Nginx（配置修改后）
systemctl reload nginx

# 查看后端日志
pm2 logs aiweb-backend

# 查看Nginx访问日志
tail -f /var/log/nginx/aiweb-access.log

# 查看系统资源
htop

# 查看磁盘空间
df -h

# 查看备份
ls -lh /backup/aiweb
```

### 监控服务状态

**安装Netdata（可选）**：
```bash
# 一键安装
bash <(curl -Ss https://my-netdata.io/kickstart.sh)

# 访问监控面板
http://your-server-ip:19999

# 实时查看CPU、内存、网络等指标
```

### 手动备份

```bash
# 立即执行备份
/usr/local/bin/backup-aiweb.sh

# 查看备份文件
ls -lh /backup/aiweb

# 恢复备份（如需要）
cp /backup/aiweb/aiweb_YYYYMMDD_HHMMSS.db /var/www/AIWEB/server/data/aiweb.db
pm2 restart aiweb-backend
```

---

## 🆘 故障排查

### 问题1：无法访问网站

**排查步骤**：
```bash
# 1. 检查Nginx状态
systemctl status nginx

# 如果未运行
systemctl start nginx

# 2. 检查后端服务
pm2 status

# 如果aiweb-backend状态异常
pm2 restart aiweb-backend

# 3. 检查防火墙
ufw status

# 4. 检查服务器安全组（云控制台）
# 确保80和443端口已开放

# 5. 查看错误日志
tail -100 /var/log/nginx/aiweb-error.log
pm2 logs aiweb-backend --err --lines 100
```

### 问题2：访问速度慢

**优化方法**：
```bash
# 1. 检查服务器负载
htop

# 2. 检查带宽使用
iftop

# 3. 考虑升级配置
# 云控制台 → 升级实例配置

# 4. 配置CDN加速
# 见"高级优化"章节
```

### 问题3：磁盘空间不足

```bash
# 查看磁盘使用
df -h

# 清理日志
pm2 flush
rm -f /var/log/nginx/*.log.*.gz

# 清理旧备份
find /backup/aiweb -mtime +30 -delete

# 清理npm缓存
npm cache clean --force
```

---

## 📊 性能优化

### 开启Gzip压缩

```nginx
# 已在部署脚本中配置
# 无需额外操作
```

### 配置CDN加速（可选）

**腾讯云CDN**：
```
1. 开通CDN服务
2. 添加加速域名：static.yourcompany.com
3. 源站配置：your-server-ip
4. 添加DNS解析（CNAME）
5. Nginx配置静态资源域名
```

---

## 📞 技术支持

**官方文档**：
- Nginx：https://nginx.org/en/docs/
- PM2：https://pm2.keymetrics.io/docs/
- Let's Encrypt：https://letsencrypt.org/docs/

**社区支持**：
- Stack Overflow
- GitHub Issues

---

## ✅ 部署检查清单

### 部署前
- [ ] 已购买云服务器
- [ ] 已配置安全组（22,80,443端口）
- [ ] 已准备域名（可选）

### 部署中
- [ ] 成功连接服务器
- [ ] 执行一键部署脚本
- [ ] 部署过程无错误

### 部署后
- [ ] 浏览器可访问网站
- [ ] 服务状态正常（nginx, pm2）
- [ ] 域名解析成功（如配置）
- [ ] HTTPS配置成功（如配置）
- [ ] 自动备份运行正常
- [ ] 访问指南已分享给内测人员

---

**文档版本**：v1.0  
**最后更新**：2025-12-21  
**维护团队**：IT支持部门
