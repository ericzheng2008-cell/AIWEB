# AIWEBä»£ç æ¨¡å—å®Œæ•´è¯´æ˜æ–‡æ¡£

**ç‰ˆæœ¬**: v2.5.0  
**æ—¥æœŸ**: 2025-12-20

---

## ğŸ“‹ é¡¹ç›®æŠ€æœ¯æ ˆ

**å‰ç«¯**: Vue 3.4 + Element Plus 2.7 + ECharts 5.5 + Vite 5.2  
**åç«¯**: Node.js 18+ + Express 4.18 + SQLite3  
**å·¥å…·**: Axios + Pinia + Vue Router 4.3

---

## ğŸ“ ç›®å½•ç»“æ„

```
AIWEB1/
â”œâ”€ src/                      # å‰ç«¯æºç 
â”‚  â”œâ”€ components/            # å…¬å…±ç»„ä»¶ (Header/Footer/AiChat/InquiryForm)
â”‚  â”œâ”€ views/                 # é¡µé¢è§†å›¾
â”‚  â”‚  â”œâ”€ Home.vue            # é¦–é¡µ (~1800è¡Œ)
â”‚  â”‚  â”œâ”€ MingShengAICRM_V3.vue  # æ˜å‡AICRM (~4200è¡Œ)
â”‚  â”‚  â”œâ”€ EquipmentLifecycle.vue # è®¾å¤‡ç®¡ç† (~2800è¡Œ)
â”‚  â”‚  â””â”€ admin/              # åå°ç®¡ç†é¡µé¢
â”‚  â”œâ”€ router/index.js        # è·¯ç”±é…ç½®
â”‚  â”œâ”€ store/index.js         # PiniaçŠ¶æ€ç®¡ç†
â”‚  â”œâ”€ utils/                 # å·¥å…·å‡½æ•° (request/storage/date)
â”‚  â””â”€ main.js                # å…¥å£æ–‡ä»¶
â”œâ”€ server/                   # åç«¯æºç 
â”‚  â”œâ”€ index.js               # æœåŠ¡å™¨å…¥å£ (~150è¡Œ)
â”‚  â”œâ”€ routes/                # APIè·¯ç”± (equipment/products/cms/aimes)
â”‚  â”œâ”€ database/aiweb.db      # SQLiteæ•°æ®åº“
â”‚  â””â”€ uploads/               # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â”œâ”€ package.json
â””â”€ vite.config.js
```

---

## ğŸ”§ æ ¸å¿ƒä»£ç æ¨¡å—

### 1. å‰ç«¯å…¥å£ (main.js)

```javascript
import { createApp } from 'vue'
import ElementPlus from 'element-plus'
import * as ElementPlusIconsVue from '@element-plus/icons-vue'
import { createPinia } from 'pinia'
import router from './router'
import App from './App.vue'

const app = createApp(App)

// æ³¨å†ŒElement Pluså›¾æ ‡
for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
  app.component(key, component)
}

app.use(createPinia()).use(router).use(ElementPlus).mount('#app')
```

---

### 2. è·¯ç”±é…ç½® (router/index.js)

**æ ¸å¿ƒè·¯ç”±**:
- `/` - é¦–é¡µ
- `/mingsheng-aicrm` - æ˜å‡AICRM
- `/mingsheng-aicrm?tab=aimes` - AIMESåŠ©æ‰‹
- `/equipment-lifecycle` - è®¾å¤‡ç®¡ç†
- `/admin/*` - åå°ç®¡ç† (éœ€è®¤è¯)

**ç‰¹æ€§**: æ‡’åŠ è½½ã€åµŒå¥—è·¯ç”±ã€æƒé™å®ˆå«ã€æ»šåŠ¨è¡Œä¸º

---

### 3. çŠ¶æ€ç®¡ç† (store/index.js)

**ä¸‰å¤§Store**:
1. **useUserStore**: ç”¨æˆ·ä¿¡æ¯ã€ç™»å½•çŠ¶æ€ã€Tokenç®¡ç†
2. **useAppStore**: è¯­è¨€ã€ä¸»é¢˜ã€ä¾§è¾¹æ çŠ¶æ€
3. **useEquipmentStore**: è®¾å¤‡åˆ—è¡¨ã€ç­›é€‰æ¡ä»¶ã€Gettersè®¡ç®—

---

### 4. HTTPè¯·æ±‚å°è£… (utils/request.js)

```javascript
import axios from 'axios'
import { ElMessage } from 'element-plus'

const request = axios.create({
  baseURL: 'http://localhost:3000',
  timeout: 30000
})

// è¯·æ±‚æ‹¦æˆª: æ·»åŠ Tokenã€é˜²ç¼“å­˜
request.interceptors.request.use(config => {
  const token = localStorage.getItem('admin_token')
  if (token) config.headers.Authorization = `Bearer ${token}`
  return config
})

// å“åº”æ‹¦æˆª: é”™è¯¯ç»Ÿä¸€å¤„ç†ã€401è·³è½¬ç™»å½•
request.interceptors.response.use(
  response => response.data,
  error => {
    ElMessage.error(error.message || 'ç½‘ç»œé”™è¯¯')
    return Promise.reject(error)
  }
)

export default request
```

---

### 5. é¦–é¡µç»„ä»¶ (Home.vue)

**å…³é”®åŠŸèƒ½ä»£ç **:

#### A. Bannerè½®æ’­
```vue
<el-carousel :interval="5000" height="600px">
  <el-carousel-item v-for="banner in banners" :key="banner.id">
    <div :style="{ backgroundImage: `url(${banner.imageUrl})` }">
      <h1>{{ banner.title }}</h1>
    </div>
  </el-carousel-item>
</el-carousel>
```

#### B. AIæ™ºèƒ½ä½“å¡ç‰‡
```vue
<div class="agents-grid">
  <div v-for="agent in aiAgents" :key="agent.id" @click="goToAgent(agent)">
    <el-icon><component :is="agent.icon" /></el-icon>
    <h3>{{ agent.name }}</h3>
  </div>
</div>
```

#### C. æ‹–æ‹½æ’åº
```vue
<draggable v-model="productSeries" :disabled="!draggableEnabled" @end="saveDraggableOrder">
  <div v-for="series in productSeries" :key="series.id">...</div>
</draggable>

<script setup>
const enableDraggable = () => {
  draggableEnabled.value = true
}

const saveDraggableOrder = () => {
  localStorage.setItem('productSeriesOrder', JSON.stringify(productSeries.value))
}

// å¿«æ·é”® Ctrl+Shift+D
onMounted(() => {
  window.addEventListener('keydown', (e) => {
    if (e.ctrlKey && e.shiftKey && e.key === 'D') {
      e.preventDefault()
      enableDraggable()
    }
  })
})
</script>
```

#### D. å¡ç‰‡å°ºå¯¸ç¼©å°30%
```scss
// æ˜æ˜Ÿäº§å“
.product-media { height: 280px; } /* 400â†’280 */
.product-info { padding: 22px; }  /* 32â†’22 */
.product-info h3 { font-size: 17px; } /* 24â†’17 */

// äº§å“æœåŠ¡
.series-image { height: 168px; }  /* 240â†’168 */
.series-info { padding: 20px; }   /* 28â†’20 */
.series-info h3 { font-size: 15px; } /* 22â†’15 */
```

---

### 6. æ˜å‡AICRMç»„ä»¶ (MingShengAICRM_V3.vue)

#### A. è·¯ç”±å‚æ•°å¤„ç†
```javascript
import { useRoute } from 'vue-router'

const route = useRoute()
const activeTab = ref('customer360')

// ç›‘å¬URLå‚æ•°åˆ‡æ¢æ ‡ç­¾é¡µ
watch(() => route.query.tab, (newTab) => {
  if (newTab) activeTab.value = newTab
}, { immediate: true })
```

#### B. AIMESå¥åº·æŒ‡æ•°å›¾
```javascript
const initHealthIndexChart = () => {
  const chart = echarts.init(healthIndexChartRef.value)
  chart.setOption({
    title: { text: 'è®¾å¤‡å¥åº·æŒ‡æ•°è¶‹åŠ¿' },
    xAxis: {
      data: ['12/14', '12/15', '12/16', '12/17', '12/18', '12/19', '12/20']
    },
    series: [
      {
        name: 'CNC-B02',
        type: 'line',
        data: [85, 82, 78, 75, 70, 68, 68],
        itemStyle: { color: '#F56C6C' }
      },
      {
        name: 'ç„Šæ¥æœºå™¨äºº-W05',
        data: [88, 89, 87, 86, 85, 85, 86],
        itemStyle: { color: '#67C23A' }
      }
    ]
  })
}

// ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢åˆå§‹åŒ–å›¾è¡¨
watch(activeTab, (newTab) => {
  if (newTab === 'aimes') {
    setTimeout(() => initHealthIndexChart(), 100)
  }
})
```

#### C. MESæ•°æ®æ¥å£é…ç½®
```vue
<el-dialog v-model="mesConfigVisible" title="MESæ•°æ®æ¥å£é…ç½®">
  <el-form :model="mesConfig">
    <el-form-item label="ç³»ç»Ÿç±»å‹">
      <el-select v-model="mesConfig.systemType">
        <el-option label="SAP" value="SAP" />
        <el-option label="Oracle" value="Oracle" />
      </el-select>
    </el-form-item>
    <el-form-item label="APIåœ°å€">
      <el-input v-model="mesConfig.apiUrl" />
    </el-form-item>
  </el-form>
  <template #footer>
    <el-button @click="testMESConnection">æµ‹è¯•è¿æ¥</el-button>
    <el-button type="primary" @click="startMESSync">å¯åŠ¨åŒæ­¥</el-button>
  </template>
</el-dialog>
```

---

### 7. åç«¯æœåŠ¡å™¨ (server/index.js)

```javascript
const express = require('express')
const cors = require('cors')
const sqlite3 = require('sqlite3').verbose()

const app = express()
const PORT = 3000

app.use(cors())
app.use(express.json({ limit: '50mb' }))
app.use('/uploads', express.static('uploads'))

// æ•°æ®åº“è¿æ¥
const db = new sqlite3.Database('./database/aiweb.db', (err) => {
  if (!err) console.log('âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ')
})

// è·¯ç”±æ³¨å†Œ
app.use('/api/equipment', require('./routes/equipment')(db))
app.use('/api/aimes', require('./routes/aimes')(db))

app.listen(PORT, () => {
  console.log(`ğŸš€ æœåŠ¡å™¨å·²å¯åŠ¨: http://localhost:${PORT}`)
})
```

---

### 8. è®¾å¤‡ç®¡ç†è·¯ç”± (server/routes/equipment.js)

```javascript
const express = require('express')

module.exports = (db) => {
  const router = express.Router()

  // è·å–è®¾å¤‡åˆ—è¡¨
  router.get('/', (req, res) => {
    const { status, search } = req.query
    let sql = 'SELECT * FROM equipment WHERE 1=1'
    const params = []

    if (status) {
      sql += ' AND status = ?'
      params.push(status)
    }

    db.all(sql, params, (err, rows) => {
      res.json({ success: true, data: rows })
    })
  })

  // åˆ›å»ºè®¾å¤‡
  router.post('/', (req, res) => {
    const { code, name, category } = req.body
    const sql = 'INSERT INTO equipment (code, name, category) VALUES (?, ?, ?)'
    
    db.run(sql, [code, name, category], function(err) {
      if (err) return res.status(500).json({ success: false, message: err.message })
      res.json({ success: true, id: this.lastID })
    })
  })

  // æ›´æ–°è®¾å¤‡
  router.put('/:id', (req, res) => {
    const { name, status, health_index } = req.body
    const sql = 'UPDATE equipment SET name=?, status=?, health_index=? WHERE id=?'
    
    db.run(sql, [name, status, health_index, req.params.id], (err) => {
      res.json({ success: true })
    })
  })

  return router
}
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

#### è®¾å¤‡è¡¨ (equipment)
```sql
CREATE TABLE equipment (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  code VARCHAR(50) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  status VARCHAR(20) DEFAULT 'idle',
  health_index DECIMAL(5,2) DEFAULT 100,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

#### å·¥å•è¡¨ (maintenance_order)
```sql
CREATE TABLE maintenance_order (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  order_no VARCHAR(50) UNIQUE,
  equipment_id INTEGER,
  priority VARCHAR(20),
  status VARCHAR(20) DEFAULT 'pending',
  FOREIGN KEY (equipment_id) REFERENCES equipment(id)
);
```

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ‹–æ‹½æ’åº
- **åº“**: vuedraggable
- **è§¦å‘**: `Ctrl+Shift+D` æˆ–ç‚¹å‡»"æ‹–æ‹½æ’åº"æŒ‰é’®
- **ä¿å­˜**: localStorageæŒä¹…åŒ–

### 2. EChartså›¾è¡¨
- **åˆå§‹åŒ–**: nextTickä¸­åˆ›å»ºå®ä¾‹
- **å“åº”å¼**: window.resizeç›‘å¬
- **3Dæ”¯æŒ**: echarts-glåº“

### 3. æ–‡ä»¶ä¸Šä¼ 
- **åç«¯**: multerä¸­é—´ä»¶
- **é™åˆ¶**: 50MBã€æ”¯æŒå›¾ç‰‡/è§†é¢‘/æ–‡æ¡£
- **å­˜å‚¨**: server/uploadsç›®å½•

### 4. å¿«æ·é”®
| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| Ctrl+Shift+Q | å¿«é€Ÿè®¿é—®è®¾å¤‡é¡µé¢ |
| Ctrl+Shift+D | å¼€å¯æ‹–æ‹½æ¨¡å¼ |
| Ctrl+Shift+I | è¯¢ç›˜æŒ‰é’®æ‹–æ‹½ |
| Ctrl+Shift+R | åˆ·æ–°å›¾è¡¨æ•°æ® |

---

## ğŸš€ éƒ¨ç½²é…ç½®

### å‰ç«¯æ„å»º
```bash
npm run build
# è¾“å‡º: dist/
```

### åç«¯å¯åŠ¨
```bash
cd server
node index.js
# ç«¯å£: 3000
```

### ç¯å¢ƒå˜é‡
```env
VITE_API_BASE_URL=http://localhost:3000
PORT=3000
```

---

## ğŸ“ ä»£ç è§„èŒƒ

### å‘½åè§„èŒƒ
- **ç»„ä»¶**: PascalCase (HomeLayout.vue)
- **å˜é‡**: camelCase (productList)
- **å¸¸é‡**: UPPER_CASE (API_BASE_URL)
- **æ–‡ä»¶**: kebab-case (user-profile.vue)

### æ³¨é‡Šè§„èŒƒ
```javascript
/**
 * è·å–è®¾å¤‡åˆ—è¡¨
 * @param {Object} filters ç­›é€‰æ¡ä»¶
 * @returns {Promise<Array>}
 */
async function getEquipmentList(filters) {
  // å®ç°ä»£ç 
}
```

---

## ğŸ“‹ æ–‡ä»¶æ¸…å•

**å‰ç«¯æ ¸å¿ƒæ–‡ä»¶** (16ä¸ª):
- src/main.js
- src/App.vue
- src/router/index.js
- src/store/index.js
- src/utils/request.js
- src/views/Home.vue (~1800è¡Œ)
- src/views/MingShengAICRM_V3.vue (~4200è¡Œ)
- src/views/EquipmentLifecycle.vue (~2800è¡Œ)
- src/components/Header.vue
- src/components/AiChat.vue
- src/components/InquiryForm.vue

**åç«¯æ ¸å¿ƒæ–‡ä»¶** (6ä¸ª):
- server/index.js (~150è¡Œ)
- server/routes/equipment.js
- server/routes/products.js
- server/routes/cms.js
- server/routes/aimes.js
- server/database/aiweb.db

**é…ç½®æ–‡ä»¶** (3ä¸ª):
- package.json
- vite.config.js
- .gitignore

---

## ğŸ”„ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä»£ç å˜æ›´ |
|-----|------|---------|
| v2.5.0 | 2025-12-20 | å¡ç‰‡ç¼©å°30%ã€AIMESä¸‰å¤§åŠŸèƒ½ã€è¯¢ç›˜æ‹–æ‹½ |
| v2.4.0 | 2025-12-19 | è®¾å¤‡å¿«æ·é”®ã€å¡ç‰‡ç¼©å°20% |
| v2.3.0 | 2025-12-18 | AICRMæ·±åº¦ä¼˜åŒ–ã€æ²™ç›˜åˆ†æ |

---

**æ–‡æ¡£ç»“æŸ**
