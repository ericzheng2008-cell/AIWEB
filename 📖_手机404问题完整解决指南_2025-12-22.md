# 📖 手机404问题完整解决指南

**版本**: v1.0  
**日期**: 2025-12-22  
**问题**: 手机访问AIWEB提示404错误

---

## 🎯 问题分析

手机提示404错误,通常是以下原因之一:

| 原因 | 可能性 | 解决方案 |
|-----|--------|---------|
| **服务未启动** | ⭐⭐⭐⭐⭐ | 启动前后端服务 |
| **WiFi不同** | ⭐⭐⭐⭐ | 连接同一WiFi |
| **防火墙阻止** | ⭐⭐⭐⭐ | 配置防火墙规则 |
| **IP地址错误** | ⭐⭐⭐ | 使用正确IP |
| **端口号错误** | ⭐⭐⭐ | 使用3002端口 |
| **路由器隔离** | ⭐⭐ | 关闭AP隔离 |

---

## ✅ 快速解决方案

### 方案一: 一键修复（推荐）

双击运行以下文件:
```
🔧_手机404问题快速修复_2025-12-22.bat
```

**功能**:
- ✅ 自动检测服务状态
- ✅ 自动启动前后端服务
- ✅ 自动配置防火墙
- ✅ 显示正确访问地址
- ✅ 提供详细检查清单

---

### 方案二: 手动排查

#### 第1步: 检查服务是否启动

**打开命令提示符,执行**:
```batch
netstat -ano | findstr :3002
netstat -ano | findstr :5000
```

**应该看到**:
```
TCP    0.0.0.0:3002           0.0.0.0:0              LISTENING       12345
TCP    0.0.0.0:5000           0.0.0.0:0              LISTENING       12346
```

**如果没有显示**:
```batch
:: 启动后端
cd C:\Users\EricZ\CodeBuddy\AIWEB1\server
start cmd /k "node index.js"

:: 启动前端（新开窗口）
cd C:\Users\EricZ\CodeBuddy\AIWEB1
start cmd /k "npm run dev"
```

---

#### 第2步: 确认电脑IP地址

**查看IP**:
```batch
ipconfig
```

**找到IPv4地址**,例如:
```
IPv4 地址 . . . . . . . . . . . . : 192.168.31.105
```

**正确的手机访问地址**:
```
http://192.168.31.105:3002
```

**❌ 常见错误地址**:
```
http://127.0.0.1:3002         (错误: 只能本机访问)
http://localhost:3002         (错误: 只能本机访问)
http://192.168.31.105:5173    (错误: 端口号错误)
http://192.168.31.105:3002/index.html  (错误: 多余路径)
```

---

#### 第3步: 确认WiFi连接

**关键要求**: 手机和电脑必须连接同一个WiFi!

**检查方法**:

1. **电脑上查看WiFi名称**
   - 点击右下角WiFi图标
   - 查看"已连接"的WiFi名称
   - 例如: `TP-LINK_5G_ABC123`

2. **手机上查看WiFi名称**
   - 打开设置 → WiFi
   - 查看当前连接的WiFi
   - 必须与电脑WiFi名称完全一致!

**❌ 常见错误**:
- 电脑连: `TP-LINK_5G`
- 手机连: `TP-LINK_2.4G` (不同WiFi!)

- 电脑连: `公司WiFi-5G`
- 手机连: `4G/5G移动数据` (根本不在局域网!)

---

#### 第4步: 配置防火墙

**以管理员身份运行PowerShell**:

```powershell
# 允许3002端口（前端）
netsh advfirewall firewall add rule name="AIWEB Frontend" dir=in action=allow protocol=TCP localport=3002

# 允许5000端口（后端）
netsh advfirewall firewall add rule name="AIWEB Backend" dir=in action=allow protocol=TCP localport=5000

# 验证规则
netsh advfirewall firewall show rule name="AIWEB Frontend"
```

**临时测试方法**（关闭防火墙）:
```powershell
# 临时关闭防火墙
netsh advfirewall set allprofiles state off

# 测试手机访问

# 测试后记得开启!!!
netsh advfirewall set allprofiles state on
```

---

#### 第5步: 测试访问

**测试顺序**:

1. **电脑浏览器测试localhost**
   ```
   http://localhost:3002
   ```
   ✅ 应该能正常打开

2. **电脑浏览器测试IP**
   ```
   http://192.168.31.105:3002
   ```
   ✅ 应该能正常打开

3. **手机浏览器测试**
   ```
   http://192.168.31.105:3002
   ```
   ✅ 应该能正常打开

**如果第1步失败**: 服务未启动,返回第1步
**如果第2步失败**: 防火墙阻止,返回第4步
**如果第3步失败**: WiFi问题,返回第3步

---

## 🔍 常见404场景诊断

### 场景1: 手机输入地址后直接404

**可能原因**: 服务未启动

**解决方案**:
1. 检查电脑上是否有两个命令行窗口在运行
2. 如果没有,双击 `⚡_一键启动AIWEB_2025-12-22.bat`
3. 等待30秒后再测试

---

### 场景2: 加载很久后显示404

**可能原因**: WiFi不同或网络隔离

**解决方案**:
1. 确认手机和电脑在同一WiFi
2. 检查路由器是否开启了AP隔离功能
3. 尝试在路由器设置中关闭"无线隔离"

**路由器设置方法**（通用）:
```
1. 浏览器访问: 192.168.1.1 或 192.168.0.1
2. 登录路由器管理界面
3. 找到: 无线设置 → 高级设置
4. 关闭: AP隔离 / 无线隔离 / 用户隔离
5. 保存并重启路由器
```

---

### 场景3: 偶尔能访问,偶尔404

**可能原因**: 服务不稳定或端口被占用

**解决方案**:
1. 关闭所有命令行窗口
2. 打开任务管理器,结束所有node.exe进程
3. 重新启动服务

---

### 场景4: 电脑能访问,手机404

**可能原因**: 防火墙阻止

**解决方案**:
1. 临时关闭电脑防火墙测试
2. 如果能访问,说明是防火墙问题
3. 按第4步配置防火墙规则
4. 开启防火墙后再测试

---

## 🚀 替代方案

### 方案A: 使用cpolar内网穿透

**优点**:
- ✅ 不受WiFi限制
- ✅ 手机可以用4G/5G访问
- ✅ 可以异地访问

**操作**:
1. 参考文档: `🌐_异地手机访问快速方案_2025-12-21.md`
2. 或运行: `🌐_一键生成cpolar链接_2025-12-21.bat`

---

### 方案B: 生产构建 + HTTP服务器

**适用场景**: 长期测试,追求性能

**操作**:
```batch
:: 1. 构建生产版本
npm run build

:: 2. 安装HTTP服务器
npm install -g serve

:: 3. 启动服务
serve dist -p 3002

:: 4. 访问
http://192.168.31.105:3002
```

---

## 📊 完整检查清单

### 服务检查
- [ ] 后端服务正在运行（端口5000）
- [ ] 前端服务正在运行（端口3002）
- [ ] 本地浏览器能访问 `http://localhost:3002`
- [ ] 本地浏览器能访问 `http://[本机IP]:3002`

### 网络检查
- [ ] 电脑已连接WiFi（不是有线网络）
- [ ] 手机已连接同一个WiFi
- [ ] WiFi名称完全一致（包括2.4G/5G）
- [ ] 路由器未开启AP隔离

### 防火墙检查
- [ ] 已添加3002端口入站规则
- [ ] 已添加5000端口入站规则
- [ ] 或临时关闭防火墙测试通过

### 地址检查
- [ ] 使用正确的IP地址（不是127.0.0.1）
- [ ] 使用正确的端口（3002）
- [ ] URL格式正确（http://IP:3002）
- [ ] 没有多余的路径（如/index.html）

### 手机检查
- [ ] 浏览器缓存已清除
- [ ] 尝试无痕/隐私模式
- [ ] 尝试其他浏览器（Chrome/Safari）
- [ ] WiFi已重新连接

---

## 🔧 调试工具

### 1. 网络连通性测试

**在电脑上测试手机是否能连接**:
```batch
:: 获取手机IP（在手机WiFi设置中查看）
:: 假设手机IP是: 192.168.31.200

ping 192.168.31.200
```

**能ping通**: ✅ 网络正常
**ping不通**: ❌ 网络隔离或防火墙问题

---

### 2. 端口测试

**使用telnet测试端口**:
```batch
:: 启用telnet（如果未启用）
dism /online /Enable-Feature /FeatureName:TelnetClient

:: 测试3002端口
telnet 192.168.31.105 3002
```

**连接成功**: ✅ 端口可访问
**连接失败**: ❌ 防火墙阻止或服务未启动

---

### 3. 浏览器开发者工具

**在手机浏览器中**（以Chrome为例）:
1. 访问 `http://192.168.31.105:3002`
2. 点击右上角"⋮"
3. 选择"桌面版网站"（强制刷新）
4. 长按刷新按钮
5. 选择"清空缓存并强制刷新"

---

## 💡 预防措施

### 1. 使用固定IP

**避免IP频繁变化**:
```
1. 打开路由器管理界面
2. 找到: DHCP设置 → 静态IP绑定
3. 绑定电脑MAC地址到固定IP
4. 例如: 192.168.31.105
```

---

### 2. 创建快捷启动脚本

**一键启动并显示地址**:
```batch
@echo off
:: 详见已创建的 🔧_手机404问题快速修复_2025-12-22.bat
```

---

### 3. 添加手机书签

**在手机浏览器中**:
1. 访问成功后
2. 点击"添加书签"
3. 保存为"AIWEB测试"
4. 下次直接点击书签访问

---

## 📞 技术支持

### 如果以上方案都无效

**可能是特殊网络环境问题**:

1. **企业网络**: 可能有严格的防火墙策略
   - 联系IT部门协助
   
2. **运营商光猫**: 可能有端口限制
   - 改用cpolar内网穿透
   
3. **公共WiFi**: 可能有设备隔离
   - 使用手机热点测试

---

## 🎯 推荐操作流程

### 最快解决方案（5分钟）

```batch
1. 双击运行: 🔧_手机404问题快速修复_2025-12-22.bat
2. 等待自动检测和修复完成
3. 复制显示的访问地址
4. 在手机浏览器粘贴访问
5. 如果还是404,按提示检查WiFi
```

---

**文档版本**: v1.0  
**创建日期**: 2025-12-22  
**适用问题**: 手机访问提示404错误
