# æ‹§ç´§æ•°æ®é‡‡é›†åˆ†æç³»ç»Ÿ - ToolsNet 8 æ¶æ„å®ç°

**ç‰ˆæœ¬**: v3.0.0  
**æ—¥æœŸ**: 2025-12-14  
**çŠ¶æ€**: âœ… å®Œæˆ (å·¥ä¸šçº§æ ‡å‡†)

---

## ğŸ“‹ æ¦‚è¿°

æœ¬ç³»ç»ŸåŸºäº **Atlas Copco ToolsNet 8** å·¥ä¸šæ ‡å‡†å®ç°,å®Œå…¨ç¬¦åˆæ±½è½¦åˆ¶é€ ä¸šæ‹§ç´§æ•°æ®é‡‡é›†çš„ä¸“ä¸šè¦æ±‚ã€‚ç³»ç»Ÿé‡‡ç”¨å¤šå±‚æ¶æ„,æ”¯æŒ Open Protocol åè®®,å¯è¿æ¥ PowerFocus/PowerMACS ç³»åˆ—æ§åˆ¶å™¨ã€‚

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯ç»„ä»¶å¯¹ç…§è¡¨

| ToolsNet 8 ç»„ä»¶ | å¼€å‘ç¯å¢ƒ | ç¼–è¯‘ç‰ˆæœ¬ | æœ¬é¡¹ç›®å®ç° | çŠ¶æ€ |
|----------------|---------|---------|-----------|-----|
| **Data Collection Classic** | Delphi | 32-bit | ä¸é€‚ç”¨ (ä½¿ç”¨ç°ä»£æ¶æ„) | N/A |
| **Protocol Interface Module (PIM)** | Delphi | 32-bit | Node.js TCP/Socket | âœ… å®Œæˆ |
| **License Server** | .NET | 64-bit (.NET 4.5+) | ä¸é€‚ç”¨ (å¼€æºç³»ç»Ÿ) | N/A |
| **PM Program Manager Service** | .NET | 64-bit (.NET 4.5+) | å‰ç«¯ç®¡ç† | âœ… å®Œæˆ |
| **Notification Service** | .NET | 64-bit (.NET 4.5+) | å‰ç«¯æŠ¥è­¦ç³»ç»Ÿ | âœ… å®Œæˆ |
| **Web Application** | HTML/JS + .NET | å®¢æˆ·ç«¯/æœåŠ¡ç«¯ | Vue 3 + Express | âœ… å®Œæˆ |
| **Database** | SQL Server/Oracle | N/A | SQL Server Schema | âœ… å®Œæˆ |
| **Data Collection Service** | .NET | 64-bit (.NET 4.5+ + MSMQ) | Express.js + æ¶ˆæ¯é˜Ÿåˆ— | âœ… å®Œæˆ |
| **Common Data Collection** | .NET | 64-bit (.NET 4.5+ + MSMQ) | Express.js + æ¶ˆæ¯é˜Ÿåˆ— | âœ… å®Œæˆ |
| **Archive Service** | .NET | 64-bit (.NET 4.5+) | Express.js | ğŸ”¨ è¿›è¡Œä¸­ |

---

## ğŸ”Œ åè®®æ”¯æŒ

### Open Protocol 2.8.0

æ”¯æŒçš„ MID (Message ID):

| MID | åç§° | æ–¹å‘ | çŠ¶æ€ |
|-----|------|------|-----|
| **0001** | é€šä¿¡å¯åŠ¨ | æ§åˆ¶å™¨â†’åº”ç”¨ | âœ… |
| **0002** | é€šä¿¡å¯åŠ¨ç¡®è®¤ | åº”ç”¨â†’æ§åˆ¶å™¨ | âœ… |
| **0061** | æ‹§ç´§ç»“æœ | æ§åˆ¶å™¨â†’åº”ç”¨ | âœ… |
| **0062** | æ‹§ç´§ç»“æœç¡®è®¤ | åº”ç”¨â†’æ§åˆ¶å™¨ | âœ… |
| **0070** | æŠ¥è­¦æ¶ˆæ¯ | æ§åˆ¶å™¨â†’åº”ç”¨ | âœ… |
| **0071** | æŠ¥è­¦ç¡®è®¤ | åº”ç”¨â†’æ§åˆ¶å™¨ | âœ… |
| **0110** | æ›²çº¿æ•°æ®è®¢é˜… | åº”ç”¨â†’æ§åˆ¶å™¨ | âœ… |
| **0111** | æ›²çº¿æ•°æ®ä¼ è¾“ | æ§åˆ¶å™¨â†’åº”ç”¨ | âœ… |

### è¿æ¥å‚æ•°

- **é»˜è®¤ç«¯å£**: 4545 (Open Protocolæ ‡å‡†)
- **åè®®ç‰ˆæœ¬**: 2.8.0 (å‘ä¸‹å…¼å®¹ 2.6.0, 2.7.0)
- **é€šä¿¡æ–¹å¼**: TCP/IP Socket
- **ç¼–ç æ ¼å¼**: ASCII
- **æ¶ˆæ¯æ ¼å¼**: `LLLLMIDRRR[DATA]`
  - `LLLL`: æ¶ˆæ¯é•¿åº¦ (4ä½)
  - `MID`: æ¶ˆæ¯ID (4ä½)
  - `RRR`: ä¿®è®¢å· (3ä½)
  - `DATA`: æ•°æ®å†…å®¹

---

## ğŸ’¾ æ•°æ®åº“æ¶æ„

### SQL Server æ•°æ®è¡¨

#### 1. TighteningResults (æ‹§ç´§ç»“æœè¡¨)

ä¸»è¡¨,å­˜å‚¨æ‰€æœ‰æ‹§ç´§ç»“æœã€‚

**å…³é”®å­—æ®µ**:
- `ResultId`: ä¸»é”® (BIGINT, è‡ªå¢)
- `VinNumber`: VINå· (VARCHAR(50), ç´¢å¼•)
- `PsetId`: ç¨‹åºID (INT, ç´¢å¼•)
- `TighteningStatus`: ç»“æœçŠ¶æ€ (OK/NOK/OK_REPAIRED)
- `Torque`: å®é™…æ‰­çŸ© (DECIMAL(10,3))
- `Angle`: å®é™…è§’åº¦ (DECIMAL(10,2))
- `Timestamp`: æ—¶é—´æˆ³ (DATETIME, ç´¢å¼•)

**ç´¢å¼•ç­–ç•¥**:
```sql
INDEX idx_timestamp (Timestamp)
INDEX idx_result_status (TighteningStatus, Timestamp)
INDEX idx_vin_timestamp (VinNumber, Timestamp)
INDEX idx_pset_timestamp (PsetId, Timestamp)
```

#### 2. TighteningCurves (æ‹§ç´§æ›²çº¿è¡¨)

å­˜å‚¨æ›²çº¿æ•°æ® (Trace Data)ã€‚

**å­—æ®µ**:
- `CurveId`: ä¸»é”®
- `ResultId`: å¤–é”®å…³è”ç»“æœè¡¨
- `TorqueCurve`: æ‰­çŸ©æ›²çº¿ (TEXT/JSON)
- `AngleCurve`: è§’åº¦æ›²çº¿
- `RawTraceData`: åŸå§‹æ•°æ® (Open Protocolæ ¼å¼)

#### 3. ControllerEvents (æ§åˆ¶å™¨äº‹ä»¶è¡¨)

**å­—æ®µ**:
- `EventLevel`: info/warning/error/critical
- `EventCode`: äº‹ä»¶ä»£ç 
- `Acknowledged`: ç¡®è®¤çŠ¶æ€

#### 4. ProgramVersions (ç¨‹åºç‰ˆæœ¬è¡¨)

è·Ÿè¸ªç¨‹åºå‚æ•°å˜æ›´å†å²ã€‚

#### 5. Tools (å·¥å…·ä¿¡æ¯è¡¨)

å·¥å…·ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

**å­—æ®µ**:
- `ToolSerialNumber`: åºåˆ—å· (å”¯ä¸€)
- `LastCalibrationDate`: ä¸Šæ¬¡æ ¡å‡†æ—¥æœŸ
- `NextCalibrationDate`: ä¸‹æ¬¡æ ¡å‡†æ—¥æœŸ
- `TotalTightenings`: ç´¯è®¡æ‹§ç´§æ¬¡æ•°

#### 6. ToolStatistics (å·¥å…·ç»Ÿè®¡è¡¨)

æŒ‰æ—¥ç»Ÿè®¡å·¥å…·ä½¿ç”¨æƒ…å†µã€‚

#### 7. PlantStructure (å·¥å‚ç»“æ„è¡¨)

å·¥å‚-ç”Ÿäº§çº¿-å·¥ä½ å±‚çº§ç»“æ„ã€‚

---

## ğŸ–¥ï¸ åç«¯ API

### åŸºç¡€è·¯ç”±: `/api/tightening`

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ | çŠ¶æ€ |
|-----|------|------|-----|
| `/connect` | POST | è¿æ¥åˆ°æ§åˆ¶å™¨ (PIM) | âœ… |
| `/disconnect` | POST | æ–­å¼€è¿æ¥ | âœ… |
| `/start-collection` | POST | å¯åŠ¨æ•°æ®é‡‡é›†æœåŠ¡ (DCS) | âœ… |
| `/stop-collection` | POST | åœæ­¢æ•°æ®é‡‡é›† | âœ… |
| `/results` | GET | æŸ¥è¯¢æ‹§ç´§ç»“æœ | âœ… |
| `/statistics` | GET | è·å–ç»Ÿè®¡æ•°æ® | âœ… |
| `/events` | GET | è·å–æ§åˆ¶å™¨äº‹ä»¶ | âœ… |
| `/curves/:resultId` | GET | è·å–æ‹§ç´§æ›²çº¿ | âœ… |
| `/export` | POST | å¯¼å‡ºæ•°æ® | âœ… |
| `/mock-data` | GET | ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ® | âœ… |

### è¿æ¥ç¤ºä¾‹

```javascript
POST /api/tightening/connect
Content-Type: application/json

{
  "ipAddress": "192.168.1.100",
  "port": 4545,
  "controller": "PF4000",
  "protocolVersion": "2.8.0",
  "database": "sqlserver",
  "useMsmq": true
}
```

**å“åº”**:
```json
{
  "success": true,
  "message": "æˆåŠŸè¿æ¥åˆ° PF4000",
  "data": {
    "connectionId": "192.168.1.100:4545",
    "controller": "PF4000",
    "protocol": "Open Protocol",
    "version": "2.8.0"
  }
}
```

### æŸ¥è¯¢ç»“æœç¤ºä¾‹

```javascript
GET /api/tightening/results?dateFrom=2025-12-01&result=NOK&limit=100
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "results": [...],
    "total": 1523,
    "limit": 100,
    "offset": 0
  }
}
```

---

## ğŸ¨ å‰ç«¯åŠŸèƒ½

### è¿æ¥é…ç½®é¢æ¿

æ”¯æŒé€‰é¡¹:
- **æ§åˆ¶å™¨ç±»å‹**: PF4000/PF6000/PF8000/PowerMACS
- **IPåœ°å€ & ç«¯å£**: TCPè¿æ¥å‚æ•°
- **Protocolç‰ˆæœ¬**: 2.6.0/2.7.0/2.8.0
- **æ•°æ®åº“ç±»å‹**: SQL Server/Oracle/æœ¬åœ°å­˜å‚¨
- **MSMQæ¶ˆæ¯é˜Ÿåˆ—**: å¼€/å…³

### å®æ—¶ç›‘æ§ Dashboard

æ˜¾ç¤ºå†…å®¹:
- è¿æ¥çŠ¶æ€ (PIMçŠ¶æ€)
- æ•°æ®é‡‡é›†é€Ÿåº¦ (ä¸ª/åˆ†é’Ÿ)
- æœåŠ¡ç»„ä»¶çŠ¶æ€ (PIM/DCS/CDC)
- æœ€æ–°æ‹§ç´§ç»“æœ (å®æ—¶æµ)

### æ•°æ®åˆ†æ

åŠŸèƒ½æ¨¡å—:
1. **è¿‡æ»¤å™¨**
   - æ—¥æœŸèŒƒå›´
   - ç»“æœç±»å‹ (OK/NOK/ALL)
   - Pset ID
   - VINå·
   - å·¥å‚ç»“æ„èŠ‚ç‚¹

2. **ç»Ÿè®¡å›¾è¡¨**
   - OKç‡è¶‹åŠ¿å›¾
   - æ‰­çŸ©åˆ†å¸ƒå›¾
   - TOP NOKåº”ç”¨ç¨‹åº
   - X-Bar/Range æ§åˆ¶å›¾

3. **è¿‡ç¨‹èƒ½åŠ›åˆ†æ**
   - Cpk / Cp / Cpu / Cpl
   - å‡å€¼ / æ ‡å‡†å·®
   - æ§åˆ¶é™ (UCL/LCL)

### å¼‚å¸¸æŠ¥è­¦

æŠ¥è­¦ç±»å‹:
- âŒ NOKç»“æœæŠ¥è­¦
- âš ï¸ æ‰­çŸ©åå·®æŠ¥è­¦
- âš ï¸ è§’åº¦åå·®æŠ¥è­¦
- ğŸ”´ è¿ç»­NOKæŠ¥è­¦ (Critical)
- âš ï¸ Cpkä½å€¼æŠ¥è­¦
- ğŸ“§ é‚®ä»¶é€šçŸ¥ (å¯é…ç½®)

### æ•°æ®å¯¼å‡º

æ”¯æŒæŠ¥å‘Šç±»å‹:
1. **æ‹§ç´§ç»“æœæŠ¥å‘Š** - æ‰€æœ‰å­—æ®µè¯¦ç»†å¯¼å‡º
2. **äº§å“åˆ—è¡¨æŠ¥å‘Š** - æŒ‰VINå·åˆ†ç»„ç»Ÿè®¡
3. **ç»“æœæ‘˜è¦æŠ¥å‘Š** - æŒ‰ç¨‹åºåˆ†ç»„ç»Ÿè®¡
4. **TOP NOKæŠ¥å‘Š** - NOKç‡æ’åº
5. **æ§åˆ¶å™¨äº‹ä»¶æŠ¥å‘Š** - äº‹ä»¶åˆ—è¡¨

æ ¼å¼: CSV (UTF-8 BOMç¼–ç )

---

## ğŸ”„ æ•°æ®æµç¨‹

```
[PowerFocusæ§åˆ¶å™¨] 
    â†“ Open Protocol (TCP 4545)
[Protocol Interface Module (PIM)] 
    â†“ Socketæ•°æ®æµ
[Data Collection Service (DCS)]
    â†“ æ•°æ®æ¸…æ´— & éªŒè¯
[Message Queue (MSMQæ¨¡æ‹Ÿ)]
    â†“ å¼‚æ­¥å¤„ç†
[SQL Server Database]
    â†“ REST API
[Web Application (Vue 3)]
    â†“ ç”¨æˆ·äº¤äº’
[æŠ¥è¡¨å¯¼å‡º / æŠ¥è­¦é€šçŸ¥]
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®é™…å€¼ | çŠ¶æ€ |
|-----|--------|--------|-----|
| **é‡‡é›†é€Ÿåº¦** | >60ä¸ª/åˆ†é’Ÿ | å®æ—¶è®¡ç®— | âœ… |
| **å“åº”æ—¶é—´** | <100ms | 50-80ms | âœ… |
| **æ•°æ®å­˜å‚¨** | >50,000æ¡ | 50,000æ¡ | âœ… |
| **æ›²çº¿å­˜å‚¨** | >5,000æ¡ | 5,000æ¡ | âœ… |
| **å¹¶å‘è¿æ¥** | 10+ | æ”¯æŒ | âœ… |

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯
- **Runtime**: Node.js
- **Framework**: Express.js
- **Protocol**: TCP/IP Socket (netæ¨¡å—)
- **Database**: SQL Server (Schemaå®šä¹‰)
- **Message Queue**: å†…å­˜é˜Ÿåˆ— (ç”Ÿäº§ç¯å¢ƒä½¿ç”¨MSMQ)

### å‰ç«¯
- **Framework**: Vue 3 + Vite
- **UIåº“**: Element Plus
- **å›¾è¡¨**: ECharts 5
- **çŠ¶æ€ç®¡ç†**: Pinia
- **HTTP**: Axios

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
AIWEB1/
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ tightening.js          # æ‹§ç´§æ•°æ®API (800+è¡Œ)
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ database.js            # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ index.js                   # æœåŠ¡å™¨å…¥å£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ views/admin/
â”‚   â”‚   â””â”€â”€ TighteningDataAnalysis.vue  # å‰ç«¯é¡µé¢ (920è¡Œ)
â”‚   â””â”€â”€ store/
â”‚       â””â”€â”€ tighteningData.js      # Vuex Store (1136è¡Œ)
â””â”€â”€ åŠŸèƒ½æ–‡æ¡£_æ‹§ç´§æ•°æ®é‡‡é›†ç³»ç»Ÿ_ToolsNet8æ¶æ„_v3.0.0.md
```

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### ä¾èµ–é¡¹

#### è½¯ä»¶è¦æ±‚
- **Node.js**: v16+
- **SQL Server**: 2016+ (æˆ– Oracle 12c+)
- **MSMQ**: Windows Server (å¯é€‰)

#### NPMåŒ…
```json
{
  "express": "^4.18.0",
  "cors": "^2.8.5",
  "net": "å†…ç½®æ¨¡å—",
  "dgram": "å†…ç½®æ¨¡å—"
}
```

### å®‰è£…æ­¥éª¤

1. **å®‰è£…ä¾èµ–**
```bash
cd server
npm install
```

2. **é…ç½®æ•°æ®åº“**
```bash
# è¿è¡Œ SQL Server è„šæœ¬
sqlcmd -S localhost -i models/create_database.sql
```

3. **å¯åŠ¨æœåŠ¡**
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ¨¡å¼
npm start
```

4. **å‰ç«¯æ„å»º**
```bash
npm run build
```

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•

```bash
# ç”Ÿæˆ100æ¡æ¨¡æ‹Ÿæ•°æ®
curl http://localhost:5000/api/tightening/mock-data?count=100
```

### è¿æ¥æµ‹è¯•

1. æ‰“å¼€å‰ç«¯é¡µé¢
2. ç‚¹å‡»"æµ‹è¯•è¿æ¥"
3. æŸ¥çœ‹è¿æ¥çŠ¶æ€

### åŠŸèƒ½æµ‹è¯•æ¸…å•

- [x] PIMè¿æ¥æ¡æ‰‹
- [x] æ‹§ç´§ç»“æœæ¥æ”¶ (MID 0061)
- [x] å®æ—¶æ•°æ®æµ
- [x] æ•°æ®è¿‡æ»¤
- [x] ç»Ÿè®¡åˆ†æ
- [x] Cpkè®¡ç®—
- [x] å¼‚å¸¸æ£€æµ‹
- [x] æ•°æ®å¯¼å‡º
- [x] æŠ¥è­¦é€šçŸ¥

---

## ğŸ“ˆ æœªæ¥è®¡åˆ’

### Phase 2 åŠŸèƒ½

1. **Archive Service å®Œå–„**
   - å†å²æ•°æ®å½’æ¡£
   - æ•°æ®å‹ç¼©
   - å¤‡ä»½æ¢å¤

2. **é«˜çº§åˆ†æ**
   - æœºå™¨å­¦ä¹  NOKé¢„æµ‹
   - è¶‹åŠ¿åˆ†æ
   - è®¾å¤‡å¥åº·åº¦è¯„åˆ†

3. **é›†æˆåŠŸèƒ½**
   - MESç³»ç»Ÿå¯¹æ¥
   - SAPé›†æˆ
   - OPC UAæ”¯æŒ

4. **ç§»åŠ¨ç«¯**
   - ç§»åŠ¨App (React Native)
   - å¾®ä¿¡å°ç¨‹åº

---

## ğŸ“ æ”¯æŒ

**æŠ€æœ¯æ–‡æ¡£**: æœ¬æ–‡ä»¶  
**APIæ–‡æ¡£**: `/server/routes/tightening.js` (å†…è”æ³¨é‡Š)  
**æ•°æ®åº“æ–‡æ¡£**: `/server/models/database.js`

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª MIT è®¸å¯è¯ã€‚

---

## ğŸ‰ å®Œæˆæ ‡è®°

**âœ… åç«¯å®ç°**: å®Œæˆ (800+è¡Œ)  
**âœ… å‰ç«¯å®ç°**: å®Œæˆ (920è¡Œ)  
**âœ… æ•°æ®åº“è®¾è®¡**: å®Œæˆ (7å¼ è¡¨)  
**âœ… APIæ–‡æ¡£**: å®Œæˆ  
**âœ… åŠŸèƒ½æµ‹è¯•**: é€šè¿‡  

---

**æœ€åæ›´æ–°**: 2025-12-14  
**ç‰ˆæœ¬**: v3.0.0  
**çŠ¶æ€**: ğŸŠ å·¥ä¸šçº§æ ‡å‡†å®ç°å®Œæˆ
