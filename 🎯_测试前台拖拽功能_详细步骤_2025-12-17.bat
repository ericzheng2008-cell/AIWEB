@echo off
chcp 65001 >nul
color 0A
echo.
echo ╔════════════════════════════════════════════════════════════╗
echo ║     🎨 前台拖拽功能测试指南 - 详细步骤                    ║
echo ╚════════════════════════════════════════════════════════════╝
echo.
echo 📋 修复内容:
echo    ✅ 添加紫色拖拽手柄（右上角圆形按钮）
echo    ✅ 分离点击和拖拽区域，解决冲突
echo    ✅ 管理员专享拖拽功能
echo    ✅ 脉冲发光动画提示
echo    ✅ 拖拽成功消息提示
echo.
echo ════════════════════════════════════════════════════════════
echo  第一步：登录后台（获取管理员权限）
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 访问后台登录页: http://localhost:5173/admin/login
echo    2. 输入管理员账号密码
echo    3. 登录成功后，系统会保存 adminToken
echo.
echo ════════════════════════════════════════════════════════════
echo  第二步：打开首页查看拖拽手柄
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 访问首页: http://localhost:5173/
echo    2. 滚动到"产品与服务"模块
echo    3. 观察每个卡片右上角是否有【紫色圆形按钮】
echo    4. 紫色按钮应该有【脉冲发光动画】
echo.
echo    ⚠️ 如果没有紫色按钮，说明未检测到管理员身份
echo       请重新登录后台或检查控制台错误
echo.
echo ════════════════════════════════════════════════════════════
echo  第三步：测试拖拽功能
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 鼠标悬停在【紫色按钮】上
echo       → 光标应变为【手形图标】
echo       → 按钮会【放大1.15倍】
echo.
echo    2. 按住左键拖动
echo       → 卡片应变为【半透明】
echo       → 出现【虚线边框占位】
echo       → 卡片跟随鼠标移动
echo.
echo    3. 移动到新位置后释放鼠标
echo       → 卡片平滑归位
echo       → 弹出【"卡片顺序已保存！"】提示
echo       → 控制台输出新顺序
echo.
echo ════════════════════════════════════════════════════════════
echo  第四步：验证顺序保存
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 按 F5 刷新页面
echo    2. 滚动到"产品与服务"模块
echo    3. 验证卡片顺序是否与拖拽后一致
echo.
echo    ✅ 如果顺序保持不变，说明保存成功！
echo.
echo ════════════════════════════════════════════════════════════
echo  第五步：测试点击功能（确保无冲突）
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 点击卡片【内容区域】（非紫色按钮）
echo    2. 应该正常跳转到对应页面
echo    3. 不应该触发拖拽
echo.
echo    ✅ 点击和拖拽互不干扰！
echo.
echo ════════════════════════════════════════════════════════════
echo  第六步：测试访客模式（退出登录）
echo ════════════════════════════════════════════════════════════
echo.
echo    1. 点击后台右上角【退出登录】
echo    2. 或清除 localStorage 中的 adminToken
echo    3. 刷新首页
echo    4. 观察卡片右上角【紫色按钮消失】
echo    5. 卡片【无法拖拽】，仅可点击
echo.
echo    ✅ 访客无法拖拽，确保安全！
echo.
echo ════════════════════════════════════════════════════════════
echo  🔍 调试工具（浏览器控制台）
echo ════════════════════════════════════════════════════════════
echo.
echo    打开控制台 (F12)，执行以下命令:
echo.
echo    1. 检查管理员身份:
echo       console.log('是否为管理员:', !!localStorage.getItem('adminToken'))
echo.
echo    2. 查看当前顺序:
echo       console.log(JSON.parse(localStorage.getItem('homeProductSeriesOrder')))
echo.
echo    3. 重置顺序:
echo       localStorage.removeItem('homeProductSeriesOrder')
echo       location.reload()
echo.
echo    4. 手动模拟管理员:
echo       localStorage.setItem('adminToken', 'test-token')
echo       location.reload()
echo.
echo ════════════════════════════════════════════════════════════
echo  ⚠️ 常见问题排查
echo ════════════════════════════════════════════════════════════
echo.
echo    问题1: 没有紫色按钮
echo    → 检查是否已登录后台
echo    → 检查控制台是否有 "✅ 管理员身份确认" 日志
echo.
echo    问题2: 拖拽无反应
echo    → 确保拖动的是【紫色按钮】，不是卡片其他区域
echo    → 检查控制台是否有错误
echo.
echo    问题3: 点击变成拖拽
echo    → 点击【内容区域】（图片、文字），不要点紫色按钮
echo.
echo    问题4: 顺序未保存
echo    → 检查控制台是否有 "卡片顺序已更新" 日志
echo    → 检查 localStorage 是否有 homeProductSeriesOrder
echo.
echo ════════════════════════════════════════════════════════════
echo.
echo 🚀 准备开始测试？
echo.
echo    按任意键启动开发服务器并打开首页...
echo.
pause

cd /d "%~dp0"
start http://localhost:5173/
start http://localhost:5173/admin/login
npm run dev
