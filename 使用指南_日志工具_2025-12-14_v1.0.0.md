# 使用指南 - 日志工具

**版本**: v1.0.0  
**日期**: 2025-12-14  
**工具**: Logger Utility

---

## 📋 简介

统一日志工具，支持环境自适应输出、日志记录和导出功能。

---

## 🚀 快速开始

### 1. 导入日志工具

```javascript
import logger from '@/utils/logger'
```

### 2. 基本使用

```javascript
// 普通日志（开发环境显示，生产环境隐藏）
logger.log('这是普通日志')

// 信息日志（开发环境显示，生产环境隐藏）
logger.info('这是信息日志')

// 调试日志（仅开发环境）
logger.debug('这是调试日志', { data: 123 })

// 警告日志（始终记录）
logger.warn('这是警告日志')

// 错误日志（始终输出和记录）
logger.error('这是错误日志', error)
```

---

## 🎯 核心功能

### 1. 环境自适应

```javascript
// 开发环境 (npm run dev)
logger.info('开发模式')  // ✅ 控制台输出

// 生产环境 (npm run build)
logger.info('生产模式')  // ❌ 不输出（但仍记录）
logger.error('错误')     // ✅ 始终输出
```

### 2. 日志级别

| 方法 | 开发环境 | 生产环境 | 用途 |
|------|---------|---------|------|
| `log()` | ✅ 输出 | ❌ 静默 | 普通日志 |
| `info()` | ✅ 输出 | ❌ 静默 | 信息日志 |
| `debug()` | ✅ 输出 | ❌ 静默 | 调试日志 |
| `warn()` | ✅ 输出 | ⚠️ 记录 | 警告日志 |
| `error()` | ✅ 输出 | ✅ 输出 | 错误日志 |

### 3. 日志分组

```javascript
logger.group('用户操作')
logger.info('点击按钮')
logger.info('发送请求')
logger.info('收到响应')
logger.groupEnd()
```

### 4. 日志导出

```javascript
// 导出所有日志到文件
logger.exportLogs()
// 下载: logs_1702540800000.txt
```

---

## 🛠️ 在组件中使用

### Vue组件示例

```vue
<script setup>
import logger from '@/utils/logger'
import { onMounted } from 'vue'

onMounted(() => {
  logger.info('组件已挂载')
})

const handleClick = () => {
  try {
    // 业务逻辑
    logger.debug('处理点击事件', { data: 'test' })
  } catch (error) {
    logger.error('处理失败', error)
  }
}
</script>
```

### Store示例

```javascript
import { defineStore } from 'pinia'
import logger from '@/utils/logger'

export const useMyStore = defineStore('myStore', () => {
  const fetchData = async () => {
    try {
      logger.info('开始获取数据')
      const data = await api.getData()
      logger.info('数据获取成功', data.length)
      return data
    } catch (error) {
      logger.error('数据获取失败', error)
      throw error
    }
  }
  
  return { fetchData }
})
```

---

## 🔧 开发工具

在**开发环境**，日志工具会挂载到全局对象：

```javascript
// 浏览器控制台

// 查看所有日志
window.__logger__.getLogs()

// 查看日志数量
window.__logger__.getLogs().length

// 清空日志
window.__logger__.clearLogs()

// 导出日志
window.__logger__.exportLogs()
```

---

## 📝 最佳实践

### 1. 日志级别选择

```javascript
// ✅ 正确使用
logger.info('用户登录成功')        // 重要业务信息
logger.debug('请求参数:', params)   // 调试信息
logger.warn('缓存即将过期')        // 警告信息
logger.error('API调用失败', error) // 错误信息

// ❌ 错误使用
logger.error('用户点击按钮')       // 不是错误，应该用info
logger.info('发生严重错误')        // 应该用error
```

### 2. 结构化日志

```javascript
// ✅ 推荐：传递对象
logger.info('用户操作', {
  action: 'click',
  target: 'submit-button',
  userId: 123
})

// ❌ 不推荐：字符串拼接
logger.info('用户123点击了submit-button按钮')
```

### 3. 错误日志

```javascript
// ✅ 推荐：包含上下文
try {
  await api.updateUser(userId, data)
} catch (error) {
  logger.error('更新用户失败', {
    userId,
    data,
    error: error.message
  })
}

// ❌ 不推荐：仅记录错误
try {
  await api.updateUser(userId, data)
} catch (error) {
  logger.error(error)  // 缺少上下文
}
```

### 4. 避免敏感信息

```javascript
// ❌ 危险：可能泄露密码
logger.debug('登录表单', formData)

// ✅ 安全：过滤敏感信息
const safeData = { ...formData, password: '***' }
logger.debug('登录表单', safeData)
```

---

## 🎨 日志格式

### 控制台输出格式

```
[2025-12-14T10:30:45.123Z] [INFO] 用户登录成功
[2025-12-14T10:30:46.456Z] [ERROR] API调用失败
```

### 导出文件格式

```
[2025-12-14T10:30:45.123Z] [LOG] ["普通日志"]
[2025-12-14T10:30:46.456Z] [INFO] ["信息日志",{"data":123}]
[2025-12-14T10:30:47.789Z] [WARN] ["警告日志"]
[2025-12-14T10:30:48.012Z] [ERROR] ["错误日志",{"message":"错误详情"}]
```

---

## 📊 性能影响

| 场景 | 性能影响 | 说明 |
|------|---------|------|
| **开发环境** | 极小 | 正常输出日志 |
| **生产环境** | 几乎无 | 大部分日志被跳过 |
| **日志存储** | 微小 | 仅保留最近100条 |
| **日志导出** | 无 | 用户主动触发 |

---

## 🔍 故障排查

### 问题1: 日志没有输出

**原因**: 可能在生产环境

**解决**:
```javascript
// 检查环境
console.log('当前环境:', import.meta.env.DEV ? '开发' : '生产')

// 生产环境只有error和warn会输出
logger.error('测试错误')  // 应该可见
```

### 问题2: 无法访问 window.__logger__

**原因**: 在生产环境或日志工具未初始化

**解决**:
```javascript
// 开发环境应该可用
if (window.__logger__) {
  window.__logger__.getLogs()
} else {
  console.log('日志工具仅在开发环境可用')
}
```

---

## 📈 迁移指南

### 从console替换为logger

```javascript
// 旧代码
console.log('用户登录')
console.info('获取数据')
console.warn('警告信息')
console.error('错误信息')

// 新代码
import logger from '@/utils/logger'

logger.log('用户登录')
logger.info('获取数据')
logger.warn('警告信息')
logger.error('错误信息')
```

### 批量替换

使用编辑器全局替换：

1. **查找**: `console\.log\(`
2. **替换**: `logger.log(`

3. **查找**: `console\.info\(`
4. **替换**: `logger.info(`

5. **查找**: `console\.warn\(`
6. **替换**: `logger.warn(`

7. **查找**: `console\.error\(`
8. **替换**: `logger.error(`

---

## 💡 高级用法

### 1. 自定义日志处理

```javascript
// 扩展logger类
class CustomLogger extends Logger {
  // 添加自定义方法
  critical(...args) {
    this.error('[CRITICAL]', ...args)
    // 发送告警
    sendAlert(...args)
  }
}
```

### 2. 远程日志上报

```javascript
// 在error方法中添加上报
logger.error = (...args) => {
  console.error(...args)
  
  // 上报到服务器
  if (!isDevelopment) {
    sendToServer({
      level: 'error',
      message: args,
      timestamp: new Date().toISOString()
    })
  }
}
```

---

## ✅ 总结

### 优势
- ✅ **环境自适应** - 自动判断开发/生产环境
- ✅ **零配置** - 开箱即用
- ✅ **性能友好** - 生产环境几乎无开销
- ✅ **功能完整** - 支持所有console方法
- ✅ **日志导出** - 方便调试和分析

### 建议
- 使用合适的日志级别
- 避免记录敏感信息
- 提供足够的上下文
- 定期检查和清理日志

---

**最后更新**: 2025-12-14  
**维护团队**: 开发组
