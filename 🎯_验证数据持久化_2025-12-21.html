<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éªŒè¯æ•°æ®æŒä¹…åŒ– - æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
    }
    
    h1 {
      font-size: 32px;
      color: #333;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .subtitle {
      color: #666;
      font-size: 16px;
      margin-bottom: 30px;
    }
    
    .test-section {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }
    
    .test-section h2 {
      font-size: 20px;
      color: #333;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .test-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #e0e0e0;
    }
    
    .test-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .test-name {
      font-weight: 600;
      color: #333;
    }
    
    .test-status {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .status-pending {
      background: #ffeaa7;
      color: #d63031;
    }
    
    .status-success {
      background: #55efc4;
      color: #00b894;
    }
    
    .status-error {
      background: #ff7675;
      color: #d63031;
    }
    
    .test-result {
      padding: 10px;
      background: #f8f9fa;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #555;
      max-height: 200px;
      overflow-y: auto;
    }
    
    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    button {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .btn-success {
      background: #00b894;
      color: white;
    }
    
    .btn-success:hover {
      background: #00a085;
    }
    
    .btn-danger {
      background: #d63031;
      color: white;
    }
    
    .btn-danger:hover {
      background: #c92a2b;
    }
    
    .btn-info {
      background: #0984e3;
      color: white;
    }
    
    .btn-info:hover {
      background: #0770c4;
    }
    
    .storage-info {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    
    .storage-info h3 {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .storage-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .storage-table td {
      padding: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    
    .storage-table td:first-child {
      font-weight: 600;
      width: 200px;
    }
    
    .code-block {
      background: #2d3436;
      color: #dfe6e9;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      overflow-x: auto;
      margin-top: 10px;
    }
    
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      .button-group {
        flex-direction: column;
      }
      
      button {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>
      ğŸ” æ•°æ®æŒä¹…åŒ–éªŒè¯å·¥å…·
    </h1>
    <p class="subtitle">æ£€æŸ¥åå°ä¿®æ”¹çš„æ•°æ®æ˜¯å¦æ­£ç¡®ä¿å­˜åˆ°localStorage/åç«¯</p>
    
    <!-- å­˜å‚¨ä¿¡æ¯æ¦‚è§ˆ -->
    <div class="storage-info">
      <h3>ğŸ“¦ å½“å‰å­˜å‚¨çŠ¶æ€</h3>
      <table class="storage-table">
        <tr>
          <td>localStorageå¯ç”¨:</td>
          <td id="localStorageAvailable">æ£€æŸ¥ä¸­...</td>
        </tr>
        <tr>
          <td>IndexedDBå¯ç”¨:</td>
          <td id="indexedDBAvailable">æ£€æŸ¥ä¸­...</td>
        </tr>
        <tr>
          <td>å·²ä½¿ç”¨ç©ºé—´:</td>
          <td id="storageUsage">æ£€æŸ¥ä¸­...</td>
        </tr>
        <tr>
          <td>CMSåˆå§‹åŒ–æ ‡è®°:</td>
          <td id="cmsInitialized">æ£€æŸ¥ä¸­...</td>
        </tr>
      </table>
    </div>
    
    <!-- æµ‹è¯•1: localStorageæ•°æ®æ£€æŸ¥ -->
    <div class="test-section">
      <h2>ğŸ“ æµ‹è¯•1: localStorageæ•°æ®æ£€æŸ¥</h2>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">ç½‘ç«™LOGO</span>
          <span class="test-status status-pending" id="status-logo">å¾…æ£€æŸ¥</span>
        </div>
        <div class="test-result" id="result-logo">ç­‰å¾…æ£€æŸ¥...</div>
      </div>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">é¦–é¡µBanner</span>
          <span class="test-status status-pending" id="status-banners">å¾…æ£€æŸ¥</span>
        </div>
        <div class="test-result" id="result-banners">ç­‰å¾…æ£€æŸ¥...</div>
      </div>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">æ˜æ˜Ÿäº§å“</span>
          <span class="test-status status-pending" id="status-products">å¾…æ£€æŸ¥</span>
        </div>
        <div class="test-result" id="result-products">ç­‰å¾…æ£€æŸ¥...</div>
      </div>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">å…¬å¸ä¿¡æ¯</span>
          <span class="test-status status-pending" id="status-company">å¾…æ£€æŸ¥</span>
        </div>
        <div class="test-result" id="result-company">ç­‰å¾…æ£€æŸ¥...</div>
      </div>
    </div>
    
    <!-- æµ‹è¯•2: æ•°æ®æŒä¹…åŒ–æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ”„ æµ‹è¯•2: æ•°æ®æŒä¹…åŒ–æµ‹è¯•</h2>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">ä¿å­˜æµ‹è¯•æ•°æ®</span>
          <span class="test-status status-pending" id="status-save">æœªæµ‹è¯•</span>
        </div>
        <div class="test-result" id="result-save">ç‚¹å‡»"å¼€å§‹æµ‹è¯•"æŒ‰é’®...</div>
      </div>
      
      <div class="test-item">
        <div class="test-item-header">
          <span class="test-name">åˆ·æ–°åæ•°æ®ä¿æŒ</span>
          <span class="test-status status-pending" id="status-refresh">æœªæµ‹è¯•</span>
        </div>
        <div class="test-result" id="result-refresh">å…ˆå®Œæˆä¿å­˜æµ‹è¯•...</div>
      </div>
    </div>
    
    <!-- è¯Šæ–­å»ºè®® -->
    <div class="test-section" id="diagnostic-section" style="display: none;">
      <h2>ğŸ’¡ è¯Šæ–­å»ºè®®</h2>
      <div id="diagnostic-content"></div>
    </div>
    
    <!-- æ“ä½œæŒ‰é’® -->
    <div class="button-group">
      <button class="btn-primary" onclick="checkAllData()">
        ğŸ” å¼€å§‹æ£€æŸ¥
      </button>
      <button class="btn-success" onclick="testPersistence()">
        ğŸ§ª æµ‹è¯•æŒä¹…åŒ–
      </button>
      <button class="btn-danger" onclick="clearAllData()">
        ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®
      </button>
      <button class="btn-info" onclick="exportData()">
        ğŸ“¥ å¯¼å‡ºæ•°æ®
      </button>
      <button class="btn-info" onclick="viewRawData()">
        ğŸ”§ æŸ¥çœ‹åŸå§‹æ•°æ®
      </button>
    </div>
  </div>
  
  <script>
    // æ£€æŸ¥å­˜å‚¨å¯ç”¨æ€§
    function checkStorageAvailability() {
      // localStorage
      try {
        localStorage.setItem('test', 'test')
        localStorage.removeItem('test')
        document.getElementById('localStorageAvailable').textContent = 'âœ… å¯ç”¨'
      } catch (e) {
        document.getElementById('localStorageAvailable').textContent = 'âŒ ä¸å¯ç”¨: ' + e.message
      }
      
      // IndexedDB
      if (window.indexedDB) {
        document.getElementById('indexedDBAvailable').textContent = 'âœ… å¯ç”¨'
      } else {
        document.getElementById('indexedDBAvailable').textContent = 'âŒ ä¸æ”¯æŒ'
      }
      
      // å­˜å‚¨ä½¿ç”¨é‡
      if (navigator.storage && navigator.storage.estimate) {
        navigator.storage.estimate().then(estimate => {
          const used = (estimate.usage / 1024 / 1024).toFixed(2)
          const quota = (estimate.quota / 1024 / 1024).toFixed(2)
          document.getElementById('storageUsage').textContent = `${used} MB / ${quota} MB`
        })
      } else {
        document.getElementById('storageUsage').textContent = 'æµè§ˆå™¨ä¸æ”¯æŒæŸ¥è¯¢'
      }
      
      // CMSåˆå§‹åŒ–æ ‡è®°
      const initialized = localStorage.getItem('cmsInitialized')
      document.getElementById('cmsInitialized').textContent = initialized === 'true' ? 'âœ… å·²åˆå§‹åŒ–' : 'âŒ æœªåˆå§‹åŒ–'
    }
    
    // æ£€æŸ¥æ‰€æœ‰æ•°æ®
    function checkAllData() {
      const diagnosticItems = []
      
      // æ£€æŸ¥LOGO
      const logo = localStorage.getItem('siteLogo')
      const logoElement = document.getElementById('result-logo')
      const logoStatus = document.getElementById('status-logo')
      
      if (logo && logo.trim() !== '') {
        logoElement.textContent = `âœ… LOGOå·²ä¿å­˜: ${logo.substring(0, 100)}...`
        logoStatus.textContent = 'æ­£å¸¸'
        logoStatus.className = 'test-status status-success'
      } else {
        logoElement.textContent = 'âŒ LOGOæœªä¿å­˜æˆ–ä¸ºç©º'
        logoStatus.textContent = 'å¼‚å¸¸'
        logoStatus.className = 'test-status status-error'
        diagnosticItems.push({
          issue: 'LOGOä¸¢å¤±',
          reason: 'localStorageä¸­siteLogoä¸ºç©º',
          solution: 'è¯·åœ¨åå°é‡æ–°ä¸Šä¼ LOGOå¹¶ä¿å­˜'
        })
      }
      
      // æ£€æŸ¥Banner
      const banners = localStorage.getItem('homeBanners')
      const bannersElement = document.getElementById('result-banners')
      const bannersStatus = document.getElementById('status-banners')
      
      if (banners) {
        try {
          const bannersData = JSON.parse(banners)
          bannersElement.textContent = `âœ… æ‰¾åˆ° ${bannersData.length} ä¸ªBanner\n${JSON.stringify(bannersData, null, 2)}`
          bannersStatus.textContent = 'æ­£å¸¸'
          bannersStatus.className = 'test-status status-success'
        } catch (e) {
          bannersElement.textContent = 'âŒ Banneræ•°æ®æ ¼å¼é”™è¯¯: ' + e.message
          bannersStatus.textContent = 'é”™è¯¯'
          bannersStatus.className = 'test-status status-error'
          diagnosticItems.push({
            issue: 'Banneræ•°æ®æŸå',
            reason: 'JSONè§£æå¤±è´¥',
            solution: 'æ¸…é™¤localStorageå¹¶é‡æ–°è®¾ç½®Banner'
          })
        }
      } else {
        bannersElement.textContent = 'âŒ æœªæ‰¾åˆ°Banneræ•°æ®'
        bannersStatus.textContent = 'ç¼ºå¤±'
        bannersStatus.className = 'test-status status-error'
        diagnosticItems.push({
          issue: 'Bannerç¼ºå¤±',
          reason: 'localStorageä¸­homeBannersä¸ºç©º',
          solution: 'è¯·åœ¨åå°æ·»åŠ Bannerå¹¶ä¿å­˜'
        })
      }
      
      // æ£€æŸ¥æ˜æ˜Ÿäº§å“
      const products = localStorage.getItem('featuredProducts')
      const productsElement = document.getElementById('result-products')
      const productsStatus = document.getElementById('status-products')
      
      if (products) {
        try {
          const productsData = JSON.parse(products)
          productsElement.textContent = `âœ… æ‰¾åˆ° ${productsData.length} ä¸ªæ˜æ˜Ÿäº§å“\n${JSON.stringify(productsData, null, 2)}`
          productsStatus.textContent = 'æ­£å¸¸'
          productsStatus.className = 'test-status status-success'
        } catch (e) {
          productsElement.textContent = 'âŒ æ˜æ˜Ÿäº§å“æ•°æ®æ ¼å¼é”™è¯¯: ' + e.message
          productsStatus.textContent = 'é”™è¯¯'
          productsStatus.className = 'test-status status-error'
          diagnosticItems.push({
            issue: 'æ˜æ˜Ÿäº§å“æ•°æ®æŸå',
            reason: 'JSONè§£æå¤±è´¥',
            solution: 'æ¸…é™¤localStorageå¹¶é‡æ–°è®¾ç½®æ˜æ˜Ÿäº§å“'
          })
        }
      } else {
        productsElement.textContent = 'âŒ æœªæ‰¾åˆ°æ˜æ˜Ÿäº§å“æ•°æ®'
        productsStatus.textContent = 'ç¼ºå¤±'
        productsStatus.className = 'test-status status-error'
        diagnosticItems.push({
          issue: 'æ˜æ˜Ÿäº§å“ç¼ºå¤±',
          reason: 'localStorageä¸­featuredProductsä¸ºç©º',
          solution: 'è¯·åœ¨åå°æ·»åŠ æ˜æ˜Ÿäº§å“å¹¶ä¿å­˜'
        })
      }
      
      // æ£€æŸ¥å…¬å¸ä¿¡æ¯
      const siteConfig = localStorage.getItem('siteConfig')
      const companyElement = document.getElementById('result-company')
      const companyStatus = document.getElementById('status-company')
      
      if (siteConfig) {
        try {
          const configData = JSON.parse(siteConfig)
          companyElement.textContent = `âœ… å…¬å¸ä¿¡æ¯å·²ä¿å­˜\n${JSON.stringify(configData, null, 2)}`
          companyStatus.textContent = 'æ­£å¸¸'
          companyStatus.className = 'test-status status-success'
        } catch (e) {
          companyElement.textContent = 'âŒ å…¬å¸ä¿¡æ¯æ•°æ®æ ¼å¼é”™è¯¯: ' + e.message
          companyStatus.textContent = 'é”™è¯¯'
          companyStatus.className = 'test-status status-error'
        }
      } else {
        companyElement.textContent = 'âš ï¸ å…¬å¸ä¿¡æ¯ä½¿ç”¨é»˜è®¤å€¼'
        companyStatus.textContent = 'é»˜è®¤'
        companyStatus.className = 'test-status status-pending'
      }
      
      // æ˜¾ç¤ºè¯Šæ–­å»ºè®®
      if (diagnosticItems.length > 0) {
        showDiagnostic(diagnosticItems)
      } else {
        document.getElementById('diagnostic-section').style.display = 'none'
      }
    }
    
    // æ˜¾ç¤ºè¯Šæ–­å»ºè®®
    function showDiagnostic(items) {
      const section = document.getElementById('diagnostic-section')
      const content = document.getElementById('diagnostic-content')
      
      let html = ''
      items.forEach((item, index) => {
        html += `
          <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #d63031;">
            <h4 style="color: #d63031; margin-bottom: 10px;">é—®é¢˜ ${index + 1}: ${item.issue}</h4>
            <p style="margin-bottom: 8px;"><strong>åŸå› :</strong> ${item.reason}</p>
            <p><strong>è§£å†³æ–¹æ¡ˆ:</strong> ${item.solution}</p>
          </div>
        `
      })
      
      content.innerHTML = html
      section.style.display = 'block'
    }
    
    // æµ‹è¯•æŒä¹…åŒ–
    function testPersistence() {
      const testData = {
        timestamp: Date.now(),
        test: 'persistence_test_' + Math.random()
      }
      
      try {
        localStorage.setItem('testPersistence', JSON.stringify(testData))
        
        document.getElementById('result-save').textContent = `âœ… æµ‹è¯•æ•°æ®å·²ä¿å­˜\n${JSON.stringify(testData, null, 2)}`
        document.getElementById('status-save').textContent = 'æˆåŠŸ'
        document.getElementById('status-save').className = 'test-status status-success'
        
        document.getElementById('result-refresh').innerHTML = `
          <div style="background: #fff3cd; padding: 12px; border-radius: 6px; border-left: 4px solid #ffc107;">
            <strong>âš ï¸ è¯·åˆ·æ–°é¡µé¢éªŒè¯</strong><br>
            åˆ·æ–°å,æµ‹è¯•æ•°æ®åº”è¯¥ä¾ç„¶å­˜åœ¨<br>
            <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #ffc107; border: none; border-radius: 4px; cursor: pointer;">
              ğŸ”„ ç«‹å³åˆ·æ–°é¡µé¢
            </button>
          </div>
        `
        
        setTimeout(() => {
          const saved = localStorage.getItem('testPersistence')
          if (saved) {
            const savedData = JSON.parse(saved)
            if (savedData.timestamp === testData.timestamp) {
              document.getElementById('status-refresh').textContent = 'æˆåŠŸ'
              document.getElementById('status-refresh').className = 'test-status status-success'
            }
          }
        }, 100)
        
      } catch (e) {
        document.getElementById('result-save').textContent = 'âŒ ä¿å­˜å¤±è´¥: ' + e.message
        document.getElementById('status-save').textContent = 'å¤±è´¥'
        document.getElementById('status-save').className = 'test-status status-error'
      }
    }
    
    // æ¸…é™¤æ‰€æœ‰æ•°æ®
    function clearAllData() {
      if (confirm('âš ï¸ ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰CMSæ•°æ®å—?è¿™å°†åˆ é™¤:\n- ç½‘ç«™LOGO\n- é¦–é¡µBanner\n- æ˜æ˜Ÿäº§å“\n- å…¬å¸ä¿¡æ¯\n\næ­¤æ“ä½œä¸å¯æ¢å¤!')) {
        localStorage.removeItem('siteLogo')
        localStorage.removeItem('homeBanners')
        localStorage.removeItem('featuredProducts')
        localStorage.removeItem('siteConfig')
        localStorage.removeItem('cmsInitialized')
        
        alert('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…é™¤!\nè¯·é‡æ–°åœ¨åå°è®¾ç½®æ•°æ®')
        location.reload()
      }
    }
    
    // å¯¼å‡ºæ•°æ®
    function exportData() {
      const data = {
        siteLogo: localStorage.getItem('siteLogo'),
        homeBanners: localStorage.getItem('homeBanners'),
        featuredProducts: localStorage.getItem('featuredProducts'),
        siteConfig: localStorage.getItem('siteConfig'),
        exportTime: new Date().toISOString()
      }
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' })
      const url = URL.createObjectURL(blob)
      const a = document.createElement('a')
      a.href = url
      a.download = `cms-backup-${Date.now()}.json`
      a.click()
      
      alert('âœ… æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶')
    }
    
    // æŸ¥çœ‹åŸå§‹æ•°æ®
    function viewRawData() {
      const allData = {}
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i)
        allData[key] = localStorage.getItem(key)
      }
      
      const win = window.open('', '_blank')
      win.document.write(`
        <html>
        <head>
          <title>localStorageåŸå§‹æ•°æ®</title>
          <style>
            body { font-family: monospace; padding: 20px; background: #2d3436; color: #dfe6e9; }
            pre { background: #000; padding: 20px; border-radius: 8px; overflow: auto; }
          </style>
        </head>
        <body>
          <h1>localStorageåŸå§‹æ•°æ®</h1>
          <pre>${JSON.stringify(allData, null, 2)}</pre>
        </body>
        </html>
      `)
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.onload = function() {
      checkStorageAvailability()
      checkAllData()
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯åˆ·æ–°å
      const testData = localStorage.getItem('testPersistence')
      if (testData) {
        document.getElementById('result-refresh').textContent = `âœ… åˆ·æ–°åæ•°æ®ä¾ç„¶å­˜åœ¨!\n${testData}`
        document.getElementById('status-refresh').textContent = 'é€šè¿‡'
        document.getElementById('status-refresh').className = 'test-status status-success'
      }
    }
  </script>
</body>
</html>
