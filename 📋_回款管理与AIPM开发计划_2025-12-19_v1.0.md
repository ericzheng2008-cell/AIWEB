# 📋 回款管理与AIPM开发计划

**计划版本**: V1.0  
**制定日期**: 2025-12-19  
**计划周期**: 2周（回款管理） + 4周（AIPM Phase 1）

---

## 🎯 开发目标

### 目标1：回款管理模块（1周）
扩展销售目标功能，增加回款管理体系

### 目标2：AIPM项目管理模块（3-4周）
创建全新的企业级智能项目管理系统

---

## 📊 任务1：回款管理模块开发计划

### 功能需求分析

#### 核心功能清单
1. **合同账期管理**
   - 合同信息录入
   - 账期自动计算
   - 付款节点管理
   - 账期日历展示

2. **到期预警**
   - 提前7天预警
   - 提前3天预警
   - 当天提醒
   - 逾期提醒

3. **过期催收**
   - 催收任务自动生成
   - 催收记录管理
   - 催收效果跟踪
   - 逾期统计分析

4. **多角色协作**
   - 财务负责人（查看所有合同，审批付款）
   - 内勤负责人（录入合同，跟踪账期）
   - 销售（查看自己的合同，提交催收）
   - 销售经理（查看部门合同，审批催收）

### 数据结构设计

#### 合同账期表（contracts_receivable）
```javascript
{
  id: "CR001",
  contract_no: "HT-20250115-001",  // 合同编号
  contract_name: "XX工厂拧紧系统项目",
  customer_id: "C001",
  customer_name: "广汽本田",
  total_amount: 5000000,  // 合同总金额（元）
  
  // 账期信息
  payment_terms: [
    {
      term_id: "T1",
      term_name: "首付款",
      percentage: 30,
      amount: 1500000,
      due_date: "2025-02-15",
      payment_condition: "合同签订后7天内",
      status: "已收款",
      actual_payment_date: "2025-02-10",
      actual_amount: 1500000
    },
    {
      term_id: "T2",
      term_name: "到货款",
      percentage: 40,
      amount: 2000000,
      due_date: "2025-05-30",
      payment_condition: "设备到货验收后",
      status: "待收款",
      actual_payment_date: null,
      actual_amount: 0
    },
    {
      term_id: "T3",
      term_name: "尾款",
      percentage: 30,
      amount: 1500000,
      due_date: "2025-09-30",
      payment_condition: "项目验收合格后",
      status: "待收款",
      actual_payment_date: null,
      actual_amount: 0
    }
  ],
  
  // 负责人信息
  sales_person: "张三",
  sales_manager: "李经理",
  finance_person: "财务王会计",
  admin_person: "内勤小刘",
  
  // 统计信息
  received_amount: 1500000,
  pending_amount: 3500000,
  overdue_amount: 0,
  
  // 催收记录
  collection_records: [],
  
  // 预警状态
  warning_status: "正常",  // 正常/即将到期/逾期
  
  create_date: "2025-01-15",
  update_date: "2025-02-10"
}
```

#### 催收记录表（collection_records）
```javascript
{
  id: "COL001",
  contract_id: "CR001",
  term_id: "T2",
  collection_type: "电话催收",
  collection_date: "2025-05-25",
  collector: "张三",
  contact_person: "本田采购经理",
  collection_result: "客户承诺5月28日付款",
  next_follow_date: "2025-05-28",
  status: "进行中",
  notes: "客户表示资金已到账，预计28日付款"
}
```

### 界面设计

#### 1. 回款管理主界面
```
┌─────────────────────────────────────────────────────────┐
│  💰 回款管理                                [新增合同]   │
├─────────────────────────────────────────────────────────┤
│  📊 统计看板                                             │
│  ┌──────────┬──────────┬──────────┬──────────┐        │
│  │ 合同总额  │ 已收款   │ 待收款   │ 逾期款   │        │
│  │ 8000万   │ 5200万   │ 2500万   │ 300万    │        │
│  └──────────┴──────────┴──────────┴──────────┘        │
│                                                         │
│  🔔 到期预警 (7天内到期: 3笔)                           │
│  ┌─────────────────────────────────────────┐          │
│  │ • 广汽传祺 - 尾款150万 - 3天后到期      │          │
│  │ • 丰田汽车 - 到货款200万 - 5天后到期    │          │
│  │ • 本田汽车 - 进度款80万 - 7天后到期     │          │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  📋 合同列表                                             │
│  ┌───┬────────┬────────┬────┬────┬────┬────┐        │
│  │#  │合同编号 │客户     │总额│已收│待收│操作│        │
│  ├───┼────────┼────────┼────┼────┼────┼────┤        │
│  │1  │HT-001  │广汽本田 │500 │300 │200 │详情│        │
│  │2  │HT-002  │丰田汽车 │800 │500 │300 │详情│        │
│  └───┴────────┴────────┴────┴────┴────┴────┘        │
└─────────────────────────────────────────────────────────┘
```

#### 2. 合同详情界面
```
┌─────────────────────────────────────────────────────────┐
│  📄 合同详情 - HT-20250115-001                          │
├─────────────────────────────────────────────────────────┤
│  基本信息                                               │
│  • 合同名称：XX工厂拧紧系统项目                         │
│  • 客户名称：广汽本田                                   │
│  • 合同金额：500万元                                    │
│  • 签订日期：2025-01-15                                │
│                                                         │
│  账期信息                                               │
│  ┌─────────────────────────────────────────┐          │
│  │ 序号 │ 款项  │ 金额 │ 到期日│ 状态  │ 操作│        │
│  ├──────┼───────┼──────┼───────┼───────┼────┤        │
│  │  1   │首付款 │150万 │02-15  │✅已收 │查看│        │
│  │  2   │到货款 │200万 │05-30  │⏳待收 │催收│        │
│  │  3   │尾款   │150万 │09-30  │⏳待收 │-   │        │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  催收记录                                               │
│  ┌─────────────────────────────────────────┐          │
│  │ • 2025-05-25 张三电话催收，客户承诺28日付款│        │
│  │ • 2025-05-20 张三邮件催收，客户已读未回复  │        │
│  └─────────────────────────────────────────┘          │
│                                                         │
│  [新增催收记录] [导出账期] [返回列表]                   │
└─────────────────────────────────────────────────────────┘
```

### 开发任务分解

#### Day 1-2：数据库设计与后端API
- [ ] 设计数据表结构
- [ ] 创建合同账期管理API
- [ ] 创建催收记录API
- [ ] 创建预警查询API
- [ ] 创建统计分析API

#### Day 3-4：前端界面开发
- [ ] 回款管理主界面
- [ ] 合同新增/编辑对话框
- [ ] 账期管理界面
- [ ] 催收记录管理界面
- [ ] 预警列表组件

#### Day 5：角色权限与通知
- [ ] 角色权限控制
- [ ] 到期预警通知
- [ ] 逾期自动提醒
- [ ] 邮件/短信通知集成

#### Day 6-7：测试与优化
- [ ] 功能测试
- [ ] 性能优化
- [ ] 用户体验优化
- [ ] 文档编写

---

## 📊 任务2：AIPM项目管理模块开发计划

### Phase 1：基础功能（第1-2周）

#### Week 1：核心架构搭建

**Day 1-2：数据模型设计**
```
✅ 项目基础信息表
✅ WBS任务表
✅ 甘特图数据结构
✅ 项目成员表
✅ 项目里程碑表
✅ 项目文档表
```

**Day 3-4：基础界面开发**
```
✅ AIPM导航菜单
✅ 项目列表界面
✅ 项目新建对话框
✅ 项目详情界面框架
```

**Day 5：甘特图集成**
```
✅ 引入Gantt图表库（dhtmlx-gantt / frappe-gantt）
✅ 甘特图数据绑定
✅ 基础甘特图展示
```

#### Week 2：核心功能实现

**Day 1-2：WBS管理**
```
✅ WBS树形结构展示
✅ 任务新增/编辑/删除
✅ 任务依赖关系设置
✅ 任务分配
```

**Day 3-4：进度管理**
```
✅ 进度更新
✅ 进度可视化
✅ 延期计算
✅ 关键路径显示
```

**Day 5：3D可视化（基础版）**
```
✅ 使用ECharts-GL
✅ 3D项目状态地图
✅ 项目健康度展示
```

### Phase 2：智能功能（第3周）

#### Week 3：AI能力集成

**Day 1-2：项目分析**
```
✅ 进度分析算法
✅ 风险识别逻辑
✅ 延期预测模型（简化版）
```

**Day 3-4：智能助手**
```
✅ 对话式交互
✅ 项目状态查询
✅ 风险提醒
✅ 建议生成
```

**Day 5：自动化功能**
```
✅ 自动生成日报
✅ 自动发送预警
✅ 自动更新进度
```

### Phase 3：协作功能（第4周）

#### Week 4：多项目管理

**Day 1-2：多项目视图**
```
✅ 项目对比仪表盘
✅ 资源占用分析
✅ 跨项目依赖
```

**Day 3-4：协作功能**
```
✅ 任务评论
✅ 文档共享
✅ 进度通知
```

**Day 5：测试与优化**
```
✅ 完整功能测试
✅ 性能优化
✅ 用户文档
```

### 核心技术选型

#### 甘特图库选择
```
推荐方案：dhtmlx-gantt
优势：
• 功能强大
• 支持依赖关系
• 支持关键路径
• 可定制性强

备选方案：Frappe Gantt
优势：
• 轻量级
• 开源免费
• 界面美观
```

#### 3D可视化
```
方案：ECharts-GL + Three.js
• ECharts-GL：数据驱动的3D图表
• Three.js：复杂3D场景渲染
```

#### AI集成
```
• OpenAI API（对话）
• 本地算法（进度分析、风险识别）
• Python微服务（复杂预测模型）
```

### 界面原型

#### 1. AIPM主界面
```
┌─────────────────────────────────────────────────────────┐
│  🤖 AIPM智能项目管理                     [新建项目]     │
├─────────────────────────────────────────────────────────┤
│  📊 项目仪表盘                                           │
│  ┌──────────┬──────────┬──────────┬──────────┐        │
│  │ 进行中   │ 已完成   │ 延期     │ 风险项目 │        │
│  │ 12个     │ 35个     │ 3个      │ 5个      │        │
│  └──────────┴──────────┴──────────┴──────────┘        │
│                                                         │
│  🔔 智能预警                                             │
│  • ⚠️ XX项目预计延期7天，建议增加资源               │
│  • 🔴 YY项目供应商延误，影响关键路径               │
│  • 🟡 ZZ项目成本超支5%，需要审批                   │
│                                                         │
│  📋 项目列表                    [列表视图] [甘特视图] │
│  ┌───┬────────┬────┬────┬────┬────┬────┐            │
│  │#  │项目名称 │状态│进度│健康│经理│操作│            │
│  ├───┼────────┼────┼────┼────┼────┼────┤            │
│  │1  │拧紧系统 │进行│75% │🟢  │张工│详情│            │
│  │2  │控制系统 │进行│45% │🟡  │李工│详情│            │
│  │3  │检测设备 │延期│30% │🔴  │王工│详情│            │
│  └───┴────────┴────┴────┴────┴────┴────┘            │
└─────────────────────────────────────────────────────────┘
```

#### 2. 项目详情 - 甘特图视图
```
┌─────────────────────────────────────────────────────────┐
│  📊 XX工厂拧紧系统项目                                   │
│  [概览] [甘特图] [WBS] [风险] [团队] [文档] [AI助手]  │
├─────────────────────────────────────────────────────────┤
│  甘特图视图                              [今天] [导出]  │
│                                                         │
│  任务名称          开始日期  结束日期  负责人    进度   │
│  ├ 需求分析       01-15    02-15    张工      100%   │
│  ├ 系统设计       02-16    03-30    李工       80%   │
│  │ ├ 硬件设计    02-16    03-15    李工       90%   │
│  │ └ 软件设计    03-01    03-30    王工       70%   │
│  ├ 采购制造       03-01    06-30    赵工       40%   │
│  ├ 安装调试       07-01    08-15    孙工        0%   │
│  └ 验收交付       08-16    09-30    张工        0%   │
│                                                         │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  1月  2月  3月  4月  5月  6月  7月  8月  9月            │
│  ████▓▓▓▓░░░░░░░░░░░░░░░░░░░░   需求分析              │
│      ████████▓▓░░░░░░░░░░░░░░   系统设计              │
│          ████████████▓▓▓░░░░░   采购制造              │
│                          ████░   安装调试              │
│                              ██   验收交付              │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━        │
│  关键路径：需求分析 → 系统设计 → 采购制造 → 安装调试    │
└─────────────────────────────────────────────────────────┘
```

#### 3. 3D项目状态展示
```
┌─────────────────────────────────────────────────────────┐
│  🎮 3D项目状态地图                       [全屏] [设置]  │
├─────────────────────────────────────────────────────────┤
│                                                         │
│              🟢                🟡                       │
│           项目A              项目B                      │
│            75%                45%                       │
│                                                         │
│                       🟢                                │
│                    项目C                                │
│                     90%                                 │
│                                                         │
│        🔴                          🟡                   │
│      项目D                       项目E                  │
│       30%                         60%                   │
│                                                         │
│  图例：                                                 │
│  🟢 健康  🟡 预警  🔴 风险                              │
│  大小 = 项目规模  高度 = 进度  颜色 = 健康度            │
│                                                         │
│  [旋转] [缩放] [筛选]                                   │
└─────────────────────────────────────────────────────────┘
```

---

## 🎯 开发优先级

### P0（必须完成）
1. ✅ 代码备份（已完成）
2. 🔄 回款管理基础功能（1周）
3. 🔄 AIPM项目列表+甘特图（2周）

### P1（重要功能）
1. 🔄 回款管理预警通知
2. 🔄 AIPM智能预测
3. 🔄 3D可视化（基础版）

### P2（优化功能）
1. 回款管理统计分析
2. AIPM多项目管理
3. AI智能助手对话

---

## 📅 时间线

```
Week 1：回款管理开发
  ├─ Day 1-2：数据库+API
  ├─ Day 3-4：前端界面
  ├─ Day 5：权限+通知
  └─ Day 6-7：测试+文档

Week 2-3：AIPM Phase 1
  ├─ Day 1-5：基础架构+甘特图
  ├─ Day 6-10：WBS+进度管理+3D
  └─ Day 11-15：AI能力+智能助手

Week 4：AIPM Phase 2
  ├─ Day 1-2：多项目管理
  ├─ Day 3-4：协作功能
  └─ Day 5：测试+优化
```

---

## ✅ 验收标准

### 回款管理
- [ ] 可以新增合同账期
- [ ] 可以查看到期预警
- [ ] 可以记录催收过程
- [ ] 可以按角色查看不同数据
- [ ] 有自动预警通知

### AIPM
- [ ] 可以创建项目
- [ ] 可以编辑WBS
- [ ] 可以查看甘特图
- [ ] 可以更新进度
- [ ] 有3D项目展示
- [ ] 有AI智能分析

---

**计划制定完成时间**: 2025-12-19  
**预计开发周期**: 4周  
**下一步行动**: 开始回款管理模块开发
