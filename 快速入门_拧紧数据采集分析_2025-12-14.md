# 📘 拧紧数据采集分析系统 - 快速入门指南

> **版本**: v3.0.0  
> **更新日期**: 2025-12-14  
> **架构**: ToolsNet 8 (Atlas Copco)

---

## 🎯 系统概述

本系统基于 Atlas Copco ToolsNet 8 架构，实现工业级拧紧数据采集、存储、分析和可视化。

### 核心组件

| 组件 | 技术栈 | 架构 | 说明 |
|------|--------|------|------|
| **PIM** (Protocol Interface Module) | Delphi | 32-bit | 控制器协议接口 |
| **DCS** (Data Collection Service) | .NET Core | 64-bit | 数据采集服务 + MSMQ |
| **CDC** (Common Data Collection) | .NET Core | 64-bit | 通用数据采集 + MSMQ |
| **Archive Service** | .NET Core | 64-bit | 数据存档服务 |
| **Web Application** | Vue 3 + Node.js | 64-bit | Web界面 + API |
| **Database** | SQL Server / Oracle | - | 数据持久化 |

---

## 🚀 快速启动

### 方法 1: 一键启动（推荐）

1. 双击运行: `启动拧紧数据系统.bat`
2. 等待服务启动（约10秒）
3. 浏览器自动打开系统界面

### 方法 2: 测试模式

1. 双击运行: `测试拧紧数据系统.bat`
2. 系统会自动检查环境并启动
3. 打开测试页面进行功能验证

### 方法 3: 手动启动

```bash
# 终端 1: 启动后端
cd c:/Users/EricZ/CodeBuddy/AIWEB1
node server/index.js

# 终端 2: 启动前端
npm run dev

# 访问地址
http://localhost:5173/#/admin/tightening-data
```

---

## 📊 功能使用指南

### 1️⃣ 连接控制器

#### 步骤：

1. 进入「拧紧数据采集」页面
2. 填写连接信息：
   - **控制器类型**: PF4000 / PF6000 / PF8000 / PowerMACS
   - **IP地址**: 控制器IP（如 192.168.1.100）
   - **端口**: Open Protocol端口（默认 4545）
   - **Protocol版本**: 2.8.0（推荐）
   - **数据库类型**: SQL Server（推荐）
   - **MSMQ消息队列**: 启用（推荐）

3. 点击「连接控制器 (PIM)」

#### 支持的控制器：

| 控制器 | 型号 | 特点 |
|--------|------|------|
| PF4000 | PowerFocus 4000 | 标准型 |
| PF6000 | PowerFocus 6000 | 中高级型 |
| PF8000 | PowerFocus 8000 | 高级型 |
| PowerMACS | PowerMACS | 总线型 |

---

### 2️⃣ 开始数据采集

#### 连接成功后：

1. 系统显示连接信息：
   - 控制器型号
   - 系统类型
   - 采集速度
   - 服务组件状态（PIM、DCS、CDC）

2. 点击「启动数据采集服务 (DCS)」

3. 实时监控面板会显示：
   - 当前拧紧进度
   - 扭矩曲线
   - 角度曲线
   - 结果状态（OK/NOK）

---

### 3️⃣ 实时监控

#### 监控仪表盘包含：

| 监控项 | 说明 |
|--------|------|
| **当前拧紧** | 实时扭矩、角度、速度 |
| **拧紧结果** | OK/NOK状态 + 原因 |
| **实时曲线** | 扭矩-角度-时间曲线 |
| **统计指标** | 合格率、平均扭矩等 |

#### 功能按钮：

- 🔄 **刷新**: 更新实时数据
- ⏸️ **暂停**: 暂停采集
- ▶️ **继续**: 恢复采集
- 🛑 **停止**: 停止采集服务

---

### 4️⃣ 历史数据查询

#### 查询步骤：

1. 切换到「历史数据」标签
2. 设置查询条件：
   - 时间范围
   - 结果筛选（全部/OK/NOK）
   - 工件号
   - 工位号

3. 点击「查询」

4. 查看结果列表：
   - 拧紧ID
   - 时间戳
   - 扭矩值
   - 角度值
   - 结果状态

5. 点击「查看详情」查看完整曲线

---

### 5️⃣ 拧紧曲线分析

#### 曲线对比：

1. 在历史数据中选择多条记录
2. 点击「对比分析」
3. 系统显示：
   - 扭矩曲线对比图
   - 角度曲线对比图
   - 参数对比表

#### 分析功能：

- 📈 **趋势分析**: 查看扭矩/角度变化趋势
- 📊 **统计分析**: CPK、合格率等
- 🔍 **异常检测**: 自动标注异常点
- 📝 **生成报告**: 导出分析报告

---

### 6️⃣ 数据统计

#### 统计维度：

| 维度 | 指标 |
|------|------|
| **时间** | 小时/天/周/月统计 |
| **结果** | OK率、NOK率、总数 |
| **扭矩** | 平均值、最大值、最小值、标准差 |
| **角度** | 平均值、最大值、最小值、标准差 |
| **设备** | 各控制器数据量统计 |

#### 图表类型：

- 📊 柱状图
- 📈 折线图
- 🥧 饼图
- 📉 分布图

---

### 7️⃣ 数据导出

#### 支持格式：

| 格式 | 用途 |
|------|------|
| **Excel** | 数据分析、报表 |
| **CSV** | 数据导入、处理 |
| **PDF** | 报告打印、存档 |
| **JSON** | 系统集成、API |

#### 导出步骤：

1. 选择需要导出的数据
2. 点击「导出」按钮
3. 选择导出格式
4. 设置导出选项：
   - 包含曲线数据
   - 包含统计信息
   - 包含图表

5. 下载文件

---

## 🔧 高级功能

### 存档服务 (Archive Service)

#### 功能：

- 自动归档历史数据
- 数据压缩存储
- 快速检索
- 数据备份

#### 配置：

```javascript
// 存档规则
{
  archiveInterval: '1 month',     // 归档间隔
  compressionRatio: 0.3,          // 压缩率
  retentionPeriod: '2 years',     // 保留期
  autoCleanup: true               // 自动清理
}
```

### MSMQ 消息队列

#### 优势：

- ✅ 高可靠性数据传输
- ✅ 解耦采集与存储
- ✅ 支持断线重连
- ✅ 数据不丢失

#### 队列监控：

- 队列深度
- 消息速率
- 错误率
- 延迟时间

---

## 🎯 使用场景

### 场景 1: 生产线实时监控

```
控制器 → PIM → DCS → Web界面
         ↓
        CDC → MSMQ → Database
```

**用途**: 实时监控生产线拧紧质量，及时发现异常

### 场景 2: 质量追溯

```
历史数据查询 → 详细记录 → 曲线分析 → 导出报告
```

**用途**: 质量问题追溯，分析拧紧过程

### 场景 3: 工艺优化

```
数据统计 → 趋势分析 → 参数对比 → 工艺调整
```

**用途**: 分析拧紧数据，优化拧紧工艺参数

### 场景 4: 设备管理

```
设备数据 → 性能分析 → 维护预警 → 计划维护
```

**用途**: 预测设备维护需求，降低故障率

---

## 📱 移动端使用

### 响应式设计

系统支持移动设备访问：

- 📱 手机浏览器
- 📱 平板电脑
- 💻 桌面浏览器

### 移动端功能：

- ✅ 实时监控
- ✅ 数据查询
- ✅ 曲线查看
- ✅ 报表导出

---

## 🔒 权限管理

### 角色定义：

| 角色 | 权限 |
|------|------|
| **管理员** | 所有功能 |
| **工程师** | 采集、分析、导出 |
| **操作员** | 实时监控、基础查询 |
| **访客** | 仅查看统计数据 |

### 权限配置：

在「用户管理」→「角色权限」中配置

---

## 🛠️ 故障排查

### 常见问题

#### 1. 无法连接控制器

**原因**:
- IP地址错误
- 端口被占用
- 防火墙阻止
- 控制器未启动 Open Protocol

**解决**:
```bash
# 测试网络连接
ping 192.168.1.100

# 检查端口
netstat -ano | findstr 4545

# 关闭防火墙或添加规则
```

#### 2. 数据采集中断

**原因**:
- 网络不稳定
- MSMQ服务未启动
- 数据库连接断开

**解决**:
- 检查网络连接
- 启动 MSMQ 服务
- 重新连接数据库

#### 3. 曲线显示异常

**原因**:
- 数据采样率设置不当
- 浏览器缓存问题

**解决**:
- 调整采样率（推荐: 100Hz）
- 清除浏览器缓存

---

## 📞 技术支持

### 联系方式

- 📧 Email: support@toolsnet.example.com
- 📱 电话: 400-xxx-xxxx
- 💬 在线客服: 系统右下角

### 文档资源

- 📖 完整技术文档: `功能文档_拧紧数据采集系统_ToolsNet8架构_2025-12-14_v3.0.0.md`
- 🚀 部署指南: `快速部署指南_拧紧数据采集系统_2025-12-14.md`
- 📋 交付清单: `📦_项目交付清单_ToolsNet8_2025-12-14.md`

---

## 🎓 培训视频

### 视频教程（规划中）

1. **基础操作** (10分钟)
   - 系统登录
   - 控制器连接
   - 数据采集

2. **数据分析** (15分钟)
   - 历史数据查询
   - 曲线对比
   - 统计分析

3. **高级功能** (20分钟)
   - 存档服务配置
   - MSMQ监控
   - 数据库优化

---

## ✅ 下一步

1. ✅ 完成系统登录
2. ✅ 连接第一个控制器
3. ✅ 采集第一条拧紧数据
4. ✅ 查看实时曲线
5. ✅ 生成第一份报告

**开始使用**: 双击 `启动拧紧数据系统.bat` 🚀

---

**版本历史**:
- v3.0.0 (2025-12-14): ToolsNet 8 架构完整实现
- v2.0.0 (2025-12-14): 增强UI和存档服务
- v1.0.0 (2025-12-14): 初始版本
