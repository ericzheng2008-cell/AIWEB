# 📋 500错误快速排查清单

## 🎯 快速诊断工具

### 一键诊断（推荐）
```bash
🔧_一键修复500错误_2025-12-19.bat
```

### 完整诊断页面
```bash
🔍_诊断500错误_完整版_2025-12-19.html
```

---

## ✅ 排查清单

### 1️⃣ 检查后端服务器 (最重要！)

```bash
# Windows
netstat -ano | findstr :5000

# 如果无输出 = 未运行 ❌
# 如果有输出 = 正在运行 ✅
```

**如果未运行，立即启动:**
```bash
🔧_启动后端服务器_2025-12-19.bat
```

---

### 2️⃣ 测试API连接

打开浏览器访问:
```
http://localhost:5000/api
```

**预期结果:**
- ✅ 返回404 JSON (说明服务器运行，只是路径不存在)
- ❌ 无法连接 (说明服务器未运行)

---

### 3️⃣ 检查后端日志

查看后端服务器窗口，找500错误的具体信息:

```
常见错误信息示例:
❌ ReferenceError: xxx is not defined
❌ TypeError: Cannot read property 'xxx' of undefined  
❌ Error: Cannot find module 'xxx'
❌ Database connection failed
```

---

### 4️⃣ 检查浏览器控制台

按 **F12** 打开开发者工具:

**Console 标签:**
```javascript
// 找类似这样的错误:
Failed to load resource: the server responded with a status of 500
GET http://localhost:5000/api/xxx 500 (Internal Server Error)
```

**Network 标签:**
- 找到返回500的请求
- 点击查看 "Response" 或 "Preview"
- 查看服务器返回的错误信息

---

## 🔧 常见500错误及解决方案

### 错误类型1: 后端未运行
```
❌ Failed to fetch
❌ net::ERR_CONNECTION_REFUSED
❌ ECONNREFUSED
```

**解决:**
```bash
🔧_启动后端服务器_2025-12-19.bat
```

---

### 错误类型2: 路由未正确导入
```
❌ ReferenceError: tighteningRoutes is not defined
❌ xxx is not defined
```

**检查:** `server/index.js` 顶部的导入:
```javascript
// ✅ 正确
import tighteningRoutes from './routes/tightening.js'

// ❌ 错误 - 缺少导入
app.use('/api/tightening', tighteningRoutes) // 未定义
```

**解决:** 添加缺失的导入语句

---

### 错误类型3: 数据库连接失败
```
❌ Error: connect ECONNREFUSED 127.0.0.1:3306
❌ Database connection failed
❌ ER_ACCESS_DENIED_ERROR
```

**检查:**
1. 数据库服务是否运行
2. 连接配置是否正确 (.env文件)
3. 用户名密码是否正确

---

### 错误类型4: 依赖缺失
```
❌ Error: Cannot find module 'express'
❌ Cannot find module 'xxx'
```

**解决:**
```bash
cd server
npm install
```

---

### 错误类型5: 代码语法错误
```
❌ SyntaxError: Unexpected token
❌ SyntaxError: Invalid or unexpected token
```

**解决:**
1. 检查报错的文件和行号
2. 修复语法错误
3. 重启后端服务器

---

## 🎯 逐步排查流程

```
┌─────────────────────────────────────┐
│  1. 后端是否运行？                    │
│     netstat -ano | findstr :5000    │
└──────────┬──────────────────────────┘
           │
    ┌──────▼───────┐
    │   未运行？    │
    └──────┬───────┘
           │ 是
    ┌──────▼──────────────────────────┐
    │  启动后端:                       │
    │  🔧_启动后端服务器_2025-12-19.bat │
    └──────┬──────────────────────────┘
           │
    ┌──────▼───────────────────────────┐
    │  2. 启动失败？查看错误信息         │
    │     - 端口被占用？                │
    │     - 依赖缺失？npm install       │
    │     - 语法错误？检查代码           │
    └──────┬──────────────────────────┘
           │
    ┌──────▼──────────────────────────┐
    │  3. 启动成功？测试API             │
    │     访问: http://localhost:5000/api │
    └──────┬──────────────────────────┘
           │
    ┌──────▼──────────────────────────┐
    │  4. 仍有500错误？                 │
    │     - 打开诊断工具                │
    │     - 检查后端日志                │
    │     - 查看浏览器控制台             │
    └──────────────────────────────────┘
```

---

## 📞 求助信息收集

如果以上都无法解决，收集以下信息:

1. **后端日志:**
   ```
   复制后端服务器窗口的完整错误信息
   ```

2. **浏览器控制台:**
   ```
   F12 → Console标签 → 截图
   F12 → Network标签 → 找500错误 → 查看Response → 复制
   ```

3. **环境信息:**
   ```bash
   node --version
   npm --version
   ```

4. **端口状态:**
   ```bash
   netstat -ano | findstr :5000
   netstat -ano | findstr :5173
   ```

---

## 🚀 快速修复命令

```bash
# 1. 杀掉所有Node进程（谨慎！）
taskkill /F /IM node.exe

# 2. 重新安装依赖
cd server
npm install

# 3. 启动后端
node index.js

# 4. 新窗口启动前端
npm run dev
```

---

## ✅ 验证修复成功

修复后，检查以下指标:

- [ ] 后端服务器窗口无错误
- [ ] 访问 `http://localhost:5000/api` 返回404（不是无法连接）
- [ ] 浏览器Console无500错误
- [ ] 前端页面正常加载数据
- [ ] Network标签显示API请求返回200或其他非500状态码

---

**记住: 90%的500错误是因为后端未运行！** 🎯
