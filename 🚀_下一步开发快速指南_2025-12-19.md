# ğŸš€ ä¸‹ä¸€æ­¥å¼€å‘å¿«é€ŸæŒ‡å—

**æŒ‡å—ç‰ˆæœ¬**: V1.0  
**åˆ›å»ºæ—¥æœŸ**: 2025-12-19  
**é€‚ç”¨å¯¹è±¡**: å¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
```
1. ä»£ç å®Œæ•´å¤‡ä»½ï¼ˆGit Commit: 4f98bf9ï¼‰
2. AIPMå®Œæ•´äº§å“æ–¹æ¡ˆï¼ˆ50é¡µï¼‰
3. å›æ¬¾ç®¡ç†+AIPMå¼€å‘è®¡åˆ’ï¼ˆ4å‘¨ï¼‰
4. AICRMä¸‰é¡¹åŠŸèƒ½ä¿®å¤ï¼ˆè”ç³»äºº/æŠ•æ ‡/å®¢æˆ·360ï¼‰
```

### ğŸ”„ å¾…å¼€å‘
```
1. å›æ¬¾ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§P0ï¼Œ1å‘¨ï¼‰
2. AIPMé¡¹ç›®ç®¡ç†æ¨¡å—ï¼ˆä¼˜å…ˆçº§P1ï¼Œ3å‘¨ï¼‰
```

---

## ğŸ¯ å¼€å‘è·¯çº¿å›¾

```
Week 1 (Dec 19-25)ï¼šå›æ¬¾ç®¡ç†æ¨¡å—
â”œâ”€ Day 1-2ï¼šæ•°æ®åº“è®¾è®¡ä¸åç«¯API
â”œâ”€ Day 3-4ï¼šå‰ç«¯ç•Œé¢å¼€å‘
â”œâ”€ Day 5ï¼šè§’è‰²æƒé™ä¸é€šçŸ¥
â””â”€ Day 6-7ï¼šæµ‹è¯•ä¸ä¼˜åŒ–

Week 2-3 (Dec 26 - Jan 8)ï¼šAIPM Phase 1
â”œâ”€ Week 2ï¼šåŸºç¡€æ¶æ„+ç”˜ç‰¹å›¾
â”‚  â”œâ”€ Day 1-2ï¼šæ•°æ®æ¨¡å‹è®¾è®¡
â”‚  â”œâ”€ Day 3-4ï¼šåŸºç¡€ç•Œé¢å¼€å‘
â”‚  â””â”€ Day 5ï¼šç”˜ç‰¹å›¾é›†æˆ
â””â”€ Week 3ï¼šWBS+è¿›åº¦ç®¡ç†+3D
   â”œâ”€ Day 1-2ï¼šWBSç®¡ç†
   â”œâ”€ Day 3-4ï¼šè¿›åº¦ç®¡ç†
   â””â”€ Day 5ï¼š3Då¯è§†åŒ–

Week 4 (Jan 9-15)ï¼šAIPM Phase 2
â”œâ”€ Day 1-2ï¼šAIèƒ½åŠ›é›†æˆ
â”œâ”€ Day 3-4ï¼šåä½œåŠŸèƒ½
â””â”€ Day 5ï¼šæµ‹è¯•+ä¼˜åŒ–
```

---

## ğŸ“‚ å¼€å‘å‰å‡†å¤‡

### 1. åˆ›å»ºå¼€å‘åˆ†æ”¯
```bash
cd c:/Users/EricZ/CodeBuddy/AIWEB1

# åˆ›å»ºå›æ¬¾ç®¡ç†å¼€å‘åˆ†æ”¯
git checkout -b feature/payment-management

# æˆ–åˆ›å»ºAIPMå¼€å‘åˆ†æ”¯
git checkout -b feature/aipm-module
```

### 2. æ£€æŸ¥å¼€å‘ç¯å¢ƒ
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node -v  # åº”ä¸º v16+

# æ£€æŸ¥ä¾èµ–
npm list

# å¦‚æœ‰ç¼ºå¤±ï¼Œé‡æ–°å®‰è£…
npm install
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
# å‰ç«¯å¼€å‘æœåŠ¡å™¨
npm run dev

# åç«¯æœåŠ¡å™¨ï¼ˆå¦‚æœéœ€è¦ï¼‰
cd server
node app.js
```

---

## ğŸ”¨ å›æ¬¾ç®¡ç†å¼€å‘æŒ‡å—

### Step 1ï¼šæ•°æ®åº“è®¾è®¡ï¼ˆDay 1ï¼‰

#### åˆ›å»ºæ•°æ®è¡¨
```javascript
// server/models/PaymentManagement.js

// åˆåŒè´¦æœŸè¡¨
const contractsReceivable = {
  id: String,                    // ä¸»é”®
  contract_no: String,           // åˆåŒç¼–å·
  contract_name: String,         // åˆåŒåç§°
  customer_id: String,           // å®¢æˆ·ID
  customer_name: String,         // å®¢æˆ·åç§°
  total_amount: Number,          // åˆåŒæ€»é‡‘é¢
  payment_terms: Array,          // è´¦æœŸä¿¡æ¯æ•°ç»„
  sales_person: String,          // é”€å”®äººå‘˜
  sales_manager: String,         // é”€å”®ç»ç†
  finance_person: String,        // è´¢åŠ¡è´Ÿè´£äºº
  admin_person: String,          // å†…å‹¤è´Ÿè´£äºº
  received_amount: Number,       // å·²æ”¶æ¬¾
  pending_amount: Number,        // å¾…æ”¶æ¬¾
  overdue_amount: Number,        // é€¾æœŸæ¬¾
  warning_status: String,        // é¢„è­¦çŠ¶æ€
  create_date: Date,
  update_date: Date
}

// å‚¬æ”¶è®°å½•è¡¨
const collectionRecords = {
  id: String,
  contract_id: String,
  term_id: String,
  collection_type: String,       // å‚¬æ”¶æ–¹å¼
  collection_date: Date,
  collector: String,
  contact_person: String,
  collection_result: String,
  next_follow_date: Date,
  status: String,
  notes: String
}
```

#### åˆ›å»ºAPIæ¥å£
```javascript
// server/routes/paymentManagement.js

// åˆåŒè´¦æœŸç®¡ç†API
router.post('/api/payment/contracts', createContract)           // æ–°å¢åˆåŒ
router.get('/api/payment/contracts', getContracts)             // è·å–åˆåŒåˆ—è¡¨
router.get('/api/payment/contracts/:id', getContractDetail)    // è·å–åˆåŒè¯¦æƒ…
router.put('/api/payment/contracts/:id', updateContract)       // æ›´æ–°åˆåŒ
router.delete('/api/payment/contracts/:id', deleteContract)    // åˆ é™¤åˆåŒ

// è´¦æœŸç®¡ç†API
router.post('/api/payment/terms', addPaymentTerm)              // æ·»åŠ è´¦æœŸ
router.put('/api/payment/terms/:id', updatePaymentTerm)        // æ›´æ–°è´¦æœŸ
router.post('/api/payment/terms/:id/receive', recordPayment)   // è®°å½•æ”¶æ¬¾

// å‚¬æ”¶ç®¡ç†API
router.post('/api/payment/collections', createCollection)      // æ–°å¢å‚¬æ”¶è®°å½•
router.get('/api/payment/collections', getCollections)        // è·å–å‚¬æ”¶è®°å½•

// é¢„è­¦æŸ¥è¯¢API
router.get('/api/payment/warnings', getPaymentWarnings)       // è·å–é¢„è­¦åˆ—è¡¨
router.get('/api/payment/statistics', getStatistics)          // è·å–ç»Ÿè®¡æ•°æ®
```

### Step 2ï¼šå‰ç«¯ç•Œé¢å¼€å‘ï¼ˆDay 3-4ï¼‰

#### åˆ›å»ºVueç»„ä»¶
```bash
# åœ¨src/componentsç›®å½•åˆ›å»º
PaymentManagementPanel.vue       # å›æ¬¾ç®¡ç†ä¸»ç•Œé¢
ContractDialog.vue               # åˆåŒæ–°å¢/ç¼–è¾‘å¯¹è¯æ¡†
PaymentTermManager.vue           # è´¦æœŸç®¡ç†ç»„ä»¶
CollectionRecordDialog.vue       # å‚¬æ”¶è®°å½•å¯¹è¯æ¡†
PaymentWarningList.vue           # é¢„è­¦åˆ—è¡¨ç»„ä»¶
PaymentStatistics.vue            # ç»Ÿè®¡çœ‹æ¿ç»„ä»¶
```

#### é›†æˆåˆ°AICRM
```javascript
// åœ¨ src/views/MingShengAICRM_V3.vue ä¸­

// 1. æ·»åŠ å¯¼èˆªèœå•é¡¹
<el-menu-item index="paymentManagement">
  <el-icon><Money /></el-icon>
  <span>å›æ¬¾ç®¡ç†</span>
</el-menu-item>

// 2. æ·»åŠ è§†å›¾åŒºåŸŸ
<div v-show="activeTab === 'paymentManagement'" class="payment-view">
  <PaymentManagementPanel />
</div>

// 3. å¯¼å…¥ç»„ä»¶
import PaymentManagementPanel from '@/components/PaymentManagementPanel.vue'
```

### Step 3ï¼šè§’è‰²æƒé™ï¼ˆDay 5ï¼‰

#### æƒé™é…ç½®
```javascript
// æƒé™çŸ©é˜µ
const permissions = {
  è´¢åŠ¡è´Ÿè´£äºº: ['æŸ¥çœ‹æ‰€æœ‰', 'å®¡æ‰¹ä»˜æ¬¾', 'å¯¼å‡ºæŠ¥è¡¨'],
  å†…å‹¤è´Ÿè´£äºº: ['å½•å…¥åˆåŒ', 'ç¼–è¾‘è´¦æœŸ', 'æŸ¥çœ‹é¢„è­¦'],
  é”€å”®: ['æŸ¥çœ‹è‡ªå·±çš„åˆåŒ', 'æäº¤å‚¬æ”¶', 'æ›´æ–°è¿›åº¦'],
  é”€å”®ç»ç†: ['æŸ¥çœ‹éƒ¨é—¨åˆåŒ', 'å®¡æ‰¹å‚¬æ”¶', 'æŸ¥çœ‹ç»Ÿè®¡']
}

// å®ç°æƒé™æ§åˆ¶
function checkPermission(action) {
  const role = getCurrentUserRole()
  return permissions[role].includes(action)
}
```

### Step 4ï¼šé¢„è­¦é€šçŸ¥ï¼ˆDay 5ï¼‰

#### é¢„è­¦è§„åˆ™
```javascript
// é¢„è­¦æ£€æŸ¥é€»è¾‘
function checkPaymentWarnings() {
  const today = new Date()
  const contracts = getAllContracts()
  
  contracts.forEach(contract => {
    contract.payment_terms.forEach(term => {
      if (term.status === 'å¾…æ”¶æ¬¾') {
        const daysTodue = calculateDays(today, term.due_date)
        
        if (daysTodue === 7) {
          sendWarning('æå‰7å¤©é¢„è­¦', contract, term)
        } else if (daysTodue === 3) {
          sendWarning('æå‰3å¤©é¢„è­¦', contract, term)
        } else if (daysTodue === 0) {
          sendWarning('å½“å¤©æé†’', contract, term)
        } else if (daysTodue < 0) {
          sendWarning('é€¾æœŸæé†’', contract, term)
        }
      }
    })
  })
}

// å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©æ—©ä¸Š9ç‚¹æ‰§è¡Œï¼‰
cron.schedule('0 9 * * *', checkPaymentWarnings)
```

---

## ğŸ¤– AIPMå¼€å‘æŒ‡å—

### Step 1ï¼šæŠ€æœ¯é€‰å‹ä¸å¼•å…¥ï¼ˆWeek 2 Day 1ï¼‰

#### å¼•å…¥ç”˜ç‰¹å›¾åº“
```bash
# å®‰è£…dhtmlx-gantt
npm install dhtmlx-gantt

# æˆ–å®‰è£…frappe-ganttï¼ˆè½»é‡çº§æ›¿ä»£ï¼‰
npm install frappe-gantt
```

#### å¼•å…¥3Då¯è§†åŒ–åº“
```bash
# å·²æœ‰EChartså’ŒECharts-GL
# å¦‚éœ€Three.js
npm install three
```

### Step 2ï¼šæ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆWeek 2 Day 1-2ï¼‰

#### é¡¹ç›®æ•°æ®ç»“æ„
```javascript
// é¡¹ç›®åŸºç¡€ä¿¡æ¯
const project = {
  id: "PRJ001",
  name: "XXå·¥å‚æ‹§ç´§ç³»ç»Ÿé¡¹ç›®",
  description: "é¡¹ç›®æè¿°",
  customer: "å¹¿æ±½æœ¬ç”°",
  start_date: "2025-01-15",
  end_date: "2025-09-30",
  status: "è¿›è¡Œä¸­",  // è¿›è¡Œä¸­/å·²å®Œæˆ/å»¶æœŸ/å–æ¶ˆ
  progress: 0.45,
  budget: 5000000,
  actual_cost: 2100000,
  project_manager: "å¼ å·¥",
  team_members: ["æå·¥", "ç‹å·¥", "èµµå·¥"],
  health_index: 75,  // é¡¹ç›®å¥åº·æŒ‡æ•° 0-100
  risk_level: "ä¸­",  // ä½/ä¸­/é«˜
  tags: ["é‡ç‚¹é¡¹ç›®", "Q1äº¤ä»˜"],
  create_date: "2025-01-15"
}

// WBSä»»åŠ¡ç»“æ„
const task = {
  id: "T001",
  project_id: "PRJ001",
  name: "éœ€æ±‚åˆ†æ",
  parent_id: null,  // çˆ¶ä»»åŠ¡ID
  start_date: "2025-01-15",
  end_date: "2025-02-15",
  duration: 30,  // å¤©
  progress: 1.0,  // 0-1
  assignee: "å¼ å·¥",
  dependencies: [],  // å‰ç½®ä»»åŠ¡IDs
  is_milestone: false,
  is_critical: true,  // æ˜¯å¦å…³é”®è·¯å¾„
  float: 0,  // æµ®åŠ¨æ—¶é—´
  status: "å·²å®Œæˆ",
  actual_start: "2025-01-15",
  actual_end: "2025-02-10",
  notes: ""
}
```

### Step 3ï¼šç”˜ç‰¹å›¾é›†æˆï¼ˆWeek 2 Day 5ï¼‰

#### dhtmlx-gantté›†æˆç¤ºä¾‹
```vue
<!-- GanttChart.vue -->
<template>
  <div class="gantt-container">
    <div id="gantt_here" style="width:100%; height:600px;"></div>
  </div>
</template>

<script setup>
import { onMounted } from 'vue'
import gantt from 'dhtmlx-gantt'
import 'dhtmlx-gantt/codebase/dhtmlxgantt.css'

const props = defineProps({
  tasks: Array,
  projectId: String
})

onMounted(() => {
  initGantt()
  loadTasks()
})

function initGantt() {
  gantt.config.xml_date = "%Y-%m-%d"
  gantt.config.columns = [
    {name:"text", label:"ä»»åŠ¡åç§°", width:"*", tree:true},
    {name:"start_date", label:"å¼€å§‹æ—¥æœŸ", align:"center"},
    {name:"duration", label:"æŒç»­æ—¶é—´", align:"center"},
    {name:"assignee", label:"è´Ÿè´£äºº", align:"center"}
  ]
  
  gantt.init("gantt_here")
}

function loadTasks() {
  const data = {
    data: props.tasks,
    links: extractLinks(props.tasks)
  }
  gantt.parse(data)
}
</script>
```

### Step 4ï¼š3Då¯è§†åŒ–ï¼ˆWeek 3 Day 5ï¼‰

#### ECharts-GL 3Dé¡¹ç›®åœ°å›¾
```vue
<!-- ProjectMap3D.vue -->
<template>
  <div ref="chartRef" style="width:100%; height:600px;"></div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import * as echarts from 'echarts'
import 'echarts-gl'

const chartRef = ref(null)
const props = defineProps({
  projects: Array
})

onMounted(() => {
  initChart()
})

function initChart() {
  const chart = echarts.init(chartRef.value)
  
  const option = {
    tooltip: {},
    xAxis3D: { type: 'value', name: 'æ—¶é—´' },
    yAxis3D: { type: 'value', name: 'é¡¹ç›®æ•°' },
    zAxis3D: { type: 'value', name: 'å¥åº·åº¦' },
    grid3D: {
      viewControl: {
        autoRotate: true
      }
    },
    series: [{
      type: 'scatter3D',
      data: props.projects.map(p => [
        p.progress,
        p.project_index,
        p.health_index
      ]),
      itemStyle: {
        color: (params) => {
          const health = params.value[2]
          return health > 80 ? '#67C23A' : 
                 health > 60 ? '#E6A23C' : 
                 health > 40 ? '#F56C6C' : '#909399'
        }
      },
      symbolSize: (params) => {
        return params.value[0] * 20  // è¿›åº¦å†³å®šå¤§å°
      }
    }]
  }
  
  chart.setOption(option)
}
</script>
```

---

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

### å›æ¬¾ç®¡ç†
- [ ] æ•°æ®åº“è¡¨åˆ›å»ºå®Œæˆ
- [ ] APIæ¥å£å¼€å‘å®Œæˆ
- [ ] å‰ç«¯ç»„ä»¶å¼€å‘å®Œæˆ
- [ ] é›†æˆåˆ°AICRMå®Œæˆ
- [ ] è§’è‰²æƒé™å®ç°å®Œæˆ
- [ ] é¢„è­¦é€šçŸ¥åŠŸèƒ½å®Œæˆ
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·æ–‡æ¡£ç¼–å†™å®Œæˆ

### AIPM
- [ ] ç”˜ç‰¹å›¾åº“å¼•å…¥æˆåŠŸ
- [ ] é¡¹ç›®æ•°æ®æ¨¡å‹è®¾è®¡å®Œæˆ
- [ ] é¡¹ç›®åˆ—è¡¨ç•Œé¢å®Œæˆ
- [ ] WBSç®¡ç†åŠŸèƒ½å®Œæˆ
- [ ] ç”˜ç‰¹å›¾å±•ç¤ºå®Œæˆ
- [ ] 3Då¯è§†åŒ–å®Œæˆ
- [ ] AIåˆ†æåŠŸèƒ½å®Œæˆ
- [ ] æµ‹è¯•é€šè¿‡

---

## ğŸ› å¸¸è§é—®é¢˜ä¸è§£å†³

### é—®é¢˜1ï¼šç”˜ç‰¹å›¾ä¸æ˜¾ç¤º
```
åŸå› ï¼šå®¹å™¨é«˜åº¦ä¸º0
è§£å†³ï¼šç¡®ä¿å®¹å™¨æœ‰æ˜ç¡®é«˜åº¦ï¼Œä½¿ç”¨nextTickç¡®ä¿DOMæ¸²æŸ“
```

### é—®é¢˜2ï¼š3Då›¾è¡¨æ¸²æŸ“é”™è¯¯
```
åŸå› ï¼šECharts-GLæœªæ­£ç¡®åŠ è½½
è§£å†³ï¼šæ£€æŸ¥importè¯­å¥ï¼Œç¡®ä¿ 'echarts-gl' æ­£ç¡®å¯¼å…¥
```

### é—®é¢˜3ï¼šæƒé™æ§åˆ¶ä¸ç”Ÿæ•ˆ
```
åŸå› ï¼šç”¨æˆ·è§’è‰²è·å–å¤±è´¥
è§£å†³ï¼šæ£€æŸ¥ç™»å½•çŠ¶æ€å’Œè§’è‰²å­˜å‚¨ï¼Œç¡®ä¿roleå­—æ®µæ­£ç¡®
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [dhtmlx-ganttæ–‡æ¡£](https://docs.dhtmlx.com/gantt/)
- [ECharts-GLæ–‡æ¡£](https://echarts.apache.org/zh/option-gl.html)
- [Vue 3æ–‡æ¡£](https://cn.vuejs.org/)
- [Element Plusæ–‡æ¡£](https://element-plus.org/zh-CN/)

### ç¤ºä¾‹ä»£ç 
- AICRMå·²æœ‰ä»£ç ï¼š`src/views/MingShengAICRM_V3.vue`
- äº§å“æ–¹æ¡ˆæ–‡æ¡£ï¼š`ğŸ“Š_AIPMæ™ºèƒ½é¡¹ç›®ç®¡ç†å®Œæ•´äº§å“æ–¹æ¡ˆ_2025-12-19_v1.0.md`
- å¼€å‘è®¡åˆ’æ–‡æ¡£ï¼š`ğŸ“‹_å›æ¬¾ç®¡ç†ä¸AIPMå¼€å‘è®¡åˆ’_2025-12-19_v1.0.md`

---

## ğŸš€ ç«‹å³å¼€å§‹

### å¼€å§‹å›æ¬¾ç®¡ç†å¼€å‘
```bash
# 1. åˆ›å»ºå¼€å‘åˆ†æ”¯
git checkout -b feature/payment-management

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 3. å¼€å§‹ç¼–ç 
# å‚è€ƒä¸Šé¢çš„Step-by-StepæŒ‡å—
```

### å¼€å§‹AIPMå¼€å‘
```bash
# 1. å®‰è£…å¿…è¦ä¾èµ–
npm install dhtmlx-gantt

# 2. åˆ›å»ºå¼€å‘åˆ†æ”¯
git checkout -b feature/aipm-module

# 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 4. å¼€å§‹ç¼–ç 
# å‚è€ƒä¸Šé¢çš„Step-by-StepæŒ‡å—
```

---

**æŒ‡å—åˆ›å»ºæ—¶é—´**: 2025-12-19  
**ä¸‹æ¬¡æ›´æ–°**: æ ¹æ®å¼€å‘è¿›åº¦æ›´æ–°  
**ç»´æŠ¤å›¢é˜Ÿ**: AIWEBå¼€å‘ç»„

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸ‰
