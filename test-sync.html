<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®åŒæ­¥æµ‹è¯•å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      margin-bottom: 24px;
      text-align: center;
    }
    
    .header h1 {
      color: #667eea;
      font-size: 32px;
      margin-bottom: 8px;
    }
    
    .header p {
      color: #666;
      font-size: 16px;
    }
    
    .panel {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    
    .panel h2 {
      color: #333;
      font-size: 20px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #52c41a;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 12px;
      margin-bottom: 12px;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
      color: #333;
    }
    
    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
    }
    
    .data-display {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
    }
    
    .log-item {
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 6px;
      background: white;
      border-left: 4px solid #667eea;
    }
    
    .log-item.success {
      border-left-color: #52c41a;
      background: #f6ffed;
    }
    
    .log-item.error {
      border-left-color: #ff4d4f;
      background: #fff2f0;
    }
    
    .log-item.warning {
      border-left-color: #faad14;
      background: #fffbe6;
    }
    
    .timestamp {
      color: #999;
      font-size: 11px;
      margin-right: 8px;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #667eea30;
    }
    
    .stat-label {
      color: #666;
      font-size: 13px;
      margin-bottom: 8px;
    }
    
    .stat-value {
      color: #333;
      font-size: 28px;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- æ ‡é¢˜ -->
    <div class="header">
      <h1>ğŸ“±ğŸ’» æ‰‹æœºç«¯ & ç”µè„‘ç«¯æ•°æ®åŒæ­¥æµ‹è¯•</h1>
      <p>æ£€æµ‹ localStorage ä¸åç«¯ API çš„æ•°æ®åŒæ­¥çŠ¶æ€</p>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="panel">
      <h2>
        <span class="status-indicator"></span>
        æ§åˆ¶æ“ä½œ
      </h2>
      <button class="btn" onclick="testAPIConnection()">ğŸ”— æµ‹è¯• API è¿æ¥</button>
      <button class="btn" onclick="loadFromAPI()">â¬‡ï¸ ä» API åŠ è½½æ•°æ®</button>
      <button class="btn" onclick="checkLocalStorage()">ğŸ’¾ æ£€æŸ¥ localStorage</button>
      <button class="btn btn-secondary" onclick="clearLocalStorage()">ğŸ—‘ï¸ æ¸…ç©ºæœ¬åœ°ç¼“å­˜</button>
      <button class="btn btn-danger" onclick="resetAllData()">âš ï¸ é‡ç½®æ‰€æœ‰æ•°æ®</button>
    </div>
    
    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="panel">
      <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡</h2>
      <div class="grid">
        <div class="stat-card">
          <div class="stat-label">Banner æ•°é‡</div>
          <div class="stat-value" id="bannerCount">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">äº§å“åˆ†ç±»æ•°</div>
          <div class="stat-value" id="categoryCount">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">localStorage å¤§å°</div>
          <div class="stat-value" id="storageSize">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æœ€ååŒæ­¥æ—¶é—´</div>
          <div class="stat-value" id="lastSync" style="font-size: 16px;">-</div>
        </div>
      </div>
    </div>
    
    <!-- æ—¥å¿—è¾“å‡º -->
    <div class="panel">
      <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
      <div id="logOutput" class="data-display">
        <div class="log-item">ç­‰å¾…æ“ä½œ...</div>
      </div>
    </div>
    
    <!-- æ•°æ®è¯¦æƒ… -->
    <div class="panel">
      <h2>ğŸ“¦ æ•°æ®è¯¦æƒ…</h2>
      <div id="dataOutput" class="data-display">
        ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŸ¥çœ‹æ•°æ®è¯¦æƒ…
      </div>
    </div>
  </div>
  
  <script>
    // æ—¥å¿—è¾“å‡º
    function log(message, type = 'info') {
      const logOutput = document.getElementById('logOutput')
      const timestamp = new Date().toLocaleTimeString('zh-CN')
      const logItem = document.createElement('div')
      logItem.className = `log-item ${type}`
      logItem.innerHTML = `<span class="timestamp">[${timestamp}]</span>${message}`
      logOutput.insertBefore(logItem, logOutput.firstChild)
      
      // é™åˆ¶æ—¥å¿—æ•°é‡
      while (logOutput.children.length > 50) {
        logOutput.removeChild(logOutput.lastChild)
      }
    }
    
    // æµ‹è¯• API è¿æ¥
    async function testAPIConnection() {
      log('ğŸ” æ­£åœ¨æµ‹è¯• API è¿æ¥...', 'info')
      try {
        const response = await fetch('/api/content/banners')
        if (response.ok) {
          const data = await response.json()
          log(`âœ… API è¿æ¥æˆåŠŸï¼è·å–åˆ° ${data.data.length} ä¸ª Banner`, 'success')
          updateStats()
        } else {
          log(`âŒ API è¿”å›é”™è¯¯: ${response.status}`, 'error')
        }
      } catch (error) {
        log(`âŒ API è¿æ¥å¤±è´¥: ${error.message}`, 'error')
      }
    }
    
    // ä» API åŠ è½½æ•°æ®
    async function loadFromAPI() {
      log('â¬‡ï¸ æ­£åœ¨ä» API åŠ è½½æ•°æ®...', 'info')
      try {
        // åŠ è½½ Banner
        const bannersRes = await fetch('/api/content/banners')
        if (bannersRes.ok) {
          const bannersData = await bannersRes.json()
          if (bannersData.success) {
            // è½¬æ¢ä¸ºå¤šè¯­è¨€æ ¼å¼
            const banners = bannersData.data.map(b => ({
              id: b.id,
              title: typeof b.title === 'string' 
                ? { 'zh-CN': b.title, 'en-US': b.title }
                : b.title,
              subtitle: typeof b.subtitle === 'string'
                ? { 'zh-CN': b.subtitle, 'en-US': b.subtitle }
                : b.subtitle,
              image: b.image,
              buttonText: typeof b.buttonText === 'string'
                ? { 'zh-CN': b.buttonText, 'en-US': b.buttonText }
                : b.buttonText,
              buttonAction: b.link || 'about',
              status: b.active ? 'active' : 'inactive',
              order: b.id
            }))
            
            localStorage.setItem('homeBanners', JSON.stringify(banners))
            log(`âœ… Banner æ•°æ®å·²åŒæ­¥åˆ° localStorage (${banners.length} ä¸ª)`, 'success')
          }
        }
        
        // åŠ è½½é…ç½®
        const configRes = await fetch('/api/content/config')
        if (configRes.ok) {
          const configData = await configRes.json()
          if (configData.success && configData.data.logo) {
            localStorage.setItem('siteLogo', configData.data.logo)
            log(`âœ… Logo å·²åŒæ­¥: ${configData.data.logo}`, 'success')
          }
        }
        
        localStorage.setItem('lastSyncTime', new Date().toISOString())
        updateStats()
        checkLocalStorage()
      } catch (error) {
        log(`âŒ åŠ è½½å¤±è´¥: ${error.message}`, 'error')
      }
    }
    
    // æ£€æŸ¥ localStorage
    function checkLocalStorage() {
      log('ğŸ’¾ æ­£åœ¨æ£€æŸ¥ localStorage...', 'info')
      const dataOutput = document.getElementById('dataOutput')
      
      const keys = [
        'homeBanners',
        'siteLogo',
        'themeColors',
        'productsLevel1',
        'productsLevel2',
        'productsLevel3',
        'lastSyncTime'
      ]
      
      let html = '<div style="font-family: monospace;">'
      keys.forEach(key => {
        const value = localStorage.getItem(key)
        if (value) {
          const displayValue = value.length > 200 ? value.substring(0, 200) + '...' : value
          html += `<div style="margin-bottom: 16px;">
            <strong style="color: #667eea;">${key}:</strong><br>
            <span style="color: #666;">${displayValue}</span>
          </div>`
        }
      })
      html += '</div>'
      
      dataOutput.innerHTML = html
      log(`âœ… localStorage æ£€æŸ¥å®Œæˆ`, 'success')
      updateStats()
    }
    
    // æ¸…ç©ºæœ¬åœ°ç¼“å­˜
    function clearLocalStorage() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°ç¼“å­˜å—ï¼Ÿè¿™å°†åˆ é™¤æ‰€æœ‰ä¿å­˜åœ¨æµè§ˆå™¨ä¸­çš„æ•°æ®ã€‚')) {
        const keysToRemove = [
          'homeBanners',
          'siteLogo',
          'themeColors',
          'productsLevel1',
          'productsLevel2',
          'productsLevel3',
          'featuredProducts',
          'pageContents'
        ]
        
        keysToRemove.forEach(key => localStorage.removeItem(key))
        log('ğŸ—‘ï¸ æœ¬åœ°ç¼“å­˜å·²æ¸…ç©º', 'warning')
        updateStats()
        document.getElementById('dataOutput').innerHTML = 'æœ¬åœ°ç¼“å­˜å·²æ¸…ç©º'
      }
    }
    
    // é‡ç½®æ‰€æœ‰æ•°æ®
    function resetAllData() {
      if (confirm('âš ï¸ è­¦å‘Šï¼šè¿™å°†æ¸…ç©ºæ‰€æœ‰æ•°æ®å¹¶é‡æ–°ä» API åŠ è½½ã€‚ç¡®å®šç»§ç»­å—ï¼Ÿ')) {
        clearLocalStorage()
        setTimeout(() => {
          loadFromAPI()
        }, 500)
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      // Banner æ•°é‡
      const banners = localStorage.getItem('homeBanners')
      const bannerCount = banners ? JSON.parse(banners).length : 0
      document.getElementById('bannerCount').textContent = bannerCount
      
      // äº§å“åˆ†ç±»æ•°
      const level1 = localStorage.getItem('productsLevel1')
      const categoryCount = level1 ? JSON.parse(level1).length : 0
      document.getElementById('categoryCount').textContent = categoryCount
      
      // localStorage å¤§å°
      let totalSize = 0
      for (let key in localStorage) {
        if (localStorage.hasOwnProperty(key)) {
          totalSize += localStorage[key].length + key.length
        }
      }
      document.getElementById('storageSize').textContent = (totalSize / 1024).toFixed(2) + ' KB'
      
      // æœ€ååŒæ­¥æ—¶é—´
      const lastSync = localStorage.getItem('lastSyncTime')
      if (lastSync) {
        const syncDate = new Date(lastSync)
        document.getElementById('lastSync').textContent = syncDate.toLocaleString('zh-CN')
      } else {
        document.getElementById('lastSync').textContent = 'ä»æœªåŒæ­¥'
      }
    }
    
    // é¡µé¢åŠ è½½æ—¶æ›´æ–°ç»Ÿè®¡
    window.onload = () => {
      log('ğŸš€ æ•°æ®åŒæ­¥æµ‹è¯•å·¥å…·å·²å¯åŠ¨', 'success')
      updateStats()
    }
  </script>
</body>
</html>
