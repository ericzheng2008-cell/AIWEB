# 🛠️ 快速入门: 数据库维护任务

> 5分钟学会使用 ToolsNet 数据库维护功能

---

## 🎯 开始之前

### 你将学到
✅ 如何访问数据库维护界面  
✅ 如何执行维护任务  
✅ 如何配置自动维护  
✅ 如何查看维护统计

### 前置条件
- 已启动拧紧数据采集系统
- 拥有管理员权限
- 浏览器访问 http://localhost:5173

---

## 📍 步骤 1: 进入维护界面

1. 登录系统（管理员账号）
2. 点击左侧菜单「拧紧数据采集」
3. 切换到「**数据库维护**」标签页

![维护界面](你会看到5个维护任务卡片)

---

## 🔧 步骤 2: 了解维护任务

### 5个核心任务

| 任务 | 作用 | 推荐频率 |
|------|------|---------|
| 🗑️ **删除维护** | 清理过期数据 | 每日 |
| 📊 **删除未绑定曲线** | 清理孤立曲线 | 每日 |
| 🔄 **索引重组** | 优化查询性能 | 每日 |
| 🔨 **索引重建** | 深度优化 | 每周 |
| 📦 **数据归档** | 归档历史数据 | 每月 |

---

## ⚡ 步骤 3: 执行第一个维护任务

### 方法 A: 执行单个任务

1. 找到「**删除未绑定曲线**」任务卡片
2. 确认开关是「**已启用**」状态 ✅
3. 点击右侧「**执行**」按钮
4. 等待执行完成（通常几秒钟）
5. 查看执行结果通知

**示例结果**:
```
✅ 未绑定曲线删除完成
已删除: 120 条曲线
剩余: 880 条曲线
```

### 方法 B: 批量执行

1. 点击标题栏「**执行所有启用任务**」按钮
2. 在弹窗中确认执行
3. 系统会依次执行所有启用的任务
4. 查看执行结果汇总

---

## ⚙️ 步骤 4: 配置自动维护

### 启用/禁用任务

每个任务卡片都有一个开关：
- **绿色 = 已启用** ✅
- **灰色 = 已禁用** ⬜

点击开关即可切换状态。

### 配置保留天数（删除维护任务）

1. 找到「删除维护」任务
2. 找到「保留天数」输入框
3. 输入天数（7-365天）
4. 系统自动保存配置

**建议值**:
- 测试环境: 30天
- 生产环境: 90天
- 审计要求高: 180天+

---

## 📊 步骤 5: 查看维护统计

### 顶部统计卡片

界面顶部显示4个关键指标：

1. **数据库大小**: 当前数据库占用空间
2. **当前结果数**: 拧紧结果记录数量
3. **当前曲线数**: 拧紧曲线记录数量
4. **索引碎片率**: 数据库性能指标

### 底部维护历史

界面底部显示累计统计：

- 已删除结果总数
- 已删除曲线总数
- 已归档记录总数
- 上次维护时间

---

## 🎯 实战案例

### 案例 1: 数据库存储空间不足

**问题**: 数据库大小超过10GB

**解决方案**:
1. 启用「删除维护」任务
2. 设置保留天数为 60 天
3. 执行任务
4. 启用「数据归档」任务
5. 归档3个月前的数据

**预期效果**: 数据库大小降至 3-5GB

---

### 案例 2: 查询速度变慢

**问题**: 报表查询耗时超过30秒

**解决方案**:
1. 查看「索引碎片率」指标
2. 如果 > 15%，执行「索引重组」
3. 如果 > 30%，执行「索引重建」

**预期效果**: 
- 查询速度提升 50-200%
- 碎片率降至 < 5%

---

### 案例 3: PowerMACS系统优化

**问题**: PowerMACS产生大量未使用的曲线数据

**解决方案**:
1. 启用「删除未绑定曲线」任务
2. 每日自动执行
3. 定期查看删除数量

**预期效果**: 
- 曲线数据减少 30-50%
- 存储空间释放

---

## 📅 推荐维护计划

### 每日维护（自动）

```
凌晨 2:00 - 索引重组
凌晨 3:00 - 删除维护
凌晨 4:00 - 删除未绑定曲线
```

### 每周维护（周日）

```
凌晨 1:00 - 索引重建（深度优化）
```

### 每月维护（月初）

```
归档上个月数据
备份归档数据库
```

---

## ⚠️ 注意事项

### 执行时机

| 任务 | 最佳执行时间 | 原因 |
|------|------------|------|
| 删除维护 | 凌晨3-5点 | 避免影响白天使用 |
| 索引重组 | 凌晨2-4点 | 低峰期，影响小 |
| 索引重建 | 周末凌晨 | 耗时较长，需要空闲时段 |
| 数据归档 | 非生产时间 | 涉及大量数据移动 |

### 安全提醒

1. ⚠️ **删除维护任务**执行前确认保留天数设置
2. ⚠️ **索引重建**期间查询性能会短暂下降
3. ⚠️ **数据归档**前确保归档数据库可访问
4. ✅ 建议先在测试环境验证

---

## 🔍 故障排查

### 问题 1: 任务执行失败

**可能原因**:
- 数据库连接断开
- 权限不足
- 磁盘空间不足

**解决方法**:
1. 检查数据库连接状态
2. 确认用户权限
3. 清理磁盘空间
4. 重试执行

---

### 问题 2: 任务执行缓慢

**可能原因**:
- 数据量过大
- 服务器性能不足
- 其他任务并发执行

**解决方法**:
1. 选择低峰期执行
2. 单独执行耗时任务
3. 升级服务器配置

---

### 问题 3: 删除维护没有删除任何数据

**可能原因**:
- 所有数据都在保留期内
- 任务未启用

**解决方法**:
1. 检查保留天数设置
2. 确认任务已启用
3. 查看数据时间范围

---

## 📱 快捷操作

### 键盘快捷键（规划中）

- `Alt + M` - 打开维护界面
- `Alt + R` - 执行所有任务
- `Alt + S` - 查看统计信息

### 命令行操作（规划中）

```bash
# 执行所有维护任务
npm run maintenance:all

# 执行单个任务
npm run maintenance:delete
npm run maintenance:index-rebuild
```

---

## 💡 专家建议

### 优化建议 1: 渐进式清理

不要一次性删除过多数据，建议：
1. 第一次设置保留期 120 天
2. 观察一周
3. 逐步调整到 90 天
4. 最终稳定在合理值

### 优化建议 2: 监控指标

重点关注以下指标：
- **索引碎片率**: 保持 < 10%
- **数据库增长**: 每月 < 10%
- **任务执行时间**: 稳定在正常范围

### 优化建议 3: 归档策略

建议采用分级归档：
- **热数据**: 近1个月（主库）
- **温数据**: 1-3个月（主库）
- **冷数据**: 3-12个月（归档库）
- **历史数据**: 1年以上（离线存储）

---

## 📚 延伸阅读

- [功能更新_数据库维护任务_2025-12-14_v1.0.0.md](./功能更新_数据库维护任务_2025-12-14_v1.0.0.md) - 完整技术文档
- [功能文档_拧紧数据采集系统_ToolsNet8架构_2025-12-14_v3.0.0.md](./功能文档_拧紧数据采集系统_ToolsNet8架构_2025-12-14_v3.0.0.md) - 系统架构
- ToolsNet 8 官方文档 - 数据库维护最佳实践

---

## ❓ 常见问题

### Q1: 多久执行一次维护任务？

**A**: 推荐每日执行删除维护和索引重组，每周执行索引重建，每月执行数据归档。

---

### Q2: 维护任务会影响正常使用吗？

**A**: 
- 索引重组和删除任务：影响极小
- 索引重建：短暂影响（建议非高峰期）
- 数据归档：需要计划停机窗口

---

### Q3: 如何恢复误删的数据？

**A**: 
1. 检查归档数据库
2. 从备份恢复
3. 联系技术支持

**预防措施**: 删除前做好备份，设置合理的保留期。

---

### Q4: 索引碎片率多少算正常？

**A**: 
- < 5%: 优秀
- 5-10%: 良好
- 10-30%: 需要重组
- > 30%: 需要重建

---

### Q5: 能否自定义维护任务？

**A**: 当前版本支持5个标准任务，自定义功能计划在下一版本中添加。

---

## ✅ 检查清单

开始使用前，确认以下事项：

- [ ] 已登录管理员账号
- [ ] 已进入数据库维护标签页
- [ ] 已了解5个维护任务的作用
- [ ] 已查看当前数据库统计
- [ ] 已配置合适的保留天数
- [ ] 已启用必要的维护任务
- [ ] 已在测试环境验证（生产环境）

---

## 🎉 完成！

恭喜！你已经掌握了数据库维护任务的使用方法。

**下一步建议**:
1. 制定适合你的维护计划
2. 设置任务自动执行（定时任务）
3. 建立监控告警机制
4. 定期审查维护效果

**需要帮助？** 
- 查看完整文档
- 联系技术支持
- 访问在线社区

---

**版本**: v1.0.0  
**更新时间**: 2025-12-14  
**预计学习时间**: 5分钟  
**难度等级**: ⭐⭐☆☆☆
