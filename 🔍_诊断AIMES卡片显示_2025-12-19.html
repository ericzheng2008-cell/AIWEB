<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>è¯Šæ–­AIMESå¡ç‰‡æ˜¾ç¤ºé—®é¢˜</title>
  <style>
    body { font-family: 'Microsoft YaHei', Arial; padding: 20px; background: #f5f7fa; }
    .diagnostic-panel { background: white; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
    h2 { color: #409EFF; border-bottom: 2px solid #409EFF; padding-bottom: 10px; }
    h3 { color: #67C23A; margin-top: 20px; }
    .step { background: #ecf5ff; border-left: 4px solid #409EFF; padding: 15px; margin: 10px 0; }
    .code-block { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 4px; overflow-x: auto; font-family: 'Consolas', monospace; font-size: 14px; margin: 10px 0; }
    .warning { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 10px 0; }
    .success { background: #e8f5e9; border-left: 4px solid #4caf50; padding: 15px; margin: 10px 0; }
    button { background: #409EFF; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 5px; }
    button:hover { background: #66b1ff; }
    .btn-check { background: #67C23A; }
    .btn-check:hover { background: #85ce61; }
    .btn-clear { background: #E6A23C; }
    .btn-clear:hover { background: #ebb563; }
    .result { margin: 15px 0; padding: 10px; background: #f0f9ff; border-radius: 4px; }
  </style>
</head>
<body>

<div class="diagnostic-panel">
  <h2>ğŸ” AIMESæ™ºèƒ½ä½“å¡ç‰‡æ˜¾ç¤ºè¯Šæ–­å·¥å…·</h2>
  <p>æœ¬å·¥å…·å¸®åŠ©æ‚¨è¯Šæ–­ä¸ºä»€ä¹ˆAIMESå¡ç‰‡å¯èƒ½çœ‹ä¸åˆ°</p>
  
  <div class="success">
    <strong>âœ… ä»£ç éªŒè¯é€šè¿‡ï¼š</strong>
    <ul>
      <li>AIMESæ•°æ®å­˜åœ¨äº aiAgents æ•°ç»„ï¼ˆç¬¬4é¡¹ï¼‰</li>
      <li>å¸ƒå±€å·²è°ƒæ•´ä¸º :span="6"ï¼ˆæ¯è¡Œ4ä¸ªå¡ç‰‡ï¼‰</li>
      <li>æ— ä»»ä½•è¿‡æ»¤æˆ–éšè—æ¡ä»¶</li>
    </ul>
  </div>

  <h3>ğŸ¯ å¯èƒ½çš„åŸå› </h3>
  
  <div class="step">
    <strong>åŸå› 1ï¼šæµè§ˆå™¨ç¼“å­˜æœªæ›´æ–°</strong>
    <p>æœ€å¸¸è§ï¼ä¿®æ”¹ä»£ç åæµè§ˆå™¨å¯èƒ½ä»åœ¨ä½¿ç”¨æ—§ç‰ˆæœ¬</p>
    <button class="btn-clear" onclick="clearCacheAndReload()">ğŸ”„ æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°</button>
  </div>

  <div class="step">
    <strong>åŸå› 2ï¼šé¡µé¢éœ€è¦æ»šåŠ¨</strong>
    <p>å¦‚æœçª—å£è¾ƒå°ï¼Œç¬¬4ä¸ªå¡ç‰‡å¯èƒ½åœ¨è§†å£å¤–</p>
    <button class="btn-check" onclick="checkViewport()">ğŸ“ æ£€æŸ¥å¡ç‰‡ä½ç½®</button>
  </div>

  <div class="step">
    <strong>åŸå› 3ï¼šCSSæ ·å¼é—®é¢˜</strong>
    <p>å¡ç‰‡å¯èƒ½è¢«éšè—æˆ–é€æ˜</p>
    <button class="btn-check" onclick="checkStyles()">ğŸ¨ æ£€æŸ¥æ ·å¼</button>
  </div>

  <div class="step">
    <strong>åŸå› 4ï¼šå¼€å‘æœåŠ¡å™¨æœªé‡å¯</strong>
    <p>æŸäº›ä¿®æ”¹éœ€è¦é‡å¯æœåŠ¡å™¨æ‰èƒ½ç”Ÿæ•ˆ</p>
    <button onclick="window.location.reload()">ğŸ”„ åˆ·æ–°é¡µé¢</button>
  </div>

  <h3>ğŸ“‹ æ‰‹åŠ¨æ£€æŸ¥æ­¥éª¤</h3>
  
  <div class="code-block">
// æ­¥éª¤1: æ‰“å¼€ http://localhost:5173
// æ­¥éª¤2: ç‚¹å‡»é¡¶éƒ¨å¯¼èˆª "AIæ™ºèƒ½ä½“"
// æ­¥éª¤3: æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
// æ­¥éª¤4: åœ¨æ§åˆ¶å°ç²˜è´´ä»¥ä¸‹ä»£ç ï¼š

// æ£€æŸ¥æ•°æ®
console.log('=== AIMESå¡ç‰‡è¯Šæ–­ ===');
const app = document.querySelector('#app').__vueParentComponent;
const aiAgents = app?.ctx?.aiAgents || [];
console.log('æ™ºèƒ½ä½“æ€»æ•°:', aiAgents.length);
console.log('æ‰€æœ‰æ™ºèƒ½ä½“:', aiAgents.map(a => a.name));
console.log('AIMESå­˜åœ¨?', aiAgents.some(a => a.name.includes('AIMES')));

// æ£€æŸ¥DOM
const cards = document.querySelectorAll('.agent-card');
console.log('æ¸²æŸ“çš„å¡ç‰‡æ•°:', cards.length);
cards.forEach((card, i) => {
  const title = card.querySelector('h3')?.textContent;
  const rect = card.getBoundingClientRect();
  console.log(`å¡ç‰‡${i+1}: ${title}`);
  console.log(`  ä½ç½®: top=${rect.top}, left=${rect.left}, å¯è§=${rect.top >= 0 && rect.left >= 0}`);
});
  </div>

  <div class="warning">
    <strong>âš ï¸ å¦‚æœä»¥ä¸Šéƒ½ä¸èƒ½è§£å†³ï¼š</strong>
    <ol>
      <li>ç¡®è®¤è®¿é—®çš„æ˜¯æ­£ç¡®çš„URL: <code>http://localhost:5173/#/aicrm?tab=aiAgent</code></li>
      <li>æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</li>
      <li>å°è¯•åœ¨æ— ç—•æ¨¡å¼æ‰“å¼€é¡µé¢</li>
      <li>æ£€æŸ¥ src/views/MingShengAICRM_V3.vue æ–‡ä»¶æ˜¯å¦ä¿å­˜æˆåŠŸ</li>
    </ol>
  </div>

  <div id="diagnosticResult" class="result" style="display:none;"></div>

  <h3>ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
  <button onclick="openAICRM()">ğŸ“± æ‰“å¼€AIæ™ºèƒ½ä½“é¡µé¢</button>
  <button class="btn-check" onclick="runFullDiagnostic()">ğŸ”¬ è¿è¡Œå®Œæ•´è¯Šæ–­</button>
</div>

<script>
function clearCacheAndReload() {
  alert('å³å°†æ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢ï¼\n\nè¯·åœ¨æ–°æ‰“å¼€çš„é¡µé¢ä¸­æŒ‰ Ctrl+Shift+R å¼ºåˆ¶åˆ·æ–°');
  setTimeout(() => {
    window.open('http://localhost:5173/#/aicrm?tab=aiAgent', '_blank');
  }, 1000);
}

function checkViewport() {
  showResult('æ­£åœ¨æ£€æŸ¥...\nè¯·åœ¨AICRMé¡µé¢æŒ‰F12æ‰“å¼€æ§åˆ¶å°ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š\n\ndocument.querySelectorAll(\'.agent-card\').forEach((card, i) => {\n  const rect = card.getBoundingClientRect();\n  const title = card.querySelector(\'h3\')?.textContent;\n  console.log(`å¡ç‰‡${i+1} ${title}:`, rect.top >= 0 && rect.left >= 0 ? \'âœ…å¯è§\' : \'âŒä¸å¯è§\');\n});');
}

function checkStyles() {
  showResult('æ­£åœ¨æ£€æŸ¥æ ·å¼...\nè¯·åœ¨AICRMé¡µé¢æŒ‰F12æ‰“å¼€æ§åˆ¶å°ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š\n\ndocument.querySelectorAll(\'.agent-card\').forEach(card => {\n  const styles = window.getComputedStyle(card);\n  console.log(\'display:\', styles.display);\n  console.log(\'visibility:\', styles.visibility);\n  console.log(\'opacity:\', styles.opacity);\n});');
}

function openAICRM() {
  window.open('http://localhost:5173/#/aicrm?tab=aiAgent', '_blank');
}

function runFullDiagnostic() {
  const diagnosticCode = `
console.clear();
console.log('%cğŸ” AIMESå¡ç‰‡å®Œæ•´è¯Šæ–­', 'font-size:20px;color:#409EFF;font-weight:bold');
console.log('');

// 1. æ£€æŸ¥Vueæ•°æ®
try {
  const app = document.querySelector('#app').__vueParentComponent;
  const data = app?.ctx;
  console.log('%c1ï¸âƒ£ Vueæ•°æ®æ£€æŸ¥', 'font-size:16px;color:#67C23A;font-weight:bold');
  console.log('aiAgentsæ•°ç»„:', data?.aiAgents || 'æœªæ‰¾åˆ°');
  console.log('æ™ºèƒ½ä½“æ•°é‡:', data?.aiAgents?.length || 0);
  if (data?.aiAgents) {
    data.aiAgents.forEach((agent, i) => {
      console.log(\`  \${i+1}. \${agent.name} (ID:\${agent.id})\`);
    });
  }
} catch(e) {
  console.error('Vueæ•°æ®è®¿é—®å¤±è´¥:', e);
}

console.log('');

// 2. æ£€æŸ¥DOMæ¸²æŸ“
console.log('%c2ï¸âƒ£ DOMæ¸²æŸ“æ£€æŸ¥', 'font-size:16px;color:#E6A23C;font-weight:bold');
const cards = document.querySelectorAll('.agent-card');
console.log('æ¸²æŸ“çš„å¡ç‰‡æ•°é‡:', cards.length);
cards.forEach((card, i) => {
  const title = card.querySelector('h3')?.textContent || 'æ— æ ‡é¢˜';
  const rect = card.getBoundingClientRect();
  const isVisible = rect.top >= 0 && rect.left >= 0 && rect.bottom <= window.innerHeight && rect.right <= window.innerWidth;
  console.log(\`  å¡ç‰‡\${i+1}: \${title}\`);
  console.log(\`    ä½ç½®: (\${Math.round(rect.left)}, \${Math.round(rect.top)})\`);
  console.log(\`    å°ºå¯¸: \${Math.round(rect.width)}Ã—\${Math.round(rect.height)}\`);
  console.log(\`    çŠ¶æ€: \${isVisible ? 'âœ…å®Œå…¨å¯è§' : 'âš ï¸éƒ¨åˆ†å¯è§æˆ–ä¸å¯è§'}\`);
});

console.log('');

// 3. æ£€æŸ¥AIMESå¡ç‰‡
console.log('%c3ï¸âƒ£ AIMESå¡ç‰‡ä¸“é¡¹æ£€æŸ¥', 'font-size:16px;color:#9C27B0;font-weight:bold');
const aimesCard = Array.from(cards).find(card => 
  card.querySelector('h3')?.textContent?.includes('AIMES')
);
if (aimesCard) {
  console.log('âœ… AIMESå¡ç‰‡å·²æ‰¾åˆ°ï¼');
  const rect = aimesCard.getBoundingClientRect();
  console.log('ä½ç½®:', rect);
  console.log('æ ·å¼:', {
    display: window.getComputedStyle(aimesCard).display,
    visibility: window.getComputedStyle(aimesCard).visibility,
    opacity: window.getComputedStyle(aimesCard).opacity
  });
  // é«˜äº®æ˜¾ç¤º
  aimesCard.style.outline = '3px solid red';
  aimesCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
  console.log('ğŸ¯ å·²æ»šåŠ¨åˆ°AIMESå¡ç‰‡å¹¶ç”¨çº¢æ¡†é«˜äº®');
} else {
  console.log('âŒ AIMESå¡ç‰‡æœªæ‰¾åˆ°ï¼');
}

console.log('');
console.log('%cè¯Šæ–­å®Œæˆï¼', 'font-size:16px;color:#409EFF;font-weight:bold');
`;

  const blob = new Blob([diagnosticCode], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'aimes-diagnostic.js';
  a.click();
  
  alert('è¯Šæ–­ä»£ç å·²ä¸‹è½½ï¼\n\nè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š\n1. æ‰“å¼€ http://localhost:5173/#/aicrm?tab=aiAgent\n2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·\n3. åˆ‡æ¢åˆ°"æ§åˆ¶å°"é€‰é¡¹å¡\n4. å°†ä¸‹è½½çš„ä»£ç å¤åˆ¶ç²˜è´´åˆ°æ§åˆ¶å°å¹¶å›è½¦');
  
  openAICRM();
}

function showResult(message) {
  const resultDiv = document.getElementById('diagnosticResult');
  resultDiv.style.display = 'block';
  resultDiv.innerHTML = '<pre>' + message + '</pre>';
}
</script>

</body>
</html>
