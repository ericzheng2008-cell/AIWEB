<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ£€æŸ¥åˆ†ç±»æ•°æ®</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 { color: #333; }
    h2 { 
      color: #666; 
      margin-top: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid #1890ff;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin: 20px 0;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-number {
      font-size: 48px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    .tree-view {
      margin: 20px 0;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    button {
      background: #1890ff;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background: #40a9ff;
    }
    .warning {
      background: #fff7e6;
      border: 1px solid #ffd666;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
      color: #d48806;
    }
    .success {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
      color: #52c41a;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” äº§å“åˆ†ç±»æ•°æ®æ£€æŸ¥</h1>
    
    <div class="stats">
      <div class="stat-card">
        <div class="stat-label">1çº§åˆ†ç±»</div>
        <div class="stat-number" id="count1">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">2çº§åˆ†ç±»</div>
        <div class="stat-number" id="count2">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">3çº§åˆ†ç±»</div>
        <div class="stat-number" id="count3">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">4çº§åˆ†ç±»</div>
        <div class="stat-number" id="count4">0</div>
      </div>
    </div>

    <div id="status"></div>

    <div style="margin: 20px 0;">
      <button onclick="checkData()">åˆ·æ–°æ•°æ®</button>
      <button onclick="showTree()">æ˜¾ç¤ºåˆ†ç±»æ ‘</button>
      <button onclick="window.open('init-demo-data.html', '_blank')">åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®</button>
    </div>

    <div id="result"></div>
  </div>

  <script>
    function checkData() {
      const cat1 = JSON.parse(localStorage.getItem('productCategories') || '[]');
      const cat2 = JSON.parse(localStorage.getItem('productSubCategories') || '[]');
      const cat3 = JSON.parse(localStorage.getItem('productThirdCategories') || '[]');
      const cat4 = JSON.parse(localStorage.getItem('productFourthCategories') || '[]');

      document.getElementById('count1').textContent = cat1.length;
      document.getElementById('count2').textContent = cat2.length;
      document.getElementById('count3').textContent = cat3.length;
      document.getElementById('count4').textContent = cat4.length;

      const statusDiv = document.getElementById('status');
      
      if (cat1.length === 0) {
        statusDiv.innerHTML = `
          <div class="warning">
            âš ï¸ <strong>æœªæ£€æµ‹åˆ°åˆ†ç±»æ•°æ®ï¼</strong><br>
            è¯·ç‚¹å‡»"åˆå§‹åŒ–æ¼”ç¤ºæ•°æ®"æŒ‰é’®åˆ›å»ºæµ‹è¯•æ•°æ®ã€‚
          </div>
        `;
      } else if (cat4.length === 0) {
        statusDiv.innerHTML = `
          <div class="warning">
            âš ï¸ <strong>æœªæ£€æµ‹åˆ°4çº§åˆ†ç±»æ•°æ®ï¼</strong><br>
            ç³»ç»Ÿæ”¯æŒ4çº§åˆ†ç±»ï¼Œä½†å½“å‰åªæœ‰${cat3.length > 0 ? '3çº§' : cat2.length > 0 ? '2çº§' : '1çº§'}æ•°æ®ã€‚<br>
            è¯·åœ¨CMSç®¡ç†åå°æ·»åŠ 4çº§åˆ†ç±»ï¼Œæˆ–ä½¿ç”¨æ¼”ç¤ºæ•°æ®ã€‚
          </div>
        `;
      } else {
        statusDiv.innerHTML = `
          <div class="success">
            âœ… <strong>æ£€æµ‹åˆ°å®Œæ•´çš„4çº§åˆ†ç±»æ•°æ®ï¼</strong><br>
            - 1çº§åˆ†ç±»ï¼š${cat1.length}ä¸ª<br>
            - 2çº§åˆ†ç±»ï¼š${cat2.length}ä¸ª<br>
            - 3çº§åˆ†ç±»ï¼š${cat3.length}ä¸ª<br>
            - 4çº§åˆ†ç±»ï¼ˆäº§å“ç³»åˆ—ï¼‰ï¼š${cat4.length}ä¸ª<br>
            <br>
            æ‚¨å¯ä»¥åœ¨å‰å°æŸ¥çœ‹å®Œæ•´çš„4çº§åˆ†ç±»å±•ç¤ºæ•ˆæœã€‚
          </div>
        `;
      }
    }

    function showTree() {
      const cat1 = JSON.parse(localStorage.getItem('productCategories') || '[]');
      const cat2 = JSON.parse(localStorage.getItem('productSubCategories') || '[]');
      const cat3 = JSON.parse(localStorage.getItem('productThirdCategories') || '[]');
      const cat4 = JSON.parse(localStorage.getItem('productFourthCategories') || '[]');
      const products = JSON.parse(localStorage.getItem('productsAdvanced') || '[]');

      let tree = '';

      cat1.forEach(c1 => {
        tree += `ğŸ“ ${c1.name['zh-CN']} (ID: ${c1.id})\n`;
        
        const subs = cat2.filter(c2 => c2.parentId === c1.id);
        subs.forEach(c2 => {
          tree += `  â”œâ”€ ğŸ“‚ ${c2.name['zh-CN']} (ID: ${c2.id})\n`;
          
          const thirds = cat3.filter(c3 => c3.parentId === c2.id);
          thirds.forEach(c3 => {
            tree += `  â”‚   â”œâ”€ ğŸ“„ ${c3.name['zh-CN']} (ID: ${c3.id})\n`;
            
            const fourths = cat4.filter(c4 => c4.parentId === c3.id);
            fourths.forEach(c4 => {
              tree += `  â”‚   â”‚   â”œâ”€ ğŸ·ï¸ ${c4.name['zh-CN']} (ID: ${c4.id}) [4çº§ç³»åˆ—]\n`;
              
              const prods = products.filter(p => p.fourthCategoryId === c4.id);
              prods.forEach(p => {
                tree += `  â”‚   â”‚   â”‚   â””â”€ ğŸ“¦ ${p.name['zh-CN']}\n`;
              });
            });
          });
        });
      });

      if (tree === '') {
        tree = 'æš‚æ— åˆ†ç±»æ•°æ®';
      }

      document.getElementById('result').innerHTML = `
        <h2>åˆ†ç±»æ ‘ç»“æ„</h2>
        <div class="tree-view">${tree}</div>
      `;
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    window.onload = function() {
      checkData();
    };
  </script>
</body>
</html>
