<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ğŸ” å·¥ä½œæµèŠ‚ç‚¹æŠ–åŠ¨è¯Šæ–­å·¥å…·</title>
  <style>
    body {
      font-family: 'Consolas', monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 { color: #4fc3f7; }
    h2 { color: #81c784; margin-top: 30px; }
    .step {
      background: #2d2d30;
      padding: 15px;
      margin: 10px 0;
      border-left: 4px solid #4fc3f7;
      border-radius: 4px;
    }
    .code {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 4px;
      font-family: 'Consolas', monospace;
      overflow-x: auto;
      color: #ce9178;
    }
    .warn { color: #ffa500; }
    .error { color: #f48771; }
    .success { color: #4ec9b0; }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #1177bb; }
  </style>
</head>
<body>
  <h1>ğŸ” å·¥ä½œæµèŠ‚ç‚¹æŠ–åŠ¨è¯Šæ–­å·¥å…·</h1>
  <p>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè¯Šæ–­ï¼ˆ<span class="warn">é¢„è®¡è€—æ—¶5-10åˆ†é’Ÿ</span>ï¼‰</p>

  <h2>ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€æµè§ˆå™¨ DevTools Performance</h2>
  <div class="step">
    <strong>æ“ä½œæ­¥éª¤ï¼š</strong>
    <ol>
      <li>æŒ‰ <code>F12</code> æ‰“å¼€å¼€å‘è€…å·¥å…·</li>
      <li>åˆ‡æ¢åˆ° <span class="success">Performance</span> æ ‡ç­¾</li>
      <li>ç‚¹å‡» <span class="success">å½•åˆ¶æŒ‰é’®âºï¸</span></li>
      <li>åœ¨å·¥ä½œæµç”»å¸ƒä¸Š <span class="warn">ç‚¹å‡»ä¸€ä¸ªèŠ‚ç‚¹</span>ï¼ˆè§¦å‘æŠ–åŠ¨ï¼‰</li>
      <li>ç­‰å¾…2-3ç§’åç‚¹å‡» <span class="success">åœæ­¢æŒ‰é’®â¹ï¸</span></li>
    </ol>
    <strong class="warn">âš ï¸ éœ€è¦æ£€æŸ¥çš„æŒ‡æ ‡ï¼š</strong>
    <ul>
      <li class="error">âŒ Layout Thrashingï¼ˆå¸ƒå±€æŠ–åŠ¨ï¼‰</li>
      <li class="error">âŒ Forced Reflowï¼ˆå¼ºåˆ¶é‡æ’ï¼‰</li>
      <li class="error">âŒ Recalculate Styleï¼ˆæ ·å¼é‡ç®—ï¼‰</li>
      <li class="error">âŒ ResizeObserver loopï¼ˆå°ºå¯¸ç›‘å¬å¾ªç¯ï¼‰</li>
    </ul>
  </div>

  <h2>ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥æ§åˆ¶å°é”™è¯¯</h2>
  <div class="step">
    <button onclick="checkConsoleErrors()">ğŸ” ä¸€é”®æ£€æµ‹æ§åˆ¶å°é”™è¯¯</button>
    <div id="consoleResult" style="margin-top:10px;"></div>
    <strong class="warn">å¸¸è§é”™è¯¯æ¨¡å¼ï¼š</strong>
    <div class="code">
ResizeObserver loop limit exceeded
Maximum update depth exceeded (Vueè­¦å‘Š)
Uncaught TypeError: Cannot read property 'position' of undefined
    </div>
  </div>

  <h2>ç¬¬ä¸‰æ­¥ï¼šä¸´æ—¶ç¦ç”¨å³ä¾§ç¼–è¾‘é¢æ¿</h2>
  <div class="step">
    <strong>ç›®çš„ï¼š</strong>éªŒè¯æ˜¯å¦æ˜¯ç¼–è¾‘å™¨å±•å¼€/æ”¶ç¼©å¯¼è‡´çš„å¸ƒå±€å†²çª<br>
    <strong>æ“ä½œï¼š</strong>
    <ol>
      <li>åœ¨ DevTools â†’ Elements ä¸­æ‰¾åˆ° <code>.n8n-panel</code></li>
      <li>å³é”® â†’ Edit as HTML</li>
      <li>åœ¨æœ€å¤–å±‚æ·»åŠ  <code>style="display:none"</code></li>
      <li>ç‚¹å‡»èŠ‚ç‚¹ï¼Œè§‚å¯Ÿæ˜¯å¦è¿˜æŠ–åŠ¨</li>
    </ol>
    <button onclick="togglePanel()">ğŸ”§ ä¸´æ—¶éšè—å³ä¾§é¢æ¿</button>
    <p class="success" id="panelResult"></p>
  </div>

  <h2>ç¬¬å››æ­¥ï¼šæš‚æ—¶å…³é—­ç”»å¸ƒè‡ªåŠ¨å¸ƒå±€</h2>
  <div class="step">
    <strong>åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</strong>
    <div class="code">
// ç¦ç”¨æ‰€æœ‰è‡ªåŠ¨å¸ƒå±€ç›¸å…³åŠŸèƒ½
window.__disableAutoLayout = true;

// ç›‘å¬èŠ‚ç‚¹é€‰ä¸­äº‹ä»¶
document.addEventListener('click', (e) => {
  const node = e.target.closest('.canvas-node');
  if (node) {
    console.log('èŠ‚ç‚¹ç‚¹å‡»', {
      position: node.style.left + ', ' + node.style.top,
      transform: window.getComputedStyle(node).transform,
      offsetParent: node.offsetParent.className
    });
  }
});
    </div>
    <button onclick="copyCode()">ğŸ“‹ å¤åˆ¶ä»£ç åˆ°æ§åˆ¶å°</button>
  </div>

  <h2>ç¬¬äº”æ­¥ï¼šæ£€æŸ¥èŠ‚ç‚¹æ‹–æ‹½äº‹ä»¶å¾ªç¯</h2>
  <div class="step">
    <strong>æ‰§è¡Œè¯Šæ–­è„šæœ¬ï¼š</strong>
    <div class="code">
// æ£€æµ‹æ‹–æ‹½äº‹ä»¶å¾ªç¯
let dragCount = 0;
let lastPos = null;

document.addEventListener('mousemove', (e) => {
  if (e.buttons === 1) { // å·¦é”®æ‹–æ‹½
    dragCount++;
    const currentPos = { x: e.clientX, y: e.clientY };
    
    if (lastPos) {
      const delta = Math.sqrt(
        Math.pow(currentPos.x - lastPos.x, 2) + 
        Math.pow(currentPos.y - lastPos.y, 2)
      );
      
      if (delta > 50) {
        console.warn('âš ï¸ æ£€æµ‹åˆ°å¤§å¹…è·³è·ƒ:', delta + 'px');
      }
    }
    
    lastPos = currentPos;
    
    if (dragCount % 100 === 0) {
      console.log('æ‹–æ‹½äº‹ä»¶è®¡æ•°:', dragCount);
    }
  }
});
    </div>
    <button onclick="copyDragCode()">ğŸ“‹ å¤åˆ¶æ‹–æ‹½è¯Šæ–­ä»£ç </button>
  </div>

  <h2>è¯Šæ–­æŠ¥å‘Š</h2>
  <div class="step">
    <h3>æ ¹æ®æ‚¨çš„æ£€æŸ¥ç»“æœï¼Œé€‰æ‹©å¯¹åº”çš„ä¿®å¤æ–¹æ¡ˆï¼š</h3>
    <table border="1" cellpadding="10" style="width:100%; border-collapse:collapse; color:#d4d4d4;">
      <tr style="background:#2d2d30;">
        <th>ç—‡çŠ¶</th>
        <th>æ ¹æœ¬åŸå› </th>
        <th>ä¿®å¤æ–¹æ¡ˆ</th>
      </tr>
      <tr>
        <td class="error">âŒ Performanceå½•åˆ¶ä¸­å‡ºç°å¤§é‡ Layout</td>
        <td>å¸ƒå±€å¾ªç¯ï¼ˆ.n8n-panelå±•å¼€æ”¶ç¼©è§¦å‘ï¼‰</td>
        <td class="success">âœ… å›ºå®šå³ä¾§é¢æ¿å®½åº¦ï¼ˆä¸ä½¿ç”¨flexè‡ªé€‚åº”ï¼‰</td>
      </tr>
      <tr>
        <td class="error">âŒ æ§åˆ¶å°æ˜¾ç¤º ResizeObserver loop</td>
        <td>ResizeObserverç›‘å¬å¾ªç¯</td>
        <td class="success">âœ… ä½¿ç”¨throttleåŒ…è£¹resizeäº‹ä»¶</td>
      </tr>
      <tr>
        <td class="error">âŒ èŠ‚ç‚¹ä½ç½®åå¤è·³åŠ¨ï¼ˆé¼ æ ‡ç§»åŠ¨æ—¶ï¼‰</td>
        <td>positionåæ ‡è¢«é‡å¤å†™å…¥</td>
        <td class="success">âœ… æ‹–æ‹½æ—¶ä½¿ç”¨debounceæ›´æ–°çŠ¶æ€</td>
      </tr>
      <tr>
        <td class="error">âŒ éšè—å³ä¾§é¢æ¿åä¸æŠ–åŠ¨</td>
        <td>ç”»å¸ƒåŒºåŸŸå®½åº¦å˜åŒ–è§¦å‘é‡æ–°æ¸²æŸ“</td>
        <td class="success">âœ… ä½¿ç”¨å›ºå®šå®½åº¦å¸ƒå±€ï¼ˆflex: 1; min-width: 0ï¼‰</td>
      </tr>
      <tr>
        <td class="error">âŒ é€‰ä¸­èŠ‚ç‚¹åç«‹å³é—ªåŠ¨</td>
        <td>onSelectè§¦å‘äº†fitView/autoLayout</td>
        <td class="success">âœ… ç§»é™¤selectNodeä¸­çš„è‡ªåŠ¨é€‚é…é€»è¾‘</td>
      </tr>
    </table>
  </div>

  <h2>ç«‹å³åº”ç”¨ä¿®å¤</h2>
  <div class="step">
    <p>æ ¹æ®è¯Šæ–­ç»“æœï¼Œæˆ‘å°†åœ¨ä»£ç ä¸­åº”ç”¨ä»¥ä¸‹ä¿®å¤ï¼š</p>
    <ul class="success">
      <li>âœ… ç¦ç”¨èŠ‚ç‚¹é€‰ä¸­åçš„è‡ªåŠ¨fitView</li>
      <li>âœ… å›ºå®šå³ä¾§é¢æ¿å®½åº¦ä¸º400px</li>
      <li>âœ… ç”»å¸ƒåŒºåŸŸä½¿ç”¨ flex: 1; min-width: 0</li>
      <li>âœ… æ‹–æ‹½ä½ç½®æ›´æ–°ä½¿ç”¨requestAnimationFrameèŠ‚æµ</li>
      <li>âœ… ç§»é™¤æ‰€æœ‰transformç›¸å…³å±æ€§</li>
    </ul>
    <button onclick="applyFix()">ğŸš€ åº”ç”¨ä¼ä¸šçº§ä¿®å¤æ–¹æ¡ˆ</button>
  </div>

  <script>
    function checkConsoleErrors() {
      const result = document.getElementById('consoleResult');
      result.innerHTML = '<p class="warn">â³ è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹é”™è¯¯ä¿¡æ¯...</p><p>å¦‚æœçœ‹åˆ°ä»¥ä¸‹ä»»ä¸€é”™è¯¯ï¼Œè¯·å¤åˆ¶ç²˜è´´åˆ°æˆ‘è¿™é‡Œï¼š</p><ul><li>ResizeObserver loop limit exceeded</li><li>Maximum update depth exceeded</li><li>Cannot read property position</li></ul>';
    }

    function togglePanel() {
      const panel = document.querySelector('.n8n-panel');
      if (panel) {
        panel.style.display = panel.style.display === 'none' ? '' : 'none';
        document.getElementById('panelResult').textContent = 
          panel.style.display === 'none' ? 'âœ… é¢æ¿å·²éšè—ï¼Œè¯·ç‚¹å‡»èŠ‚ç‚¹æµ‹è¯•' : 'âœ… é¢æ¿å·²æ¢å¤';
      } else {
        document.getElementById('panelResult').textContent = 'âŒ æœªæ‰¾åˆ°é¢æ¿å…ƒç´ ï¼Œè¯·åˆ·æ–°é¡µé¢';
      }
    }

    function copyCode() {
      const code = `window.__disableAutoLayout = true;
document.addEventListener('click', (e) => {
  const node = e.target.closest('.canvas-node');
  if (node) {
    console.log('èŠ‚ç‚¹ç‚¹å‡»', {
      position: node.style.left + ', ' + node.style.top,
      transform: window.getComputedStyle(node).transform
    });
  }
});`;
      navigator.clipboard.writeText(code);
      alert('âœ… ä»£ç å·²å¤åˆ¶ï¼è¯·ç²˜è´´åˆ°æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ');
    }

    function copyDragCode() {
      const code = `let dragCount = 0, lastPos = null;
document.addEventListener('mousemove', (e) => {
  if (e.buttons === 1) {
    dragCount++;
    const currentPos = { x: e.clientX, y: e.clientY };
    if (lastPos) {
      const delta = Math.sqrt(Math.pow(currentPos.x - lastPos.x, 2) + Math.pow(currentPos.y - lastPos.y, 2));
      if (delta > 50) console.warn('âš ï¸ æ£€æµ‹åˆ°è·³è·ƒ:', delta + 'px');
    }
    lastPos = currentPos;
  }
});`;
      navigator.clipboard.writeText(code);
      alert('âœ… æ‹–æ‹½è¯Šæ–­ä»£ç å·²å¤åˆ¶ï¼');
    }

    function applyFix() {
      alert('ğŸš€ å°†åœ¨ä¸‹ä¸€æ­¥åº”ç”¨ä¼ä¸šçº§ä¿®å¤æ–¹æ¡ˆï¼\n\nåŒ…å«ï¼š\n1. å›ºå®šå¸ƒå±€ï¼ˆç¦ç”¨flexè‡ªé€‚åº”ï¼‰\n2. èŠ‚æµæ‹–æ‹½æ›´æ–°\n3. ç§»é™¤è‡ªåŠ¨fitView\n4. ç¦ç”¨ResizeObserver\n5. ç®€åŒ–äº‹ä»¶ç»‘å®š');
    }
  </script>
</body>
</html>
