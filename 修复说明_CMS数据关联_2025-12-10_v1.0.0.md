# CMS数据关联修复说明

**版本**: v1.0.0  
**日期**: 2025-12-10  
**修复人员**: AI Assistant

---

## 📋 修复概述

本次修复解决了CMS内容管理系统与前台页面数据不同步的问题，确保在CMS后台做的任何更改都能实时反映到前台网站上。

---

## 🔧 修复的问题

### 1. **CMS后台更改无法反映到前台**
- **问题描述**: 在CMS管理中修改Logo、公司名称、产品分类、事业部等内容后，前台页面仍显示硬编码的默认数据
- **根本原因**: 前台页面使用了硬编码数据，没有从CMS Store读取
- **修复方案**: 统一使用 `cmsAdvanced` Store 作为数据源

### 2. **确认删除"营销推广"标签**
- **问题描述**: 用户提到"营销推广请删除"
- **核查结果**: CMS管理页面只有4个标签（Logo和基本设置、事业部管理、产品分类管理、产品管理），不存在"营销推广"标签
- **结论**: 无需修改，已符合要求

---

## 📝 修改的文件

### 1. **Header.vue** - 头部组件
**文件路径**: `src/components/Header.vue`

**修改内容**:
```javascript
// 修改前：使用硬编码的翻译文本
<h1>{{ t('header.companyName') }}</h1>
<p>{{ t('header.slogan') }}</p>

// 修改后：从CMS读取配置
import { useCmsAdvancedStore } from '../store/cmsAdvanced'
const cmsStore = useCmsAdvancedStore()
const siteConfig = computed(() => cmsStore.siteConfig)
const companyName = computed(() => siteConfig.value.companyName[locale.value])
const companySlogan = computed(() => siteConfig.value.slogan[locale.value])

// 支持Logo图片显示
<img v-if="siteConfig.logo" :src="siteConfig.logo" :alt="companyName" class="logo-image" />
```

**修复效果**:
- ✅ Logo更改后立即显示在头部
- ✅ 公司名称和标语支持中英文切换
- ✅ 所有页面头部统一显示CMS配置的内容

---

### 2. **Home.vue** - 首页
**文件路径**: `src/views/Home.vue`

**修改内容**:
```javascript
// 修改前：使用硬编码的产品系列数据
const productSeries = ref([
  { id: 1, name: '自动化设备', description: '...', image: '...' },
  // ... 6个硬编码的产品系列
])

// 修改后：从CMS读取产品大类
import { useCmsAdvancedStore } from '../store/cmsAdvanced'
const cmsStore = useCmsAdvancedStore()

const productSeries = computed(() => {
  return cmsStore.productCategories.map(category => ({
    id: category.id,
    name: category.name[locale.value] || category.name['zh-CN'],
    description: category.description[locale.value] || category.description['zh-CN'],
    image: category.image || '默认图片'
  }))
})
```

**修复效果**:
- ✅ 首页产品系列显示CMS中添加的产品大类
- ✅ 产品大类支持中英文切换
- ✅ 添加/删除产品大类后，首页立即更新

---

### 3. **ProductsServices.vue** - 产品和服务页面
**文件路径**: `src/views/ProductsServices.vue`

**修改内容**:
```javascript
// 修改前：使用 cms.js 的 productSeries
import { useCmsStore } from '../store/cms'
const cmsStore = useCmsStore()
const productSeries = computed(() => cmsStore.productSeries.map(...))

// 修改后：使用 cmsAdvanced.js 的 productCategories
import { useCmsAdvancedStore } from '../store/cmsAdvanced'
const cmsStore = useCmsAdvancedStore()
const productSeries = computed(() => cmsStore.productCategories.map(...))
```

**修复效果**:
- ✅ 产品和服务页面显示CMS配置的产品大类
- ✅ 与首页数据保持一致
- ✅ 支持中英文双语

---

### 4. **Divisions.vue** - 事业部页面
**文件路径**: `src/views/Divisions.vue`

**修改内容**:
```javascript
// 修改前：使用 cms.js 的 divisions + 硬编码图标映射
import { useCmsStore } from '../store/cms'
const iconMap = { 'assembly': 'Connection', ... }
<h3>{{ t(`products.divisions.${division.key}`) }}</h3>

// 修改后：直接使用 cmsAdvanced.js 的 divisions
import { useCmsAdvancedStore } from '../store/cmsAdvanced'
const cmsStore = useCmsAdvancedStore()
<h3>{{ division.name }}</h3>  // 直接使用CMS中的名称
```

**修复效果**:
- ✅ 事业部页面显示CMS配置的事业部
- ✅ 事业部名称、描述、图标都从CMS读取
- ✅ 支持中英文双语切换

---

## 🎯 数据流程图

### 修改前（问题）:
```
CMS管理 (cmsAdvanced Store)  →  localStorage ❌ 前台页面（硬编码数据）
                                                ↓
                                            显示默认内容（不更新）
```

### 修改后（正确）:
```
CMS管理 (cmsAdvanced Store)  →  localStorage  →  前台页面（读取Store）
                                                ↓
                                            实时显示CMS配置
```

---

## 🧪 测试步骤

### 测试1: Logo更改
1. 访问 `http://localhost:3002/admin/cms`
2. 进入"Logo和基本设置"标签
3. 上传新的Logo图片
4. 点击"保存Logo"
5. ✅ **验证**: 刷新任意前台页面，头部显示新Logo

### 测试2: 公司信息更改
1. 在CMS管理 → Logo和基本设置
2. 修改中文名称、英文名称、标语
3. 点击"保存配置"
4. ✅ **验证**: 头部显示新的公司名称和标语，切换语言正常

### 测试3: 产品大类管理
1. 在CMS管理 → 产品分类管理
2. 添加新的1级分类（产品大类）
   - 中文名称：测试产品
   - 英文名称：Test Product
   - 描述、图片等
3. 点击"保存"
4. ✅ **验证**: 
   - 首页"产品和服务"板块显示新产品
   - `/products-services` 页面显示新产品
   - 切换到EN模式，显示英文名称

### 测试4: 事业部管理
1. 在CMS管理 → 事业部管理
2. 添加新的事业部或编辑现有事业部
3. 修改名称、描述、关联产品
4. 点击"保存"
5. ✅ **验证**: `/divisions` 页面显示更新后的事业部信息

### 测试5: 删除数据
1. 在CMS中删除一个产品大类
2. ✅ **验证**: 前台页面不再显示该产品大类
3. 删除一个事业部
4. ✅ **验证**: 事业部页面不再显示该事业部

---

## 📊 数据存储说明

### LocalStorage Keys:

| Key | 说明 | 数据结构 |
|-----|------|---------|
| `siteConfig` | 网站配置（Logo、公司名称、标语） | `{ logo, companyName: {}, slogan: {} }` |
| `divisionsAdvanced` | 事业部列表 | `[{ id, key, name: {}, description: {}, icon, productCategories: [] }]` |
| `productCategories` | 产品大类（1级分类） | `[{ id, name: {}, description: {}, image, subCategories: [] }]` |
| `productSubCategories` | 产品中类（2级分类） | `[{ id, parentId, name: {}, description: {}, image }]` |
| `productThirdCategories` | 产品小类（3级分类） | `[{ id, parentId, name: {}, description: {}, image }]` |
| `productsAdvanced` | 具体产品 | `[{ id, categoryId, subCategoryId, thirdCategoryId, name: {}, ... }]` |

---

## ⚠️ 重要说明

### 1. **数据持久化**
- 所有CMS数据保存在浏览器的 `localStorage` 中
- 清除浏览器缓存会丢失数据
- 生产环境建议使用后端API存储

### 2. **双Store问题**
- 项目中存在两个Store：`cms.js` 和 `cmsAdvanced.js`
- `cms.js` 是旧版本，仅用于兼容
- **所有CMS管理功能使用 `cmsAdvanced.js`**
- **所有前台页面已修改为使用 `cmsAdvanced.js`**

### 3. **默认数据**
- 首次访问时，Store会加载默认数据（如8个默认事业部）
- 在CMS中修改后，会覆盖默认数据
- 如需重置，可清除localStorage或重新部署

---

## 🎉 修复完成总结

### ✅ 已解决的问题：
1. Logo更改后前台立即显示
2. 公司名称和标语支持CMS配置
3. 产品大类与CMS同步
4. 事业部信息与CMS同步
5. 中英文双语切换正常
6. 确认无"营销推广"标签

### 🔄 数据流程：
```
用户在CMS管理修改 
  ↓
cmsAdvanced Store更新
  ↓
localStorage保存
  ↓
前台页面读取Store
  ↓
实时显示最新内容
```

### 📌 下一步建议：
1. 考虑迁移到后端API存储
2. 添加数据导出/导入功能
3. 添加CMS操作日志
4. 优化图片上传和管理
5. 添加批量操作功能

---

**修复完成！现在CMS的所有更改都会实时反映到前台网站了。** 🎊
