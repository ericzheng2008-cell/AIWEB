# 🌐 企业内测随时随地访问方案

**版本**: v1.0  
**日期**: 2025-12-21  
**适用场景**: 企业多人、跨地域、长期稳定内测

---

## 🎯 方案目标

让企业内测人员能够：
- ✅ **任意地点访问**：公司、家中、出差途中
- ✅ **任意设备访问**：电脑、手机、平板
- ✅ **任意网络访问**：WiFi、4G/5G、移动数据
- ✅ **长期稳定运行**：7×24小时不间断
- ✅ **无需手动启动**：服务自动运行

---

## 📊 四种方案对比

| 方案 | 部署时间 | 成本/年 | 访问限制 | 稳定性 | 推荐度 |
|-----|---------|--------|---------|--------|--------|
| **方案1：内网穿透** | 30分钟 | ¥0-300 | 无 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| **方案2：云服务器** | 4小时 | ¥1,200-3,000 | 无 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **方案3：企业自有服务器** | 1-2天 | ¥13,500首年 | 无 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **方案4：办公电脑托管** | 1小时 | ¥500 | 仅工作时间 | ⭐⭐ | ⭐⭐⭐ |

### 💡 方案选择建议

**预算有限、快速启动**：选择 **方案1：内网穿透**  
**长期稳定、预算充足**：选择 **方案2：云服务器**  
**数据安全、企业级**：选择 **方案3：企业服务器**  
**临时测试、小团队**：选择 **方案4：办公电脑**

---

## 🚀 方案1：内网穿透（推荐快速启动）

### 方案优势
- ✅ **零成本**：免费版够用
- ✅ **快速部署**：30分钟搞定
- ✅ **随时访问**：随时随地访问
- ✅ **无需公网IP**：解决家庭/公司网络限制

### 推荐工具对比

| 工具 | 免费版流量 | 速度 | 稳定性 | 推荐度 |
|-----|-----------|------|--------|--------|
| **花生壳** | 1GB/月 | 中等 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| **ngrok** | 无限 | 快 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **cpolar** | 无限 | 快 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| **frp** | 无限(自建) | 最快 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |

### 🎯 推荐使用：cpolar（国内速度最快）

#### 第一步：注册cpolar账号

```bash
# 访问官网
https://www.cpolar.com

# 注册免费账号
# 免费版特性：
# - 无限流量
# - HTTP/HTTPS/TCP隧道
# - 随机域名（每次启动变化）
# - 1个在线隧道

# VIP版（推荐内测使用）：¥10/月
# - 固定域名
# - 3个在线隧道
# - 自定义子域名
```

#### 第二步：安装cpolar客户端

**Windows系统**：
```batch
:: 1. 下载安装包
:: 访问：https://www.cpolar.com/download
:: 选择：Windows 64位版本

:: 2. 安装（双击exe文件）
:: 安装路径：C:\Program Files\cpolar

:: 3. 认证Token
:: 登录网站：https://dashboard.cpolar.com/auth
:: 复制Authtoken

:: 4. 运行认证
cd "C:\Program Files\cpolar"
cpolar authtoken [你的token]

:: 5. 测试连接
cpolar http 3002
```

**命令行输出示例**：
```
Session Status                online
Account                       your-email@example.com
Version                       3.3.0
Region                        China VIP
Forwarding                    http://abc123.cpolar.cn -> http://localhost:3002
Forwarding                    https://abc123.cpolar.cn -> http://localhost:3002

Connections                   ttl     opn     rt1     rt5     p50     p90
                              0       0       0.00    0.00    0.00    0.00
```

#### 第三步：创建配置文件

```yaml
# 文件路径：C:\Users\EricZ\.cpolar\cpolar.yml

version: "2"
authtoken: your_token_here

tunnels:
  aiweb:
    proto: http
    addr: 3002
    region: cn_vip
    subdomain: aiweb-test  # VIP版可用，免费版会随机
    inspect: true
    bind_tls: true
```

#### 第四步：配置Windows服务（开机自启）

**方法一：使用任务计划程序**
```batch
:: 1. 创建启动脚本
:: 文件：C:\AIWEB\start-cpolar.bat

@echo off
echo 启动AIWEB服务...

:: 启动后端
cd C:\Users\EricZ\CodeBuddy\AIWEB1\server
start /min cmd /c "node index.js"

:: 等待后端启动
timeout /t 5 /nobreak >nul

:: 启动前端
cd C:\Users\EricZ\CodeBuddy\AIWEB1
start /min cmd /c "npm run dev"

:: 等待前端启动
timeout /t 10 /nobreak >nul

:: 启动cpolar
cd "C:\Program Files\cpolar"
cpolar start aiweb

:: 2. 添加到任务计划程序
:: Win+R 输入 taskschd.msc
:: 创建任务 → 触发器：启动时 → 操作：运行上述bat文件
```

**方法二：使用NSSM（推荐）**
```batch
:: 1. 下载NSSM
:: 访问：https://nssm.cc/download
:: 解压到：C:\AIWEB\nssm

:: 2. 安装服务
cd C:\AIWEB\nssm\win64
nssm install cpolar "C:\Program Files\cpolar\cpolar.exe" "start aiweb"

:: 3. 配置服务
nssm set cpolar AppDirectory "C:\Program Files\cpolar"
nssm set cpolar DisplayName "AIWEB Cpolar Tunnel"
nssm set cpolar Description "AIWEB内网穿透服务"
nssm set cpolar Start SERVICE_AUTO_START

:: 4. 启动服务
nssm start cpolar

:: 5. 验证服务
sc query cpolar
```

#### 第五步：获取访问地址

**免费版（每次启动变化）**：
```bash
# 1. 启动cpolar后查看控制台输出
cpolar start aiweb

# 输出示例
Forwarding  https://abc123.cpolar.cn -> http://localhost:3002

# 2. 或访问Web UI
http://localhost:9200
# 查看隧道状态和分配的域名
```

**VIP版（固定域名）**：
```bash
# 访问地址：https://aiweb-test.cpolar.cn
# 域名固定不变，分享给团队成员
```

#### 第六步：分享给测试人员

**创建访问指南**：
```markdown
# AIWEB内测访问指南

## 访问地址
**电脑端/手机端通用**：https://aiweb-test.cpolar.cn

## 登录信息
- 测试账号：test001
- 初始密码：Test@123

## 使用说明
1. 打开浏览器（Chrome/Safari/Edge）
2. 输入上述地址
3. 首次访问可能需要等待10-20秒加载
4. 建议添加书签或主屏幕快捷方式

## 注意事项
- ⚠️ 仅限内部测试，不要外传
- ⚠️ 如无法访问，请联系IT支持
- ⚠️ 建议使用WiFi访问，节省流量

## 手机添加到桌面
### iOS
1. Safari打开网址
2. 点击分享按钮
3. 选择"添加到主屏幕"

### Android
1. Chrome打开网址
2. 点击菜单
3. 选择"添加到主屏幕"
```

### 成本估算（方案1）

| 项目 | 免费版 | VIP版 |
|-----|-------|------|
| **cpolar服务** | ¥0 | ¥120/年 |
| **电费（24小时开机）** | ¥500/年 | ¥500/年 |
| **人力部署** | ¥0 | ¥0 |
| **年度总成本** | **¥500** | **¥620** |

---

## ☁️ 方案2：云服务器部署（推荐长期使用）

### 方案优势
- ✅ **高稳定性**：99.95%可用性保证
- ✅ **高性能**：独享资源，速度快
- ✅ **易扩展**：随时升级配置
- ✅ **专业运维**：云厂商提供监控、备份

### 推荐云服务商

| 厂商 | 2核4GB价格 | 新人优惠 | 推荐度 |
|-----|-----------|---------|--------|
| **阿里云** | ¥1,668/年 | 首购5折 | ⭐⭐⭐⭐⭐ |
| **腾讯云** | ¥1,200/年 | 首购6折 | ⭐⭐⭐⭐⭐ |
| **华为云** | ¥1,500/年 | 首购5折 | ⭐⭐⭐⭐ |

### 快速部署步骤（腾讯云示例）

#### 第一步：购买服务器

```bash
# 1. 访问腾讯云官网
https://cloud.tencent.com/product/cvm

# 2. 选择配置
地域：广州/上海（根据用户分布）
机型：标准型S5 2核4GB
镜像：Ubuntu Server 22.04 LTS
系统盘：50GB高性能云硬盘
公网带宽：5Mbps（按流量计费）
购买时长：1年

# 3. 安全组配置
协议端口：TCP:22,80,443,3002,5000
来源：0.0.0.0/0

# 4. 支付（首购优惠约¥600-800/年）
```

#### 第二步：连接服务器

```bash
# 使用SSH连接
ssh ubuntu@your-server-ip

# 首次登录需要设置密码
# 或使用密钥对（更安全）
```

#### 第三步：一键部署脚本

```bash
#!/bin/bash
# AIWEB一键部署脚本 for Ubuntu 22.04

echo "=========================================="
echo "AIWEB 企业级自动部署脚本 v1.0"
echo "=========================================="

# 更新系统
echo "[1/8] 更新系统..."
sudo apt update && sudo apt upgrade -y

# 安装必要工具
echo "[2/8] 安装基础工具..."
sudo apt install -y curl wget git vim build-essential ufw

# 安装Node.js 18
echo "[3/8] 安装Node.js..."
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 安装pnpm
echo "[4/8] 安装pnpm..."
sudo npm install -g pnpm

# 安装Nginx
echo "[5/8] 安装Nginx..."
sudo apt install -y nginx

# 克隆代码
echo "[6/8] 克隆代码..."
cd /var/www
sudo git clone https://github.com/ericzheng2008-cell/AIWEB.git
sudo chown -R ubuntu:ubuntu AIWEB

# 安装依赖并构建
echo "[7/8] 安装依赖..."
cd AIWEB
pnpm install
pnpm run build

# 配置Nginx
echo "[8/8] 配置Nginx..."
sudo tee /etc/nginx/sites-available/aiweb > /dev/null <<EOF
server {
    listen 80;
    server_name _;

    location / {
        root /var/www/AIWEB/dist;
        try_files \$uri \$uri/ /index.html;
        index index.html;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:5000/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade \$http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host \$host;
        proxy_cache_bypass \$http_upgrade;
    }
}
EOF

sudo ln -s /etc/nginx/sites-available/aiweb /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx

# 启动后端（使用PM2）
cd server
npm install -g pm2
pm2 start index.js --name aiweb-backend
pm2 startup
pm2 save

# 配置防火墙
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw --force enable

echo "=========================================="
echo "✅ AIWEB部署完成！"
echo "访问地址：http://$(curl -s ifconfig.me)"
echo "=========================================="
```

**保存并运行**：
```bash
# 保存脚本
nano deploy-aiweb.sh

# 设置执行权限
chmod +x deploy-aiweb.sh

# 运行部署
./deploy-aiweb.sh
```

#### 第四步：配置域名（可选但推荐）

**购买域名**：
```bash
# 阿里云/腾讯云万网
# .com域名：¥60/年
# .cn域名：¥30/年

# 推荐域名：aiweb.yourcompany.com
```

**配置DNS解析**：
```bash
# 登录域名控制台
# 添加A记录
主机记录：aiweb
记录类型：A
记录值：[服务器IP]
TTL：600

# 等待生效（5-10分钟）
ping aiweb.yourcompany.com
```

#### 第五步：配置HTTPS（推荐）

```bash
# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx

# 自动申请SSL证书
sudo certbot --nginx -d aiweb.yourcompany.com

# 按提示操作：
# 1. 输入邮箱
# 2. 同意服务条款
# 3. 选择重定向HTTP到HTTPS

# 证书自动续期
sudo systemctl status certbot.timer
```

#### 第六步：分享访问地址

**分享给测试人员**：
```markdown
# AIWEB企业内测访问

## 正式访问地址
**电脑/手机通用**：https://aiweb.yourcompany.com

## 临时IP访问（无域名时）
http://123.45.67.89

## 测试账号
- 账号：test001
- 密码：Test@123

## 特性
- ✅ 随时随地访问（WiFi/4G/5G）
- ✅ 电脑/手机/平板全平台支持
- ✅ 7×24小时稳定运行
- ✅ HTTPS加密安全访问
```

### 成本估算（方案2）

| 项目 | 费用 |
|-----|------|
| **云服务器（2核4GB）** | ¥1,200/年（首购优惠） |
| **域名** | ¥60/年 |
| **SSL证书** | ¥0（Let's Encrypt免费） |
| **流量费** | ¥0-200/年（按实际使用） |
| **人力部署** | ¥0（使用自动脚本） |
| **年度总成本** | **¥1,260-1,460** |

---

## 🖥️ 方案3：企业自有服务器（适合大型企业）

### 适用场景
- 公司规模 > 50人
- 数据安全要求高
- 已有IT运维团队
- 长期使用（3年+）

### 硬件采购

| 设备 | 型号 | 配置 | 价格 |
|-----|------|------|------|
| **服务器** | Dell PowerEdge T140 | 4核/16GB/1TB | ¥12,000 |
| **UPS电源** | APC BK650 | 650VA | ¥800 |
| **交换机** | TP-LINK千兆24口 | - | ¥500 |
| **总计** | - | - | **¥13,300** |

### 部署流程

**参考方案2的部署步骤**，区别在于：
- 使用企业内网IP
- 配置内网DNS解析
- 通过VPN提供外网访问

**详细步骤**请参考：`🏢_企业内测长期部署方案_2025-12-21.md`

### 成本估算（方案3）

| 项目 | 首年 | 第2年起 |
|-----|------|--------|
| **硬件** | ¥13,500 | ¥0 |
| **电费** | ¥800 | ¥800 |
| **运维人力** | ¥10,000 | ¥12,000 |
| **年度总成本** | **¥24,300** | **¥12,800** |

---

## 💻 方案4：办公电脑托管（临时方案）

### 适用场景
- 团队 < 10人
- 临时测试（1-3个月）
- 仅工作时间访问

### 配置步骤

**结合方案1（内网穿透）+ 自动启动脚本**

详细步骤见：`🏢_企业内测长期部署方案_2025-12-21.md` 模式1

### 成本估算（方案4）

| 项目 | 费用 |
|-----|------|
| **硬件** | ¥0（使用现有电脑） |
| **电费** | ¥500/年 |
| **内网穿透** | ¥120/年（VIP版） |
| **年度总成本** | **¥620** |

---

## 🎯 推荐方案总结

### 📱 快速启动（1小时内上线）

**推荐**：方案1（内网穿透） + cpolar VIP版

**优势**：
- ⚡ 30分钟部署完成
- 💰 年成本仅¥620
- 🌐 随时随地访问
- 📱 手机/电脑全支持

**限制**：
- ⚠️ 需要办公电脑24小时开机
- ⚠️ 网络依赖电脑所在网络

---

### 🏆 长期稳定（企业级）

**推荐**：方案2（云服务器） + 域名 + HTTPS

**优势**：
- ✅ 99.95%高可用
- ✅ 性能稳定，速度快
- ✅ 专业运维，自动备份
- ✅ 可扩展性强

**成本**：
- 💰 年成本约¥1,300
- 💰 新用户首购更优惠

---

## 📋 部署验收清单

### 功能验收
- [ ] 电脑浏览器正常访问
- [ ] 手机浏览器正常访问
- [ ] 平板正常访问
- [ ] 外网环境（4G/5G）正常访问
- [ ] WiFi环境正常访问
- [ ] 登录功能正常
- [ ] 所有智能体功能正常
- [ ] 上传下载功能正常

### 性能验收
- [ ] 首页加载时间 < 5秒
- [ ] API响应时间 < 1秒
- [ ] 支持10人同时在线
- [ ] 连续运行7天无故障

### 安全验收
- [ ] HTTPS加密（方案2）
- [ ] 密码强度符合要求
- [ ] 无SQL注入漏洞
- [ ] 数据定期备份

---

## 📞 技术支持

**部署支持**：
- 联系人：IT支持团队
- 邮箱：it@yourcompany.com
- 电话：400-xxx-xxxx

**使用问题**：
- 内部工单系统
- 企业微信/钉钉群

---

## 🚀 快速开始

### 选项1：快速启动（推荐内测初期）

```batch
:: 1. 下载并安装cpolar
:: 2. 运行一键脚本
双击：🚀_一键启动内网穿透.bat

:: 3. 获取访问地址并分享给团队
```

### 选项2：云服务器（推荐正式内测）

```bash
# 1. 购买云服务器
# 2. 运行自动部署脚本
curl -sSL https://aiweb.com/deploy.sh | bash

# 3. 配置域名（可选）
# 4. 分享访问地址
```

---

**文档版本**：v1.0  
**创建日期**：2025-12-21  
**适用场景**：企业长期跨地域内测
