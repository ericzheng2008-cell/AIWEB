# 📘 AIWEB企业内部部署完整方案

**版本：** v2.5.0  
**日期：** 2025-12-20  
**文档类型：** 企业内测部署指南

---

## 📋 目录

1. [项目概述](#项目概述)
2. [部署模式选择](#部署模式选择)
3. [硬件需求](#硬件需求)
4. [软件需求](#软件需求)
5. [人员配置](#人员配置)
6. [预算估算](#预算估算)
7. [部署步骤](#部署步骤)
8. [测试验收](#测试验收)
9. [运维保障](#运维保障)
10. [风险控制](#风险控制)

---

## 1. 项目概述

### 1.1 系统简介
AIWEB是一个集成了AI智能体、产品管理、营销自动化、设备生命周期管理等功能的企业级Web应用平台。

### 1.2 技术架构
- **前端**：Vue 3 + Element Plus + ECharts
- **后端**：Node.js + Express
- **数据库**：SQLite（可升级为MySQL/PostgreSQL）
- **部署**：Docker容器化 / 传统部署

### 1.3 核心模块
- 🤖 安彤智能体系统（8个智能体）
- 💼 明升AICRM客户关系管理
- 🏭 AIMES智能制造执行系统
- 🔧 设备全生命周期管理
- 🎯 AI产品选型系统
- 📊 营销数据分析平台

---

## 2. 部署模式选择

### 2.1 单机部署（推荐用于内测）

**适用场景**：
- 用户数 < 50人
- 并发访问 < 20人
- 内部测试验证

**优点**：
- ✅ 成本低
- ✅ 部署简单
- ✅ 维护方便

**缺点**：
- ❌ 性能有限
- ❌ 无高可用

### 2.2 分布式部署（推荐用于生产）

**适用场景**：
- 用户数 > 100人
- 并发访问 > 50人
- 正式生产环境

**优点**：
- ✅ 性能强劲
- ✅ 高可用性
- ✅ 可扩展

**缺点**：
- ❌ 成本较高
- ❌ 配置复杂

---

## 3. 硬件需求

### 3.1 单机部署配置

#### 🔹 最低配置（测试环境）
| 硬件项目 | 配置要求 | 价格估算 |
|---------|---------|---------|
| **CPU** | 4核 Intel i5 或同级 | ¥1,500 |
| **内存** | 8GB DDR4 | ¥300 |
| **硬盘** | 256GB SSD | ¥400 |
| **网卡** | 千兆网卡 | 标配 |
| **服务器** | Dell/HP入门级 | ¥5,000 |

**总计**：约 **¥7,200**

#### 🔸 推荐配置（小规模生产）
| 硬件项目 | 配置要求 | 价格估算 |
|---------|---------|---------|
| **CPU** | 8核 Intel Xeon E3 | ¥3,500 |
| **内存** | 16GB DDR4 ECC | ¥800 |
| **硬盘** | 512GB SSD + 2TB HDD | ¥1,200 |
| **网卡** | 双千兆网卡 | 标配 |
| **服务器** | Dell PowerEdge T140 | ¥12,000 |

**总计**：约 **¥17,500**

### 3.2 分布式部署配置

#### 🔺 标准配置（100-500用户）
| 服务器角色 | 数量 | 配置 | 单价 | 小计 |
|-----------|-----|------|------|------|
| **前端服务器** | 2 | 8核/16GB/512GB SSD | ¥15,000 | ¥30,000 |
| **后端服务器** | 2 | 16核/32GB/1TB SSD | ¥25,000 | ¥50,000 |
| **数据库服务器** | 1 | 16核/64GB/2TB SSD | ¥35,000 | ¥35,000 |
| **负载均衡器** | 1 | 4核/8GB/256GB SSD | ¥8,000 | ¥8,000 |
| **网络设备** | - | 交换机/防火墙 | - | ¥15,000 |

**总计**：约 **¥138,000**

### 3.3 网络带宽需求

| 用户规模 | 带宽要求 | 费用/年 |
|---------|---------|---------|
| < 50人 | 10Mbps | ¥3,600 |
| 50-200人 | 50Mbps | ¥12,000 |
| 200-500人 | 100Mbps | ¥24,000 |
| > 500人 | 200Mbps+ | ¥48,000+ |

---

## 4. 软件需求

### 4.1 操作系统

#### 推荐选择
- **Linux**：Ubuntu 22.04 LTS / CentOS 8 Stream（免费）
- **Windows**：Windows Server 2022（约¥6,000/许可证）

#### 版本要求
- 64位操作系统
- 支持Docker（可选）

### 4.2 运行环境

| 软件名称 | 版本要求 | 许可证 | 费用 |
|---------|---------|--------|------|
| **Node.js** | 18.x 或更高 | MIT | 免费 |
| **npm/pnpm** | 最新版本 | MIT | 免费 |
| **数据库** | SQLite 3.x | 公有领域 | 免费 |
| **Web服务器** | Nginx 1.24+ | BSD | 免费 |
| **进程管理** | PM2 | MIT | 免费 |

### 4.3 可选组件

| 软件名称 | 用途 | 许可证 | 费用 |
|---------|------|--------|------|
| **Docker** | 容器化部署 | Apache 2.0 | 免费 |
| **MySQL** | 数据库升级 | GPL | 免费 |
| **Redis** | 缓存服务 | BSD | 免费 |
| **Elasticsearch** | 全文搜索 | SSPL/商业 | 免费/收费 |

### 4.4 安全软件

| 软件名称 | 用途 | 费用 |
|---------|------|------|
| **防火墙** | iptables/firewalld | 免费 |
| **SSL证书** | Let's Encrypt | 免费 |
| **杀毒软件** | ClamAV | 免费 |
| **入侵检测** | Fail2ban | 免费 |

---

## 5. 人员配置

### 5.1 部署团队（内测阶段）

#### 🔹 最小团队（3-4人）

| 角色 | 人数 | 职责 | 能力要求 | 工作量 |
|-----|------|------|---------|--------|
| **项目经理** | 1 | 整体协调、进度管理 | 项目管理经验 | 全程 |
| **系统工程师** | 1 | 服务器配置、系统部署 | Linux、网络、安全 | 5-7天 |
| **前端工程师** | 1 | 界面调整、功能测试 | Vue.js、JavaScript | 3-5天 |
| **测试工程师** | 1 | 功能测试、性能测试 | 测试经验 | 5-7天 |

**人员成本**：约 **¥30,000-50,000**（按项目计费）

#### 🔸 标准团队（6-8人）

| 角色 | 人数 | 职责 | 能力要求 | 工作量 |
|-----|------|------|---------|--------|
| **项目经理** | 1 | 项目管理、风险控制 | PMP认证优先 | 全程 |
| **系统架构师** | 1 | 架构设计、技术选型 | 5年以上经验 | 3-5天 |
| **系统工程师** | 2 | 服务器部署、网络配置 | Linux、Docker | 7-10天 |
| **后端工程师** | 1 | API对接、数据库优化 | Node.js、SQL | 5-7天 |
| **前端工程师** | 1 | UI调整、功能定制 | Vue 3、Element Plus | 5-7天 |
| **测试工程师** | 2 | 功能/性能/安全测试 | 自动化测试 | 7-10天 |

**人员成本**：约 **¥80,000-120,000**（按项目计费）

### 5.2 运维团队（长期）

#### 🔹 兼职运维（小规模）

| 角色 | 人数 | 月薪 | 年成本 |
|-----|------|------|--------|
| **运维工程师（兼职）** | 1 | ¥3,000 | ¥36,000 |

#### 🔸 专职运维（标准）

| 角色 | 人数 | 月薪 | 年成本 |
|-----|------|------|--------|
| **运维主管** | 1 | ¥15,000 | ¥180,000 |
| **运维工程师** | 1-2 | ¥10,000 | ¥120,000-240,000 |

**年度人员成本**：¥36,000 - ¥420,000

### 5.3 能力要求矩阵

| 技能领域 | 必备 | 加分 |
|---------|------|------|
| **Linux系统** | ⭐⭐⭐⭐⭐ | CentOS/Ubuntu |
| **网络配置** | ⭐⭐⭐⭐ | TCP/IP、DNS、防火墙 |
| **Web服务器** | ⭐⭐⭐⭐ | Nginx、Apache |
| **数据库** | ⭐⭐⭐ | SQLite、MySQL |
| **容器技术** | ⭐⭐⭐ | Docker、Kubernetes |
| **前端开发** | ⭐⭐⭐ | Vue 3、JavaScript |
| **后端开发** | ⭐⭐⭐ | Node.js、Express |
| **安全防护** | ⭐⭐⭐⭐ | SSL、防火墙、渗透测试 |
| **监控运维** | ⭐⭐⭐ | Prometheus、Grafana |

---

## 6. 预算估算

### 6.1 单机部署总预算

#### 🔹 最低配置（内测）

| 类别 | 项目 | 费用 |
|-----|------|------|
| **硬件** | 服务器 | ¥7,200 |
| **软件** | 操作系统 + 运行环境 | ¥0（开源） |
| **网络** | 10Mbps带宽/年 | ¥3,600 |
| **人员** | 部署团队（最小） | ¥40,000 |
| **其他** | 机柜、UPS、备件 | ¥5,000 |

**首年总计**：约 **¥55,800**

#### 🔸 推荐配置（小规模生产）

| 类别 | 项目 | 费用 |
|-----|------|------|
| **硬件** | 服务器 + 网络设备 | ¥25,000 |
| **软件** | Windows Server（可选） | ¥6,000 |
| **网络** | 50Mbps带宽/年 | ¥12,000 |
| **人员** | 部署团队（标准） | ¥100,000 |
| **运维** | 兼职运维/年 | ¥36,000 |
| **其他** | 备件、培训、文档 | ¥10,000 |

**首年总计**：约 **¥189,000**

### 6.2 分布式部署总预算

#### 🔺 标准配置（100-500用户）

| 类别 | 项目 | 费用 |
|-----|------|------|
| **硬件** | 服务器集群 + 网络 | ¥138,000 |
| **软件** | 企业级组件（可选） | ¥20,000 |
| **网络** | 100Mbps专线/年 | ¥24,000 |
| **人员** | 部署团队（标准） | ¥100,000 |
| **运维** | 专职运维团队/年 | ¥240,000 |
| **安全** | 渗透测试、安全审计 | ¥30,000 |
| **其他** | 培训、文档、备品 | ¥20,000 |

**首年总计**：约 **¥572,000**

### 6.3 年度运维预算（第2年起）

| 规模 | 硬件折旧 | 网络费用 | 人员成本 | 软件更新 | 总计 |
|-----|---------|---------|---------|---------|------|
| **小规模** | ¥5,000 | ¥12,000 | ¥36,000 | ¥5,000 | **¥58,000** |
| **中等规模** | ¥15,000 | ¥24,000 | ¥240,000 | ¥15,000 | **¥294,000** |
| **大规模** | ¥30,000 | ¥48,000 | ¥420,000 | ¥30,000 | **¥528,000** |

---

## 7. 部署步骤

### 7.1 准备阶段（1-2天）

#### ✅ 任务清单
- [ ] 硬件采购到位
- [ ] 网络环境准备
- [ ] 操作系统安装
- [ ] 基础安全配置
- [ ] 域名/IP规划

#### 📝 操作步骤

**1. 安装操作系统**
```bash
# Ubuntu 22.04 LTS（推荐）
# 下载ISO：https://ubuntu.com/download/server
# 最小化安装，只选择OpenSSH Server
```

**2. 配置网络**
```bash
# 编辑网络配置
sudo nano /etc/netplan/01-netcfg.yaml

# 示例配置
network:
  version: 2
  ethernets:
    ens33:
      dhcp4: no
      addresses: [192.168.1.100/24]
      gateway4: 192.168.1.1
      nameservers:
        addresses: [8.8.8.8, 114.114.114.114]

# 应用配置
sudo netplan apply
```

**3. 系统更新**
```bash
sudo apt update
sudo apt upgrade -y
sudo apt install -y build-essential curl wget git vim
```

**4. 防火墙配置**
```bash
# 安装UFW
sudo apt install -y ufw

# 基础规则
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 3000/tcp  # 前端开发服务器
sudo ufw allow 3001/tcp  # 后端API服务器

# 启用防火墙
sudo ufw enable
```

### 7.2 环境安装（1天）

#### 安装Node.js
```bash
# 使用NodeSource仓库
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 验证安装
node --version  # 应显示 v18.x.x
npm --version   # 应显示 9.x.x

# 安装pnpm（推荐）
sudo npm install -g pnpm
```

#### 安装Nginx
```bash
sudo apt install -y nginx

# 启动并设置开机自启
sudo systemctl start nginx
sudo systemctl enable nginx

# 验证
sudo systemctl status nginx
```

#### 安装PM2
```bash
sudo npm install -g pm2

# 设置开机自启
pm2 startup
# 按照提示执行命令
```

#### 安装Git
```bash
sudo apt install -y git
git --version
```

### 7.3 代码部署（0.5天）

#### 方式一：从GitHub克隆（推荐）
```bash
# 创建项目目录
sudo mkdir -p /var/www
cd /var/www

# 克隆代码（替换为您的仓库地址）
sudo git clone https://github.com/your-org/AIWEB1.git
cd AIWEB1

# 安装依赖
sudo pnpm install
```

#### 方式二：上传代码包
```bash
# 在本地打包代码（排除node_modules）
# 在项目目录执行
tar -czf aiweb-v2.5.0.tar.gz --exclude=node_modules .

# 上传到服务器（使用SCP）
scp aiweb-v2.5.0.tar.gz user@192.168.1.100:/tmp/

# 在服务器解压
cd /var/www
sudo mkdir AIWEB1
cd AIWEB1
sudo tar -xzf /tmp/aiweb-v2.5.0.tar.gz

# 安装依赖
sudo pnpm install
```

### 7.4 数据库初始化（0.5天）

```bash
cd /var/www/AIWEB1/server

# 确保数据目录存在
mkdir -p data

# 初始化数据库（自动创建）
# 首次启动后端服务时会自动创建SQLite数据库

# 如果需要导入初始数据
sqlite3 data/aiweb.db < init.sql
```

### 7.5 配置调整（0.5天）

#### 前端配置
```bash
cd /var/www/AIWEB1

# 编辑API地址配置
nano src/api/config.js

# 修改为服务器IP
export const API_BASE_URL = 'http://192.168.1.100:3001'
```

#### 后端配置
```bash
cd /var/www/AIWEB1/server

# 创建环境变量文件
nano .env

# 添加配置
PORT=3001
NODE_ENV=production
DATABASE_PATH=./data/aiweb.db
JWT_SECRET=your-secret-key-change-this
UPLOAD_DIR=./uploads
```

#### Nginx配置
```bash
# 创建站点配置
sudo nano /etc/nginx/sites-available/aiweb

# 添加配置
server {
    listen 80;
    server_name 192.168.1.100;  # 替换为您的域名或IP

    # 前端静态文件
    location / {
        root /var/www/AIWEB1/dist;
        try_files $uri $uri/ /index.html;
        index index.html;
    }

    # API代理
    location /api/ {
        proxy_pass http://localhost:3001/;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        root /var/www/AIWEB1/dist;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}

# 启用站点
sudo ln -s /etc/nginx/sites-available/aiweb /etc/nginx/sites-enabled/

# 测试配置
sudo nginx -t

# 重启Nginx
sudo systemctl reload nginx
```

### 7.6 构建启动（0.5天）

#### 构建前端
```bash
cd /var/www/AIWEB1

# 生产构建
pnpm run build

# 验证dist目录
ls -lh dist/
```

#### 启动后端
```bash
cd /var/www/AIWEB1/server

# 使用PM2启动
pm2 start index.js --name aiweb-api

# 保存PM2配置
pm2 save

# 查看状态
pm2 status
pm2 logs aiweb-api
```

#### 启动前端（开发模式 - 可选）
```bash
cd /var/www/AIWEB1

# 如果需要前端开发服务器
pm2 start "pnpm run dev" --name aiweb-frontend
```

### 7.7 访问测试（0.5天）

```bash
# 1. 测试后端API
curl http://localhost:3001/api/health

# 2. 在浏览器访问
http://192.168.1.100

# 3. 测试登录功能
# 默认管理员账号：admin / admin123
```

---

## 8. 测试验收

### 8.1 功能测试清单

#### 核心功能（必测）
- [ ] 用户登录/注册
- [ ] 首页加载
- [ ] 智能体功能
- [ ] 产品管理
- [ ] AICRM系统
- [ ] 设备管理
- [ ] 数据统计

#### 详细测试用例

**测试1：用户认证**
```
测试步骤：
1. 访问登录页面
2. 输入用户名：admin
3. 输入密码：admin123
4. 点击登录按钮

预期结果：
✅ 成功登录并跳转到首页
✅ 显示用户信息
```

**测试2：智能体功能**
```
测试步骤：
1. 点击"安彤智能体"菜单
2. 选择"拧紧数据采集"
3. 上传测试数据
4. 查看分析结果

预期结果：
✅ 数据上传成功
✅ 显示分析图表
✅ 可导出报告
```

### 8.2 性能测试

#### 响应时间测试
```bash
# 使用Apache Bench测试
ab -n 1000 -c 10 http://192.168.1.100/

# 查看结果
# Time per request: < 500ms (平均)
# Requests per second: > 20 (QPS)
```

#### 并发测试
```bash
# 模拟50个并发用户
ab -n 5000 -c 50 http://192.168.1.100/api/products

# 预期：
# 失败率 < 1%
# 平均响应时间 < 1000ms
```

### 8.3 安全测试

#### 基础安全检查
```bash
# 1. 端口扫描
nmap -sV 192.168.1.100

# 预期：只开放必要端口（80, 443, 22）

# 2. SSL配置检查（如果启用HTTPS）
sslscan 192.168.1.100

# 3. SQL注入测试
# 使用sqlmap等工具测试登录表单

# 4. XSS测试
# 在输入框输入: <script>alert('XSS')</script>
# 预期：应被转义或过滤
```

### 8.4 验收标准

| 测试项 | 标准 | 权重 |
|-------|------|------|
| **功能完整性** | 核心功能100%可用 | 40% |
| **性能** | 首页加载 < 3秒 | 20% |
| **稳定性** | 连续运行24小时无崩溃 | 20% |
| **安全性** | 通过基础安全扫描 | 15% |
| **用户体验** | 操作流畅无明显卡顿 | 5% |

**总分 ≥ 90分** 为验收通过

---

## 9. 运维保障

### 9.1 监控方案

#### 安装监控工具
```bash
# 安装Prometheus + Grafana（可选）
docker run -d -p 9090:9090 prom/prometheus
docker run -d -p 3000:3000 grafana/grafana
```

#### PM2自带监控
```bash
# 查看资源占用
pm2 monit

# 查看日志
pm2 logs

# 重启服务
pm2 restart aiweb-api
```

### 9.2 备份策略

#### 数据库备份
```bash
# 创建备份脚本
sudo nano /usr/local/bin/backup-aiweb.sh

#!/bin/bash
BACKUP_DIR="/backup/aiweb"
DATE=$(date +%Y%m%d_%H%M%S)

# 创建备份目录
mkdir -p $BACKUP_DIR

# 备份数据库
cp /var/www/AIWEB1/server/data/aiweb.db \
   $BACKUP_DIR/aiweb_$DATE.db

# 备份上传文件
tar -czf $BACKUP_DIR/uploads_$DATE.tar.gz \
   /var/www/AIWEB1/server/uploads/

# 删除30天前的备份
find $BACKUP_DIR -name "*.db" -mtime +30 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +30 -delete

# 设置执行权限
sudo chmod +x /usr/local/bin/backup-aiweb.sh

# 添加定时任务（每天凌晨2点）
crontab -e
# 添加: 0 2 * * * /usr/local/bin/backup-aiweb.sh
```

### 9.3 日志管理

```bash
# 配置日志轮转
sudo nano /etc/logrotate.d/aiweb

/var/www/AIWEB1/server/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        pm2 reloadLogs
    endscript
}
```

### 9.4 应急预案

| 故障类型 | 应急措施 | 恢复时间 |
|---------|---------|---------|
| **服务崩溃** | `pm2 restart all` | < 1分钟 |
| **数据库损坏** | 从备份恢复 | < 30分钟 |
| **硬盘故障** | 更换硬盘，恢复备份 | 2-4小时 |
| **网络中断** | 检查网络设备，联系ISP | 1-8小时 |
| **被攻击** | 启用防火墙，封禁IP | < 10分钟 |

---

## 10. 风险控制

### 10.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| **依赖包更新冲突** | 中 | 中 | 锁定版本号 |
| **性能瓶颈** | 低 | 高 | 性能监控，及时优化 |
| **数据丢失** | 低 | 高 | 定期备份，异地存储 |
| **安全漏洞** | 中 | 高 | 定期安全扫描 |

### 10.2 人员风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| **关键人员离职** | 中 | 高 | 文档完善，知识转移 |
| **技能不足** | 中 | 中 | 提前培训，技术支持 |
| **沟通不畅** | 低 | 中 | 定期会议，明确分工 |

### 10.3 进度风险

| 风险 | 概率 | 影响 | 应对措施 |
|-----|------|------|---------|
| **硬件采购延迟** | 中 | 中 | 提前采购，备用方案 |
| **需求变更** | 高 | 中 | 需求冻结，变更管理 |
| **测试不充分** | 中 | 高 | 预留充足测试时间 |

---

## 📋 附录

### A. 常用命令速查

```bash
# 查看系统状态
systemctl status nginx
pm2 status

# 重启服务
pm2 restart aiweb-api
systemctl restart nginx

# 查看日志
pm2 logs aiweb-api --lines 100
tail -f /var/log/nginx/error.log

# 数据库操作
sqlite3 /var/www/AIWEB1/server/data/aiweb.db

# 备份恢复
/usr/local/bin/backup-aiweb.sh
cp /backup/aiweb/aiweb_20251220.db /var/www/AIWEB1/server/data/aiweb.db
```

### B. 故障排查流程

```
1. 检查服务状态
   ├─ pm2 status
   └─ systemctl status nginx

2. 查看错误日志
   ├─ pm2 logs aiweb-api
   └─ tail -f /var/log/nginx/error.log

3. 检查端口占用
   └─ netstat -tulnp | grep :3001

4. 检查磁盘空间
   └─ df -h

5. 检查内存使用
   └─ free -m

6. 重启服务
   ├─ pm2 restart aiweb-api
   └─ systemctl restart nginx
```

### C. 联系支持

- **技术支持邮箱**：support@mingsheng.com
- **紧急联系电话**：400-xxx-xxxx
- **在线文档**：https://docs.mingsheng.com
- **GitHub仓库**：https://github.com/your-org/AIWEB1

---

**文档版本**：v2.5.0  
**最后更新**：2025-12-20  
**下次审查**：2025-03-20
