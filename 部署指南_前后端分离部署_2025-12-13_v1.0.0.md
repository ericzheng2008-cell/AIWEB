# 前后端分离部署指南

## 📋 部署架构

```
前端（静态文件）
    ↓
Vercel (https://aiweb-gilt.vercel.app/)
    ↓
    调用 API
    ↓
后端（Node.js API）
    ↓
Railway (https://xxx.railway.app/)
```

## 🚀 快速部署（推荐）

### 方式一：一键部署（最简单）

直接运行：
```bash
deploy-backend.bat
```

这个脚本会：
1. ✅ 自动安装 Railway CLI
2. ✅ 引导您登录 Railway
3. ✅ 自动部署后端
4. ✅ 生成公网访问域名

### 方式二：分步部署（更可控）

#### 步骤 1：部署后端到 Railway

1. **安装 Railway CLI**
```bash
npm install -g @railway/cli
```

2. **登录 Railway**
```bash
railway login
```
浏览器会自动打开，使用 GitHub 账号登录即可（免费）

3. **进入 server 目录**
```bash
cd server
```

4. **初始化 Railway 项目**
```bash
railway init
```
按提示操作：
- 选择 "Create a new project"
- 输入项目名称（如：marketing-backend）

5. **部署后端**
```bash
railway up
```
等待部署完成（约 1-2 分钟）

6. **生成公网域名**
```bash
railway domain
```
**重要：记录这个域名！** 例如：`https://marketing-backend-production.up.railway.app`

#### 步骤 2：更新前端 API 配置

1. **运行更新脚本**
```bash
update-api-url.bat
```

2. **输入后端域名**
粘贴刚才记录的 Railway 域名（完整地址，包含 https://）

#### 步骤 3：重新构建前端

```bash
npm run build
```

#### 步骤 4：部署前端到 Vercel

```bash
vercel --prod --yes
```

## ✅ 验证部署

1. **访问前端网站**
   https://aiweb-gilt.vercel.app/

2. **检查 API 连接**
   - 打开浏览器开发者工具（F12）
   - 切换到 Network 标签
   - 刷新页面
   - 查看是否有 API 请求发送到 Railway 域名

3. **测试功能**
   - ✅ 页面正常显示
   - ✅ 语言切换正常
   - ✅ CMS 管理后台可以登录
   - ✅ 数据可以保存

## 🔧 配置说明

### 环境变量

**前端（.env.production）**
```env
VITE_API_BASE_URL=https://your-backend.railway.app
```

**后端（Railway 环境变量）**
- `PORT`: 自动设置（Railway 自动注入）
- `NODE_ENV`: production
- `JWT_SECRET`: 可选，用于 JWT 加密

### 修改后端地址

如果需要更换后端服务器：

1. 修改 `.env.production` 中的 `VITE_API_BASE_URL`
2. 重新构建：`npm run build`
3. 重新部署：`vercel --prod --yes`

## 📊 Railway 免费额度

Railway 免费计划包含：
- ✅ 500 小时/月的运行时间
- ✅ 100 GB 出站流量
- ✅ 512 MB 内存
- ✅ 1 GB 磁盘空间
- ✅ 无限项目数

足够中小型项目使用！

## 🔄 更新部署

### 更新后端代码

```bash
cd server
railway up
```

### 更新前端代码

```bash
npm run build
vercel --prod --yes
```

## 🐛 常见问题

### 1. API 请求失败（CORS 错误）

**原因**：后端 CORS 配置问题

**解决**：检查 `server/index.js` 中的 CORS 配置：
```javascript
app.use(cors()) // 允许所有来源
```

### 2. 后端部署失败

**原因**：依赖安装失败或配置错误

**解决**：
```bash
cd server
npm install  # 本地测试依赖
railway logs  # 查看部署日志
```

### 3. 前端无法连接后端

**原因**：API 地址配置错误

**解决**：
1. 检查 `.env.production` 中的地址是否正确
2. 确保地址包含完整协议（https://）
3. 重新构建和部署前端

### 4. Railway 域名访问失败

**原因**：域名未生成或服务未启动

**解决**：
```bash
cd server
railway domain  # 重新生成域名
railway status  # 查看服务状态
railway logs    # 查看日志
```

## 📝 部署清单

部署前检查：
- [ ] Railway CLI 已安装
- [ ] Railway 账号已登录
- [ ] Vercel CLI 已安装
- [ ] Vercel 账号已登录

部署后验证：
- [ ] 后端 Railway 域名可访问
- [ ] 前端 Vercel 网站可访问
- [ ] API 请求正常（无 CORS 错误）
- [ ] CMS 功能正常
- [ ] 数据可以保存和读取

## 🎯 下一步

部署完成后，您可以：
1. ✅ 分享网站链接给客户：https://aiweb-gilt.vercel.app/
2. ✅ 绑定自定义域名（在 Vercel 和 Railway 后台操作）
3. ✅ 配置数据库（如需持久化存储）
4. ✅ 添加监控和日志（Railway 提供内置监控）

## 💡 提示

- Railway 免费账号有使用限制，建议定期检查用量
- 如果流量较大，考虑升级到付费计划
- 可以在 Railway 后台查看实时日志和监控数据
- Vercel 提供无限流量和全球 CDN 加速

## 📧 支持

遇到问题？
1. 查看 Railway 文档：https://docs.railway.app/
2. 查看 Vercel 文档：https://vercel.com/docs
3. 检查部署日志：`railway logs`
