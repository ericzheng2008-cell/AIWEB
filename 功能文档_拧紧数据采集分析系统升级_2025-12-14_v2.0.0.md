# 拧紧数据采集分析系统 - 功能升级文档

**版本**: v2.0.0  
**日期**: 2025-12-14  
**作者**: AI Assistant  
**基于**: Atlas Copco ToolsNet 8 标准规范

---

## 📋 升级概述

本次升级将拧紧数据采集分析模块从基础版本升级为符合工业级标准的完整解决方案，参照 **Atlas Copco ToolsNet 8** 的功能规范进行全面重构。

### 核心升级点

1. **工厂结构管理** (Plant Structure Administration)
2. **多维度数据过滤** (Advanced Filtering)
3. **TOP NOK 应用程序分析** (TOP NOK Applications)
4. **X-Bar/Range 控制图** (SPC Widget)
5. **完整的统计分析** (Statistics Overview)
6. **多格式数据导出** (Multiple Reports)
7. **控制器事件管理** (Controller Events)
8. **工具中心** (Tool Center)

---

## 🏗️ 系统架构

### 数据模型升级

#### 1. 拧紧结果数据结构
```javascript
{
  id: String,                    // 唯一标识
  timestamp: ISO8601,            // 时间戳
  
  // 基本信息
  unitName: String,              // 单元名称 (PF4000-001)
  programName: String,           // 程序名称
  programId: Number,             // 程序ID
  psetId: Number,                // Pset ID
  jobId: Number,                 // Job ID
  batchId: String,               // 批次ID
  identifier: String,            // VIN号/产品标识
  boltNumber: Number,            // 螺栓号 (PowerMACS)
  
  // 拧紧结果
  result: String,                // OK | NOK | OK_REPAIRED
  detailedStatus: String,        // 详细状态描述
  
  // 扭矩数据
  torque: Number,                // 实际扭矩(Nm)
  targetTorque: Number,          // 目标扭矩
  torqueLowerLimit: Number,      // 扭矩下限
  torqueUpperLimit: Number,      // 扭矩上限
  torqueStatus: String,          // OK | LOW | HIGH
  
  // 角度数据
  angle: Number,                 // 实际角度(°)
  targetAngle: Number,           // 目标角度
  angleLowerLimit: Number,       // 角度下限
  angleUpperLimit: Number,       // 角度上限
  angleStatus: String,           // OK | LOW | HIGH
  rundownAngle: Number,          // 下降角度
  rundownAngleStatus: String,    // 下降角度状态
  
  // 其他
  tighteningTime: Number,        // 拧紧时间(s)
  nokReason: String,             // NOK原因
  trace: Array                   // 拧紧曲线数据
}
```

#### 2. 工厂结构
```javascript
{
  id: String,                    // 节点ID
  name: String,                  // 节点名称
  type: String,                  // plant | line | station
  parent: String,                // 父节点ID
  children: Array,               // 子节点ID列表
  unitName: String              // 控制器单元名称(station类型)
}
```

#### 3. 控制器事件
```javascript
{
  id: String,
  timestamp: ISO8601,
  unitName: String,              // 单元名称
  eventLevel: String,            // info | warning | error
  eventType: String,             // 系统 | 程序 | 工具 | 通信 | 报警
  eventCode: String,             // 事件代码
  eventDescription: String,      // 事件描述
  acknowledged: Boolean          // 是否已确认
}
```

---

## 🎯 功能模块详解

### 1. Dashboard (仪表盘)

#### 1.1 Latest Result Widget (最新结果小部件)
- **功能**: 显示工厂结构特定部分的最新10条拧紧结果
- **过滤器**: 工厂结构选择
- **显示数据**:
  - 拧紧状态 (NOK/OK)
  - 单元名称
  - 程序名称
  - 结果时间
  - 扭矩
  - 角度

#### 1.2 TOP NOK Applications Widget
- **功能**: 显示NOK率最高的前10个程序
- **过滤器**: 
  - 工厂结构
  - 天数范围 (最多7天)
- **显示数据**:
  - 程序名称
  - NOK百分比 (柱状图)
  - NOK原因分布 (柱状图)

#### 1.3 SPC Widget (统计过程控制)
- **功能**: 显示X-bar和Range控制图，10个子组
- **过滤器**: 
  - 程序
  - 子组大小
- **显示数据**:
  - 程序名称
  - 程序创建时间
  - Range图 (折线图)
  - X-bar图 (折线图)
  - X-bar上下控制限
  - 扭矩限值
  - 平均扭矩
  - 目标扭矩

---

### 2. Reports (报告)

#### 2.1 Result Report (结果报告)
**主要数据**:
- 拧紧状态 (NOK/OK)
- VIN号
- 单元名称
- 程序名称
- 结果时间
- 最终扭矩、扭矩限值、扭矩状态
- 最终角度、角度限值、角度状态
- 下降角度、下降角度状态
- 拧紧曲线

**次要数据**:
- 详细拧紧状态
- 相关事件
- 完整程序信息
- 步骤数据 (PowerMACS)
- 作业信息 (Power Focus)

#### 2.2 Product List Report (产品列表报告)
**主要数据**:
- VIN号
- 总拧紧数
- OK拧紧数
- NOK拧紧数
- 首次结果时间
- 最后结果时间

**次要数据**: 与Result Report相同

#### 2.3 Result Summary (结果摘要)
**主要数据** (按程序级别):
- 单元名称
- 程序名称
- 程序创建时间
- 螺栓号 (PowerMACS)
- Cp, Cpk
- 扭矩均值、最小值、最大值
- 角度均值、最小值、最大值
- 总数、OK数、NOK数、OK修复数
- OK百分比、NOK百分比、OK修复百分比

#### 2.4 TOP NOK Report
**主要数据**:
- 工厂结构路径
- 单元名称
- 螺栓号
- 位置ID
- 程序类型
- 程序名称
- 程序版本时间
- 程序ID
- OK百分比、NOK百分比
- OK数、NOK数
- 总拧紧数

**次要数据**:
- 饼图显示错误分布

#### 2.5 Event Report (事件报告)
**主要数据**:
- 事件时间
- 单元名称
- 事件级别
- 事件类型
- 事件代码
- 已确认状态
- 事件描述

#### 2.6 Event Summary (事件摘要)
**主要数据**:
- 事件描述
- 事件级别
- 事件类型
- 事件代码
- 事件数量
- 占总数百分比

---

### 3. Statistics (统计分析)

#### 3.1 Statistics Overview (统计概览)
**显示数据**:
- 样本数量
- 最小值、最大值
- 平均值
- 平均值 ±3σ
- 目标值
- 方差
- 标准差 (σ)
- 范围
- Cp, Cpk

**过滤器**:
- 日期范围
- 工厂结构
- 程序名称
- 状态 (OK/NOK/全部)
- 螺栓号 (PowerMACS)
- 步骤 (PowerMACS)
- 值类型 (扭矩/角度/下降角度)
- 分组大小

#### 3.2 X-Bar / Range (X-bar范围图)
**显示数据**:
- 平均扭矩/角度
- X-bar图 (折线图)
- 扭矩/角度限值
- 上下控制限
- 下降角度均值
- Range图 (折线图)

**功能**: 可同时显示两个程序进行对比

#### 3.3 Histogram (直方图)
**显示数据**:
- 正态分布 (柱状图)
- 平均值
- 限值
- 上下控制限

**功能**: 可同时显示两个程序

#### 3.4 Program Scatter (程序散点图)
**显示数据**:
- 目标值
- 扭矩下限/上限
- 角度下限/上限
- 扭矩-角度散点图

#### 3.5 Program Compare (程序对比)
**显示数据**:
- 所有程序参数 (Atlas Copco控制器)
- 支持两个程序并排对比
- 可切换仅显示差异

#### 3.6 Trace Analysis (曲线分析)
**显示数据**:
- 扭矩-角度曲线
- 平均曲线
- 每个点的范围
- 每个点的 ±3σ
- 超出σ范围的曲线

---

### 4. Tool Center (工具中心)

#### 4.1 Tool Overview (工具概览)
**显示数据**:
- 型号类型
- 序列号
- 拧紧次数
- 服务日期
- 校准日期
- 自定义字段

#### 4.2 Tool Details (工具详情)
**ST工具显示**:
- 工具类型
- 物料号
- 序列号
- 电机尺寸
- 齿轮比
- 温度峰值
- 使用开口端
- IP地址 (控制器)
- 最大扭矩
- 全速
- 生产日期
- 更新日期
- 拧紧次数
- 服务拧紧计数
- 服务日期
- MAC地址 (STB工具)
- 软件版本
- 温度限制
- 校准日期
- 连接到单元

#### 4.3 Tool Statistics (工具统计)
**显示数据**:
- 每个应用的NOK百分比 (柱状图)
- NOK原因

#### 4.4 Service Log (服务日志)
**显示数据**:
- 姓名
- 活动类型
- 类别
- 备注
- 附件文件
- 日期时间戳

---

### 5. Notification Center (通知中心)

#### 5.1 Controller Events (控制器事件)
**功能**: 设置控制器事件触发邮件通知
**支持**: 所有 Atlas Copco 控制器事件

---

### 6. Administration (管理)

#### 6.1 Plant Structure Administration (工厂结构管理)
**功能**: 配置与实际工厂布局一致的层级结构
**显示数据**:
- 系统类型
- 单元名称
- 创建日期

---

### 7. Command Center (命令中心)

#### 7.1 Data Collection Speed (数据采集速度)
**显示数据**:
- 当前采集速度 (结果/分钟)
- 当前采集速度 (结果/秒)

#### 7.2 License Status (许可证状态)
**显示数据**:
- 使用中的许可证数量
- 许可的功能

#### 7.3 Database Information (数据库信息)
**显示数据**:
- 服务器名称
- 数据库名称
- 数据库大小
- 版本
- 产品版本
- 数据库中的结果数量
- 今日结果数量
- 数据库中的单元数量
- 数据库中的程序版本数量
- 表空间大小
- 日志文件大小

---

## 📊 数据导出功能

### 1. Result Report Export (结果报告导出)
- CSV格式
- 包含所有拧紧参数
- 扭矩/角度状态
- VIN号/螺栓号

### 2. Product List Export (产品列表导出)
- 按VIN号分组
- 统计每个产品的拧紧情况
- 显示时间范围

### 3. Result Summary Export (结果摘要导出)
- 按程序分组
- 统计分析数据
- Cp/Cpk值

### 4. TOP NOK Export (TOP NOK导出)
- NOK率排名
- NOK原因分析

### 5. Event Report Export (事件报告导出)
- 控制器事件列表
- 事件级别/类型
- 确认状态

---

## 🎨 用户界面升级

### 仪表盘布局
```
┌─────────────────────────────────────────────┐
│  连接状态 & 数据采集速度                        │
│  ├─ 控制器: PF4000-001                        │
│  ├─ 状态: 已连接                              │
│  └─ 采集速度: 20结果/分钟                      │
├─────────────────────────────────────────────┤
│  统计卡片                                      │
│  [总数] [OK数] [NOK数] [OK率]                │
├─────────────────────────────────────────────┤
│  Tab切换                                      │
│  ├─ Dashboard (仪表盘)                        │
│  │   ├─ Latest Results Widget                │
│  │   ├─ TOP NOK Applications Widget          │
│  │   └─ SPC Widget                           │
│  ├─ Reports (报告)                            │
│  │   ├─ Result Report                        │
│  │   ├─ Product List Report                  │
│  │   ├─ Result Summary                       │
│  │   ├─ TOP NOK Report                       │
│  │   ├─ Event Report                         │
│  │   └─ Event Summary                        │
│  ├─ Statistics (统计)                         │
│  │   ├─ Statistics Overview                  │
│  │   ├─ X-Bar / Range                        │
│  │   ├─ Histogram                            │
│  │   ├─ Program Scatter                      │
│  │   ├─ Program Compare                      │
│  │   └─ Trace Analysis                       │
│  ├─ Tool Center (工具中心)                     │
│  │   ├─ Tool Overview                        │
│  │   ├─ Tool Details                         │
│  │   ├─ Tool Statistics                      │
│  │   └─ Service Log                          │
│  └─ Command Center (命令中心)                  │
│      ├─ Data Collection Speed                │
│      ├─ Service Status                       │
│      └─ Database Information                 │
└─────────────────────────────────────────────┘
```

---

## 🔧 技术实现

### Store结构
- **State**: 完整的数据模型，包含工厂结构、工具数据等
- **Getters**: 高级计算属性，支持Cpk、X-Bar/Range等统计分析
- **Actions**: 完整的CRUD操作和数据导出功能

### 关键算法

#### Cpk计算
```javascript
Cpu = (USL - μ) / (3σ)
Cpl = (μ - LSL) / (3σ)
Cpk = min(Cpu, Cpl)
```

#### X-Bar控制图
```javascript
X̄̄ = Σ(X̄) / k              // 总均值
R̄ = Σ(R) / k               // 平均范围
UCL_xbar = X̄̄ + A2 × R̄    // X-bar上控制限
LCL_xbar = X̄̄ - A2 × R̄    // X-bar下控制限
UCL_R = D4 × R̄            // Range上控制限
LCL_R = D3 × R̄            // Range下控制限
```

---

## 📈 性能优化

1. **数据限制**:
   - 拧紧结果: 最多10,000条内存存储
   - 拧紧曲线: 最多1,000条
   - 异常记录: 最多1,000条
   - 控制器事件: 最多5,000条

2. **本地存储**:
   - 只保存最近1,000条结果到localStorage
   - 曲线数据只保存100条

3. **实时更新**:
   - 采集速度每5秒更新一次
   - 统计数据实时计算

---

## 🚀 使用指南

### 快速开始

1. **连接控制器**
   - 输入IP地址 (如: 192.168.1.100)
   - 选择控制器类型 (PF4000/PF6000/PF8000)
   - 点击"连接控制器"

2. **开始数据采集**
   - 连接成功后，点击"开始采集"
   - 系统自动采集并分析数据

3. **查看实时数据**
   - Dashboard显示最新结果
   - 统计卡片实时更新

4. **导出报告**
   - 选择需要的报告类型
   - 应用过滤条件
   - 点击导出按钮

### 高级功能

1. **TOP NOK分析**
   - 快速识别问题程序
   - 分析NOK原因分布

2. **SPC分析**
   - X-Bar/Range控制图
   - Cpk过程能力分析

3. **程序对比**
   - 并排对比两个程序
   - 仅显示差异选项

4. **曲线分析**
   - 平均曲线
   - ±3σ范围
   - 异常曲线识别

---

## 📝 更新日志

### v2.0.0 (2025-12-14)
- ✨ 全面重构数据模型，符合ToolsNet 8标准
- ✨ 新增工厂结构管理
- ✨ 新增TOP NOK应用程序分析
- ✨ 新增X-Bar/Range控制图
- ✨ 新增完整的统计分析功能
- ✨ 新增多种报告导出格式
- ✨ 新增控制器事件管理
- ✨ 新增工具中心功能
- ✨ 新增数据采集速度监控
- 🎨 优化用户界面布局
- ⚡ 优化性能和存储策略

### v1.0.0 (2025-12-13)
- 🎉 初始版本发布
- ✨ 基础数据采集功能
- ✨ 简单统计分析
- ✨ Cpk计算
- ✨ 异常报警

---

## 📞 技术支持

如有问题或建议，请联系技术团队。

---

**注意**: 本文档基于 Atlas Copco ToolsNet 8 标准规范编写，所有功能均可根据实际需求进行调整和扩展。
