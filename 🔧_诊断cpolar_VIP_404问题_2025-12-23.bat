@echo off
chcp 65001 >nul
title cpolar VIP 404é—®é¢˜è¯Šæ–­å·¥å…·
color 0C

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                           â•‘
echo â•‘         ğŸ” cpolar VIP 404é—®é¢˜è¯Šæ–­å·¥å…·                   â•‘
echo â•‘                                                           â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: æ­¥éª¤1: æ£€æŸ¥cpolarå®‰è£…
echo [æ­¥éª¤ 1/8] æ£€æŸ¥cpolarå®‰è£…çŠ¶æ€...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
where cpolar >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ cpolaræœªå®‰è£…ï¼
    echo.
    echo ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
    echo    1. è®¿é—®ï¼šhttps://www.cpolar.com/download
    echo    2. ä¸‹è½½Windowså®¢æˆ·ç«¯
    echo    3. å®‰è£…åé‡æ–°è¿è¡Œæ­¤è„šæœ¬
    echo.
    pause
    exit /b 1
) else (
    echo âœ… cpolarå·²å®‰è£…
)
echo.

:: æ­¥éª¤2: æ£€æŸ¥VIPé…ç½®æ–‡ä»¶
echo [æ­¥éª¤ 2/8] æ£€æŸ¥VIPé…ç½®æ–‡ä»¶...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
set CONFIG_FILE=%USERPROFILE%\.cpolar\cpolar.yml
if not exist "%CONFIG_FILE%" (
    echo âŒ VIPé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼
    echo.
    echo ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
    echo    è¿è¡ŒVIPé…ç½®å‘å¯¼ï¼š
    echo    ğŸ’_VIPç‰ˆæœ¬å›ºå®šåŸŸåé…ç½®_2025-12-21.bat
    echo.
    pause
    exit /b 1
) else (
    echo âœ… é…ç½®æ–‡ä»¶å­˜åœ¨: %CONFIG_FILE%
    echo.
    echo ğŸ“„ é…ç½®æ–‡ä»¶å†…å®¹ï¼š
    type "%CONFIG_FILE%"
)
echo.

:: æ­¥éª¤3: æ£€æŸ¥å‰ç«¯ç«¯å£
echo [æ­¥éª¤ 3/8] æ£€æŸ¥å‰ç«¯æœåŠ¡ç«¯å£...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
netstat -ano | findstr ":5173.*LISTENING" >nul
if %errorlevel% equ 0 (
    echo âœ… ç«¯å£5173æ­£åœ¨ç›‘å¬
    netstat -ano | findstr ":5173"
) else (
    echo âŒ ç«¯å£5173æœªå¯åŠ¨ï¼
    echo.
    echo ğŸ’¡ åŸå› ï¼šå‰ç«¯æœåŠ¡æœªå¯åŠ¨
)
echo.

netstat -ano | findstr ":3002.*LISTENING" >nul
if %errorlevel% equ 0 (
    echo âš ï¸  ç«¯å£3002ä¹Ÿåœ¨ç›‘å¬ï¼ˆæ—§ç«¯å£ï¼‰
    netstat -ano | findstr ":3002"
) else (
    echo â„¹ï¸  ç«¯å£3002æœªä½¿ç”¨
)
echo.

:: æ­¥éª¤4: æ£€æŸ¥åç«¯ç«¯å£
echo [æ­¥éª¤ 4/8] æ£€æŸ¥åç«¯æœåŠ¡ç«¯å£...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
netstat -ano | findstr ":5000.*LISTENING" >nul
if %errorlevel% equ 0 (
    echo âœ… ç«¯å£5000æ­£åœ¨ç›‘å¬
    netstat -ano | findstr ":5000"
) else (
    echo âŒ ç«¯å£5000æœªå¯åŠ¨ï¼
    echo.
    echo ğŸ’¡ åŸå› ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨
)
echo.

:: æ­¥éª¤5: æ£€æŸ¥cpolarè¿›ç¨‹
echo [æ­¥éª¤ 5/8] æ£€æŸ¥cpolarè¿›ç¨‹...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
tasklist | findstr /i "cpolar.exe" >nul
if %errorlevel% equ 0 (
    echo âœ… cpolarè¿›ç¨‹æ­£åœ¨è¿è¡Œ
    tasklist | findstr /i "cpolar.exe"
) else (
    echo âŒ cpolarè¿›ç¨‹æœªè¿è¡Œï¼
    echo.
    echo ğŸ’¡ åŸå› ï¼šcpolaréš§é“æœªå¯åŠ¨
)
echo.

:: æ­¥éª¤6: æ£€æŸ¥cpolar Webç®¡ç†ç•Œé¢
echo [æ­¥éª¤ 6/8] æ£€æŸ¥cpolar Webç®¡ç†ç•Œé¢...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
netstat -ano | findstr ":9200.*LISTENING" >nul
if %errorlevel% equ 0 (
    echo âœ… cpolarç®¡ç†ç•Œé¢å¯ç”¨ (ç«¯å£9200)
    echo    è®¿é—®: http://localhost:9200
) else (
    echo âŒ cpolarç®¡ç†ç•Œé¢ä¸å¯ç”¨
)
echo.

:: æ­¥éª¤7: æµ‹è¯•æœ¬åœ°è®¿é—®
echo [æ­¥éª¤ 7/8] æµ‹è¯•æœ¬åœ°è®¿é—®...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
powershell -Command "try { $response = Invoke-WebRequest -Uri 'http://localhost:5173' -TimeoutSec 5 -UseBasicParsing; Write-Host 'âœ… æœ¬åœ°5173ç«¯å£å¯è®¿é—® (çŠ¶æ€ç :' $response.StatusCode ')' } catch { Write-Host 'âŒ æœ¬åœ°5173ç«¯å£ä¸å¯è®¿é—®' -ForegroundColor Red }"
echo.

powershell -Command "try { $response = Invoke-WebRequest -Uri 'http://localhost:3002' -TimeoutSec 5 -UseBasicParsing; Write-Host 'âš ï¸  æœ¬åœ°3002ç«¯å£å¯è®¿é—® (çŠ¶æ€ç :' $response.StatusCode ')' } catch { Write-Host 'â„¹ï¸  æœ¬åœ°3002ç«¯å£ä¸å¯è®¿é—®' }"
echo.

:: æ­¥éª¤8: è¯Šæ–­ç»“æœæ±‡æ€»
echo [æ­¥éª¤ 8/8] è¯Šæ–­ç»“æœæ±‡æ€»
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

:: åˆ¤æ–­404åŸå› 
echo ğŸ” 404é—®é¢˜åŸå› åˆ†æï¼š
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo.

:: æ£€æŸ¥å‰ç«¯æœåŠ¡
netstat -ano | findstr ":5173.*LISTENING" >nul
if %errorlevel% neq 0 (
    echo âŒ åŸå› 1ï¼šå‰ç«¯æœåŠ¡æœªå¯åŠ¨ï¼ˆç«¯å£5173ï¼‰
    echo    â†’ è¿™æ˜¯æœ€å¯èƒ½çš„404åŸå› ï¼
    echo.
    echo    ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
    echo       æ–¹æ¡ˆAï¼šè¿è¡Œå¿«é€Ÿå¯åŠ¨è„šæœ¬
    echo              ğŸ’_VIPç‰ˆæœ¬å¿«é€Ÿå¯åŠ¨_2025-12-21.bat
    echo.
    echo       æ–¹æ¡ˆBï¼šæ‰‹åŠ¨å¯åŠ¨å‰ç«¯
    echo              1. cdåˆ°é¡¹ç›®ç›®å½•
    echo              2. è¿è¡Œ: npm run dev
    echo              3. ç­‰å¾…å‰ç«¯å¯åŠ¨å®Œæˆ
    echo.
    goto :check_cpolar
)

:: æ£€æŸ¥cpolarè¿›ç¨‹
:check_cpolar
tasklist | findstr /i "cpolar.exe" >nul
if %errorlevel% neq 0 (
    echo âŒ åŸå› 2ï¼šcpolaréš§é“æœªå¯åŠ¨
    echo.
    echo    ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
    echo       æ–¹æ¡ˆAï¼šè¿è¡ŒVIPå¯åŠ¨è„šæœ¬
    echo              ğŸ’_VIPç‰ˆæœ¬å¿«é€Ÿå¯åŠ¨_2025-12-21.bat
    echo.
    echo       æ–¹æ¡ˆBï¼šæ‰‹åŠ¨å¯åŠ¨cpolar
    echo              1. å‘½ä»¤è¡Œè¿è¡Œ: cpolar start-all
    echo              2. æˆ–: cpolar http 5173 -subdomain=æ‚¨çš„å­åŸŸå -region=cn_vip
    echo.
    goto :check_config
)

:: æ£€æŸ¥é…ç½®ç«¯å£åŒ¹é…
:check_config
echo âš ï¸  å¯èƒ½åŸå› 3ï¼šç«¯å£é…ç½®ä¸åŒ¹é…
echo.
echo    cpolaré…ç½®çš„ç«¯å£ vs å®é™…è¿è¡Œç«¯å£
echo    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo    æ£€æŸ¥é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£è®¾ç½®...
echo.
type "%CONFIG_FILE%" | findstr "addr"
echo.
echo    ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
echo       1. ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£æ˜¯5173è¿˜æ˜¯3002
echo       2. ç¡®è®¤å‰ç«¯å®é™…å¯åŠ¨åœ¨å“ªä¸ªç«¯å£
echo       3. ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç«¯å£ä¸€è‡´
echo.

:: æ£€æŸ¥VIPåŸŸå
echo âš ï¸  å¯èƒ½åŸå› 4ï¼šVIPåŸŸåæœªæ­£ç¡®é…ç½®
echo.
echo    ğŸ’¡ è§£å†³æ–¹æ¡ˆï¼š
echo       1. è®¿é—®: https://dashboard.cpolar.com/reserved
echo       2. æ£€æŸ¥æ˜¯å¦å·²åˆ›å»ºä¿ç•™åŸŸå
echo       3. ç¡®è®¤é…ç½®æ–‡ä»¶ä¸­çš„subdomainä¸ä¿ç•™åŸŸåä¸€è‡´
echo.

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo                  ğŸ”§ å¿«é€Ÿä¿®å¤å»ºè®®
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

netstat -ano | findstr ":5173.*LISTENING" >nul
if %errorlevel% neq 0 (
    echo ã€æ¨èæ–¹æ¡ˆã€‘ç«‹å³é‡æ–°å¯åŠ¨æ‰€æœ‰æœåŠ¡
    echo.
    echo 1ï¸âƒ£  å…³é—­æ‰€æœ‰å‘½ä»¤è¡Œçª—å£
    echo 2ï¸âƒ£  è¿è¡Œ: ğŸ’_VIPç‰ˆæœ¬å¿«é€Ÿå¯åŠ¨_2025-12-21.bat
    echo 3ï¸âƒ£  ç­‰å¾…15-20ç§’è®©æœåŠ¡å®Œå…¨å¯åŠ¨
    echo 4ï¸âƒ£  æ£€æŸ¥cpolarçª—å£æ˜¾ç¤ºçš„åœ°å€
    echo 5ï¸âƒ£  è®¿é—®æ˜¾ç¤ºçš„httpsåœ°å€
    echo.
) else (
    tasklist | findstr /i "cpolar.exe" >nul
    if %errorlevel% neq 0 (
        echo ã€æ¨èæ–¹æ¡ˆã€‘åªéœ€å¯åŠ¨cpolaréš§é“
        echo.
        echo 1ï¸âƒ£  å‰ç«¯å·²è¿è¡Œï¼Œåªéœ€å¯åŠ¨cpolar
        echo 2ï¸âƒ£  å‘½ä»¤è¡Œè¿è¡Œ: cpolar start-all
        echo 3ï¸âƒ£  æˆ–æŸ¥çœ‹é…ç½®æ–‡ä»¶è·å–éš§é“åç§°
        echo.
    ) else (
        echo ã€éœ€è¦æ·±å…¥æ£€æŸ¥ã€‘æœåŠ¡çœ‹èµ·æ¥éƒ½åœ¨è¿è¡Œ
        echo.
        echo 1ï¸âƒ£  æ‰“å¼€cpolarç®¡ç†ç•Œé¢: http://localhost:9200
        echo 2ï¸âƒ£  æŸ¥çœ‹éš§é“çŠ¶æ€ï¼ˆStatusåˆ—ï¼‰
        echo 3ï¸âƒ£  æ£€æŸ¥Forwardingåœ°å€æ˜¯å¦æ­£ç¡®
        echo 4ï¸âƒ£  å°è¯•è®¿é—®æ˜¾ç¤ºçš„httpsåœ°å€
        echo.
        echo ğŸ“Š æ­£åœ¨æ‰“å¼€cpolarç®¡ç†ç•Œé¢...
        timeout /t 2 >nul
        start http://localhost:9200
        echo.
    )
)

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo              ğŸ“‹ ç«¯å£å¯¹åº”å…³ç³»è¯´æ˜
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo æ—§é…ç½®ï¼ˆå…è´¹ç‰ˆï¼‰ï¼š
echo   å‰ç«¯: 3002 â†’ cpolar http 3002
echo.
echo VIPé…ç½®ï¼ˆæ¨èï¼‰ï¼š
echo   å‰ç«¯: 5173 â†’ cpolaré…ç½®æ–‡ä»¶ä¸­addr: 5173
echo   åç«¯: 5000 â†’ cpolaré…ç½®æ–‡ä»¶ä¸­addr: 5000
echo.
echo âš ï¸  é‡è¦ï¼šcpolarè½¬å‘çš„ç«¯å£å¿…é¡»ä¸å®é™…æœåŠ¡ç«¯å£ä¸€è‡´ï¼
echo.

echo.
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo                  ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ
echo â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo è¯·æ ¹æ®ä¸Šè¿°è¯Šæ–­ç»“æœé€‰æ‹©æ“ä½œï¼š
echo.
echo A. å¦‚æœå‰ç«¯æœåŠ¡æœªå¯åŠ¨ â†’ è¿è¡ŒVIPå¿«é€Ÿå¯åŠ¨è„šæœ¬
echo B. å¦‚æœcpolaræœªè¿è¡Œ â†’ æ‰‹åŠ¨å¯åŠ¨cpolaræˆ–è¿è¡Œå¯åŠ¨è„šæœ¬  
echo C. å¦‚æœéƒ½åœ¨è¿è¡Œä½†ä»404 â†’ æ£€æŸ¥cpolarç®¡ç†ç•Œé¢(å³å°†æ‰“å¼€)
echo.

choice /C ABC /N /M "è¯·é€‰æ‹© (A/B/C): "

if errorlevel 3 (
    echo.
    echo æ­£åœ¨æ‰“å¼€cpolarç®¡ç†ç•Œé¢...
    start http://localhost:9200
    echo.
    echo ğŸ’¡ åœ¨ç®¡ç†ç•Œé¢ä¸­ï¼š
    echo    1. æŸ¥çœ‹"Status"åˆ—æ˜¯å¦ä¸º"online"
    echo    2. æ£€æŸ¥"Forwarding"åœ°å€
    echo    3. ç¡®è®¤ç«¯å£æ˜¯å¦æ­£ç¡®
    echo.
)

if errorlevel 2 (
    echo.
    echo æ­£åœ¨å¯åŠ¨cpolar VIPéš§é“...
    start "cpolar-VIPè¯Šæ–­" cmd /k "title cpolar VIPéš§é“ && color 0D && echo å¯åŠ¨cpolar VIPéš§é“... && echo. && cpolar start-all"
    echo.
    echo âœ… å·²å¯åŠ¨cpolarï¼Œè¯·æŸ¥çœ‹æ–°çª—å£ä¸­çš„åœ°å€
    echo.
)

if errorlevel 1 (
    echo.
    echo æ­£åœ¨å…³é—­æ—§æœåŠ¡...
    taskkill /F /IM node.exe >nul 2>&1
    taskkill /F /IM cpolar.exe >nul 2>&1
    timeout /t 2 >nul
    echo.
    echo è¯·è¿è¡ŒVIPå¿«é€Ÿå¯åŠ¨è„šæœ¬ï¼š
    echo ğŸ’_VIPç‰ˆæœ¬å¿«é€Ÿå¯åŠ¨_2025-12-21.bat
    echo.
    pause
    start "" "%~dp0ğŸ’_VIPç‰ˆæœ¬å¿«é€Ÿå¯åŠ¨_2025-12-21.bat"
    exit /b 0
)

echo.
echo.
pause
